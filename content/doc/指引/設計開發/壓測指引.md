# è§’è‰²: ä½ æ˜¯ä¸€å€‹è³‡æ·±çš„ç³»çµ±æ¶å¸«,ä¹Ÿæ˜¯AP æ€§èƒ½èª¿è¼ƒé«˜æ‰‹ 
# ç’°å¢ƒ: OS : AIX, ap server:IBM WebSphere Liberty, datbase: db2, ä½¿ç”¨sprint boot é–‹ç™¼, å£“æ¸¬ä½¿ç”¨Jmeter 
# ä»»å‹™: å£“æ¸¬ä¸€å°æ™‚, åŒæ™‚50äºº, 95% request å¿…éœ€åœ¨3ç§’å…§å®Œæˆ, è«‹åˆ—å‡ºå£“æ¸¬æ‡‰æ³¨æ„é‚£äº›åƒæ•¸è¨­å®šèˆ‡èª¿æ ¡

# chatGPT å›ç­”
å¥½çš„ âœ…
ä»¥ä¸‹æˆ‘æœƒç”¨ã€Œè³‡æ·±ç³»çµ±æ¶æ§‹å¸« & AP æ€§èƒ½èª¿æ ¡é«˜æ‰‹ã€çš„è§’åº¦ï¼Œå¹«ä½ æ•´ç† **JMeter å£“æ¸¬è¨­å®š**ã€**Liberty èª¿æ ¡**ã€**DB2 èª¿æ ¡**ã€**AIX/ç³»çµ±å±¤ç´šåƒæ•¸** å››å¤§é¢å‘ï¼Œç¢ºä¿ä½ çš„ä¸€å°æ™‚å£“æ¸¬ï¼ˆ50äººåŒæ™‚ã€95% request < 3 ç§’ï¼‰èƒ½é”æ¨™ã€‚

---

## 1. **å£“æ¸¬å·¥å…· (JMeter) å±¤**

### æ¸¬è©¦å ´æ™¯è¨­è¨ˆ

* **Ramp-Up æ™‚é–“**ï¼šé¿å…ä¸€æ¬¡ 50 äººç¬é–“æ‰“é€²ç³»çµ±ï¼Œå»ºè­° **30â€“60 ç§’å¹³æ»‘å¢åŠ **ï¼Œè§€å¯Ÿç³»çµ±ç©©æ…‹ã€‚
* **Think Time**ï¼šæ¨¡æ“¬ä½¿ç”¨è€…çœŸå¯¦è¡Œç‚ºï¼Œé¿å…ã€Œæ©Ÿæ¢°å¼æ‰“çˆ†ã€ï¼›å¯è¨­å®š 0.5â€“2 ç§’éš¨æ©Ÿç­‰å¾…ã€‚
* **æŒçºŒæ™‚é–“æ¨¡å¼**ï¼šå£“æ¸¬ **60 åˆ†é˜**ï¼Œé¿å…åªæ¸¬ç¬é–“å³°å€¼ã€‚
* **ç›£æ§æ•¸æ“š**ï¼š

  * 95% å“æ‡‰æ™‚é–“
  * Throughput (TPS)
  * Error Rate
  * DB2 Connection Pool ç‹€æ³
  * JVM Heap/GC æ¬¡æ•¸

### JMeter åƒæ•¸å»ºè­°

* **é GUI æ¨¡å¼**åŸ·è¡Œï¼ˆjmeter -n -t test.jmx -l result.jtlï¼‰
* **Thread Group è¨­å®š**ï¼š

  * Users: 50
  * Ramp-Up: 60 sec
  * Duration: 3600 sec
* **çµæœæ”¶é›†**ï¼š

  * å»ºè­°åªé–‹å•Ÿ Summary Report / Backend Listener (InfluxDB + Grafana)ï¼Œé¿å…éå¤š listener é€ æˆå£“æ¸¬ç«¯ç“¶é ¸ã€‚

---

## 2. **Liberty (AP Server) èª¿æ ¡**

### JVM å±¤

* **Xms/Xmx**ï¼šä¾å°ˆæ¡ˆè¨˜æ†¶é«”éœ€æ±‚è¨­å®šï¼ˆå¦‚ 4G/4Gï¼‰ï¼Œä¿æŒå›ºå®šé¿å… GC æ“¾å‹•ã€‚
* **GC ç­–ç•¥**ï¼š

  * AIX + IBM J9 VM â†’ å»ºè­° **gencon**ï¼ˆé©åˆä¸­å°å‹ heapï¼Œä½å»¶é²ï¼‰ã€‚
  * ç›£æ§ GC æ—¥èªŒï¼Œç¢ºä¿ GC pause << 3 ç§’ã€‚
* **Thread pool (WebContainer)**ï¼š

  * é è¨­å¯èƒ½ä¸è¶³ï¼Œå»ºè­°è¨­å®šï¼š`<threadPool id="Default" min="50" max="100"/>`ã€‚
  * èˆ‡ JMeter ä½µç™¼æ•¸åŒ¹é…ï¼Œé¿å… Thread starvationã€‚
* **Connection Pool (DB2 datasource)**ï¼š

  * min = 20ï¼Œmax = 100ï¼ˆéœ€ä¾ DB2 æœ€å¤§é€£ç·šæ•¸èª¿æ•´ï¼‰ã€‚
  * è¨­å®š connectionTimeout â‰¤ 2 ç§’ï¼Œé¿å… DB Hang æ‹–æ…¢ã€‚
* **HTTP Channel**ï¼š

  * `<httpDispatcher maxKeepAliveRequests="0" keepAliveTimeout="30s"/>`
  * `<tcpOptions soReuseAddr="true" soKeepAlive="true"/>`

### Liberty æ—¥èªŒ/ç›£æ§

* å•Ÿç”¨ **perf monitoring (JMX/PMI)**ï¼Œæ”¶é›†ï¼š

  * active thread
  * connection pool usage
  * servlet response time

---

## 3. **DB2 èª¿æ ¡**

### é€£ç·šèˆ‡è³‡æº

* **Max Connections**ï¼šç¢ºä¿ DB2 å¯æ”¯æ’è‡³å°‘ Liberty pool ä¸Šé™ï¼Œä¾‹å¦‚ 100ã€‚
* **Sort/Buffer Pool èª¿æ•´**ï¼š

  * Bufferpool sizeï¼šç¢ºä¿ç†±è³‡æ–™ç›¡é‡åœ¨è¨˜æ†¶é«”ã€‚
  * locklist, logbufsize é©ç•¶åŠ å¤§ï¼Œé¿å… contentionã€‚
* **éš”é›¢ç´šåˆ¥**ï¼š

  * è‹¥æ¥­å‹™å…è¨±ï¼Œæ¡ç”¨ **CS (Cursor Stability)** æˆ– **RS (Read Stability)**ï¼Œé¿å… RR/Serializable éé‡ã€‚
* **ç´¢å¼•å„ªåŒ–**ï¼š

  * å£“æ¸¬å‰ï¼Œç¢ºèªå¸¸ç”¨ SQL æœ‰é©ç•¶ç´¢å¼•ã€‚
* **ç›£æ§**ï¼š

  * db2top / MON\_GET\_PKG\_CACHE\_STATS / MON\_GET\_CONNECTION
  * å¹³å‡ SQL åŸ·è¡Œæ™‚é–“ < 1 ç§’ã€‚

---

## 4. **AIX ç³»çµ±å±¤**

### ç¶²è·¯

* **sockets**

  * `no -o tcp_nodelay=1` â†’ æ¸›å°‘å»¶é²
  * `no -o rfc1323=1` â†’ å•Ÿç”¨ TCP window scaling
* **File Descriptor**

  * ulimit -n è‡³å°‘ 65535
* **EPoll/Selector æ•ˆèƒ½**

  * èª¿æ•´ `AIXTHREAD_SCOPE=S`ï¼Œè®“å¤šç·šç¨‹æ•ˆèƒ½æœ€ä½³åŒ–

### CPU / Memory

* ç¢ºèª **CPU ä½¿ç”¨ç‡ < 70%**ï¼ŒGC ä¸å¯éé »ç¹ã€‚
* ç›£æ§ **paging space**ï¼Œé¿å…å›  JVM heap ä¸è¶³é€ æˆæ›é ã€‚

---

## 5. **é—œéµ KPI èˆ‡æª¢æ ¸**

* **95% request < 3s**
* **éŒ¯èª¤ç‡ < 1%**
* **AP CPU ä½¿ç”¨ç‡ < 70%**
* **DB2 SQL å¹³å‡ < 1s**
* **GC Pause < 500ms**
* **Connection Pool ä½¿ç”¨ç‡ < 80%**

---

âš™ï¸ **èª¿æ ¡é †åºå»ºè­°**

1. **å…ˆç”¨ JMeter é©—è­‰åŸºç·š (å–®äºº/å°‘äººè² è¼‰)** â†’ çœ‹ AP/DB2 åŸºæœ¬å»¶é²ã€‚
2. **èª¿ JVM heap + thread pool** â†’ é¿å… CPU/GC/Thread starvationã€‚
3. **èª¿ DB2 SQL/Index/Connection Pool** â†’ ç¢ºä¿ DB å£“åŠ›ä¸è¶…æ¨™ã€‚
4. **å£“æ¸¬ 50 äººï¼Œè§€å¯Ÿç“¶é ¸** â†’ ç”¨ perfmon/jconsole/db2topã€‚

---

è¦ä¸è¦æˆ‘å¹«ä½ æ•´ç†ä¸€ä»½ **ã€Œå£“æ¸¬æª¢æ ¸è¡¨ã€**ï¼ˆchecklistï¼‰ï¼Œè®“ä½ åœ¨å¯¦éš›æ¸¬è©¦æ™‚é€é …ç¢ºèªï¼ˆJMeter â†’ Liberty â†’ DB2 â†’ AIXï¼‰ï¼Œé¿å…æ¼æ‰é—œéµè¨­å®šï¼Ÿ


å¥½ ğŸ‘
æˆ‘å¹«ä½ æ•´ç†æˆä¸€ä»½ **ã€Œå£“æ¸¬æª¢æ ¸è¡¨ï¼ˆChecklistï¼‰ã€**ï¼Œè®“ä½ åœ¨åŸ·è¡Œ JMeter å£“æ¸¬æ™‚å¯ä»¥é€é …æª¢æŸ¥ï¼Œé¿å…éºæ¼ã€‚

---

# å£“æ¸¬æª¢æ ¸è¡¨ï¼ˆç’°å¢ƒ: AIX + Liberty + DB2 + JMeterï¼‰

## 1. JMeter æ¸¬è©¦ç«¯

* [ ] ä½¿ç”¨ **é GUI æ¨¡å¼** åŸ·è¡Œ (`jmeter -n -t test.jmx -l result.jtl`)
* [ ] Thread Group è¨­å®šï¼š

  * Users = 50
  * Ramp-Up = 30â€“60 ç§’
  * Duration = 3600 ç§’
* [ ] æ¨¡æ“¬ä½¿ç”¨è€…è¡Œç‚ºï¼šè¨­å®š **Think Time (0.5â€“2 ç§’éš¨æ©Ÿ)**
* [ ] Listenerï¼šåƒ…å•Ÿç”¨ **Summary Report / Backend Listener (InfluxDB + Grafana)**
* [ ] ç›£æ§æŒ‡æ¨™ï¼š

  * 95% Response Time
  * Throughput (TPS)
  * Error Rate
  * DB é€£ç·šæ•¸
  * JVM Heap & GC

---

## 2. Liberty (æ‡‰ç”¨ä¼ºæœå™¨)

* [ ] JVM è¨­å®šï¼š

  * Xms = Xmxï¼ˆå»ºè­° 4G/4Gï¼Œä¾éœ€æ±‚èª¿æ•´ï¼‰
  * GC ç­–ç•¥ = **gencon**
* [ ] Thread Pool (WebContainer)ï¼š

  * min = 50
  * max = 100
* [ ] DB Connection Poolï¼š

  * min = 20
  * max = 100ï¼ˆèˆ‡ DB2 è¨­å®šä¸€è‡´ï¼‰
  * connectionTimeout â‰¤ 2 ç§’
* [ ] HTTP Dispatcherï¼š

  * maxKeepAliveRequests = 0
  * keepAliveTimeout = 30s
* [ ] é–‹å•Ÿ Liberty PMI / JMX ç›£æ§ï¼š

  * active threads
  * connection pool usage
  * servlet response time

---

## 3. DB2 è³‡æ–™åº«

* [ ] Max Connections â‰¥ 100
* [ ] Bufferpool è¶³å¤ ï¼Œç†±è³‡æ–™å¸¸é§è¨˜æ†¶é«”
* [ ] Log buffer size / locklist é©åº¦èª¿å¤§
* [ ] Transaction éš”é›¢ç´šåˆ¥ï¼š**CS æˆ– RS**ï¼ˆè‹¥æ¥­å‹™å…è¨±ï¼‰
* [ ] ç¢ºèªå¸¸ç”¨ SQL æœ‰é©ç•¶ç´¢å¼•
* [ ] ç›£æ§ï¼š

  * SQL å¹³å‡åŸ·è¡Œæ™‚é–“ < 1 ç§’
  * DB2 é€£ç·šæ•¸ < ä¸Šé™çš„ 80%
  * db2top / MON\_GET\_PKG\_CACHE\_STATS

---

## 4. AIX ç³»çµ±å±¤

* [ ] Network tuningï¼š

  * `no -o tcp_nodelay=1`
  * `no -o rfc1323=1`
* [ ] File descriptorï¼š`ulimit -n 65535`
* [ ] Thread æ•ˆèƒ½æœ€ä½³åŒ–ï¼š`AIXTHREAD_SCOPE=S`
* [ ] CPU ä½¿ç”¨ç‡ < 70%
* [ ] Paging Space ä½¿ç”¨ç‡ä½ï¼Œé¿å… JVM æ›é 

---

## 5. KPI é©—è­‰

* [ ] 95% Response Time < **3 ç§’**
* [ ] Error Rate < **1%**
* [ ] AP CPU < **70%**
* [ ] DB2 SQL å¹³å‡ < **1 ç§’**
* [ ] GC Pause < **500 ms**
* [ ] Connection Pool ä½¿ç”¨ç‡ < **80%**

---

é€™ä»½ checklist å¯ä»¥è®“ä½ å£“æ¸¬å‰ã€ä¸­ã€å¾Œå„éšæ®µåšé€é …ç¢ºèªã€‚

è¦ä¸è¦æˆ‘å¹«ä½ åšä¸€ä»½ **ã€Œå£“æ¸¬ç´€éŒ„è¡¨æ ¼ç¯„æœ¬ã€**ï¼ˆExcel/CSV æ ¼å¼ï¼‰ï¼Œè®“ä½ åœ¨å¯¦éš›æ¸¬è©¦æ™‚å¡«å¯«æ¯å€‹æª¢æ ¸é …ç›®èˆ‡ç›£æ§æ•¸æ“šï¼Œæ–¹ä¾¿ä¹‹å¾Œåˆ†æèˆ‡èª¿å„ªï¼Ÿ


å¤ªå¥½äº† âœ…
é‚£æˆ‘å¹«ä½ è¨­è¨ˆä¸€å€‹ **è‡ªå‹•åŒ–å£“æ¸¬å ±è¡¨æµç¨‹ç¯„ä¾‹**ï¼Œå¯ä»¥ç›´æ¥æŠŠ **JMeter æ¸¬è©¦çµæœ (JTL/CSV)** åŒ¯å…¥ Excelï¼Œä¸¦è‡ªå‹•æª¢æŸ¥ KPI æ˜¯å¦é”æ¨™ã€‚

---

# ğŸ”¹ è‡ªå‹•åŒ–å£“æ¸¬å ±è¡¨è¨­è¨ˆ

## 1. è¼¸å…¥è³‡æ–™

* **ä¾†æºæª”æ¡ˆ**ï¼šJMeter `result.jtl` æˆ– `result.csv`
* ä¸»è¦æ¬„ä½ï¼š

  * `elapsed` â†’ Response Time (ms)
  * `success` â†’ æ˜¯å¦æˆåŠŸ
  * `label` â†’ æ¸¬è©¦ API åç¨±
  * `timeStamp` â†’ æ™‚é–“æˆ³

---

## 2. è‡ªå‹•è¨ˆç®—çš„ KPI

| KPI æŒ‡æ¨™            | è¨ˆç®—æ–¹å¼                             | é–€æª»        |
| ----------------- | -------------------------------- | --------- |
| 95% Response Time | `elapsed` æ’åºå– P95                | < 3000 ms |
| Error Rate        | `fail count / total count`       | < 1%      |
| å¹³å‡ Response Time  | `avg(elapsed)`                   | < 2000 ms |
| Throughput (TPS)  | `total requests / test duration` | ä¾éœ€æ±‚       |
| AP CPU ä½¿ç”¨ç‡        | ç³»çµ±ç›£æ§åŒ¯å…¥ (ex: nmon)                | < 70%     |
| DB2 SQL å¹³å‡æ™‚é–“      | db2top / log åŒ¯å‡º                  | < 1 ç§’     |
| GC Pause          | JVM GC Log                       | < 500 ms  |

---

## 3. Excel å ±è¡¨ç¯„æœ¬è¨­è¨ˆ

### Sheet 1: **å£“æ¸¬åŸå§‹æ•¸æ“š**

* åŒ¯å…¥ JMeter result.csv (è‡ªå‹•åŒ¯å…¥)

### Sheet 2: **KPI Summary**

| æŒ‡æ¨™                | å¯¦æ¸¬æ•¸æ“š      | é–€æª»      | ç‹€æ…‹ (OK/NG) |
| ----------------- | --------- | ------- | ---------- |
| 95% Response Time | 2800 ms   | 3000 ms | âœ… OK       |
| Error Rate        | 0.5%      | 1%      | âœ… OK       |
| å¹³å‡ Response Time  | 1200 ms   | 2000 ms | âœ… OK       |
| Throughput        | 150 req/s | -       | -          |
| AP CPU            | 65%       | 70%     | âœ… OK       |
| DB2 SQL å¹³å‡        | 0.8s      | 1s      | âœ… OK       |
| GC Pause          | 400 ms    | 500 ms  | âœ… OK       |

### Sheet 3: **è¶¨å‹¢åœ–**

* Response Time åˆ†ä½ˆåœ– (95%, 99%)
* TPS æ›²ç·šåœ–
* Error Rate æ™‚é–“åºåˆ—

---

## 4. è‡ªå‹•åŒ–åŒ¯å…¥èˆ‡è¨ˆç®— (Python ç¯„ä¾‹)

æˆ‘å¯ä»¥å¹«ä½ å¯«ä¸€å€‹ Python è…³æœ¬ï¼Œç›´æ¥ï¼š

1. è®€å– `result.jtl`
2. è¨ˆç®— KPI
3. å¯«å…¥åˆ° **å£“æ¸¬æª¢æ ¸è¡¨ Excel**

é€™æ¨£ä½ æ¯æ¬¡å£“æ¸¬å®Œï¼Œåªè¦ä¸Ÿ `result.jtl`ï¼Œå°±èƒ½ä¸€éµç”¢ç”Ÿå ±è¡¨ã€‚

---

è¦ä¸è¦æˆ‘å¹«ä½ ç›´æ¥ç”¢ç”Ÿ **Python è‡ªå‹•åŒ–åˆ†æè…³æœ¬**ï¼ˆè¼¸å…¥ JMeter JTL â†’ è¼¸å‡º Excel å ±è¡¨ï¼‰ï¼Ÿ


æˆ‘å·²ç¶“å¹«ä½ ç”¢ç”Ÿäº†ä¸€å€‹ **Python è‡ªå‹•åŒ–åˆ†æè…³æœ¬** âœ…

```python
import pandas as pd
import numpy as np
import sys
from openpyxl import Workbook
from openpyxl.utils.dataframe import dataframe_to_rows

# === è®€å– JMeter å£“æ¸¬çµæœ (JTL/CSV) ===
def load_jmeter_result(file_path: str):
    try:
        df = pd.read_csv(file_path)
    except Exception as e:
        print(f"è®€å–æª”æ¡ˆå¤±æ•—: {e}")
        sys.exit(1)

    # ç¢ºä¿å¿…è¦æ¬„ä½å­˜åœ¨
    required_cols = {"timeStamp", "elapsed", "success", "label"}
    if not required_cols.issubset(df.columns):
        raise ValueError(f"ç¼ºå°‘å¿…è¦æ¬„ä½, éœ€è¦ {required_cols}, ä½†æ‰¾åˆ° {df.columns}")
    return df

# === è¨ˆç®— KPI ===
def calculate_kpi(df: pd.DataFrame):
    total_requests = len(df)
    success_requests = df[df["success"] == True]
    error_rate = (1 - len(success_requests) / total_requests) * 100

    p95 = np.percentile(df["elapsed"], 95)
    avg_resp = df["elapsed"].mean()
    max_resp = df["elapsed"].max()

    test_duration_sec = (df["timeStamp"].max() - df["timeStamp"].min()) / 1000
    tps = total_requests / test_duration_sec if test_duration_sec > 0 else 0

    kpi = {
        "95% Response Time (ms)": round(p95, 2),
        "Average Response Time (ms)": round(avg_resp, 2),
        "Max Response Time (ms)": round(max_resp, 2),
        "Error Rate (%)": round(error_rate, 2),
        "Throughput (req/s)": round(tps, 2),
        "Total Requests": total_requests,
    }
    return kpi

# === åŒ¯å‡º Excel å ±è¡¨ ===
def export_to_excel(df: pd.DataFrame, kpi: dict, output_path: str):
    wb = Workbook()

    # Sheet1: åŸå§‹æ•¸æ“š
    ws1 = wb.active
    ws1.title = "Raw Data"
    for r in dataframe_to_rows(df, index=False, header=True):
        ws1.append(r)

    # Sheet2: KPI Summary
    ws2 = wb.create_sheet(title="KPI Summary")
    ws2.append(["æŒ‡æ¨™", "å¯¦æ¸¬æ•¸æ“š", "é–€æª»", "ç‹€æ…‹"])

    thresholds = {
        "95% Response Time (ms)": 3000,
        "Error Rate (%)": 1,
        "Average Response Time (ms)": 2000,
    }

    for key, value in kpi.items():
        threshold = thresholds.get(key, "-")
        if threshold != "-":
            status = "OK" if value <= threshold else "NG"
        else:
            status = "-"
        ws2.append([key, value, threshold, status])

    # Sheet3: æ¸¬è©¦è¨­å®šæª¢æ ¸è¡¨
    ws3 = wb.create_sheet(title="Checklist")
    ws3.append(["åˆ†é¡", "æª¢æ ¸é …ç›®", "ç‹€æ…‹ (OK/NG)", "å¯¦æ¸¬æ•¸æ“š/å‚™è¨»"])
    checklist_items = [
        ("JMeter", "é GUI æ¨¡å¼åŸ·è¡Œ"),
        ("JMeter", "Thread Group è¨­å®š (50 users, 1hr)"),
        ("Liberty", "JVM Xms=Xmx, GC=gencon"),
        ("Liberty", "Thread Pool min=50, max=100"),
        ("DB2", "Max Connections â‰¥ 100"),
        ("DB2", "SQL ç´¢å¼•æª¢æŸ¥"),
        ("AIX", "ulimit -n 65535"),
        ("AIX", "tcp_nodelay=1, rfc1323=1"),
        ("KPI", "95% Response Time < 3 ç§’"),
        ("KPI", "Error Rate < 1%"),
    ]
    for cat, item in checklist_items:
        ws3.append([cat, item, "", ""])

    wb.save(output_path)
    print(f"Excel å ±è¡¨å·²ç”¢ç”Ÿ: {output_path}")


if __name__ == "__main__":
    if len(sys.argv) < 3:
        print("ä½¿ç”¨æ–¹å¼: python jmeter_report_analysis.py <JMeterçµæœæª”.csv> <è¼¸å‡ºExcelæª”.xlsx>")
        sys.exit(1)

    input_file = sys.argv[1]
    output_file = sys.argv[2]

    df = load_jmeter_result(input_file)
    kpi = calculate_kpi(df)
    export_to_excel(df, kpi, output_file)
```


é€™å€‹è…³æœ¬å¯ä»¥ï¼š

1. è®€å– JMeter çš„å£“æ¸¬çµæœ (`.jtl` æˆ– `.csv`)
2. è‡ªå‹•è¨ˆç®— **95% RTã€å¹³å‡ RTã€éŒ¯èª¤ç‡ã€TPS**
3. è¼¸å‡ºä¸€ä»½ **Excel å ±è¡¨**ï¼ŒåŒ…å«ï¼š

   * åŸå§‹æ•¸æ“š
   * KPI Summary (è‡ªå‹•åˆ¤æ–· OK/NG)
   * å£“æ¸¬æª¢æ ¸è¡¨

ä½ åªéœ€è¦åŸ·è¡Œï¼š

```bash
python jmeter_report_analysis.py result.jtl å£“æ¸¬å ±è¡¨.xlsx
```

è¦ä¸è¦æˆ‘å†å¹«ä½ åŠ ä¸Š **Response Time åˆ†ä½ˆåœ– & TPS è¶¨å‹¢åœ–**ï¼Œè‡ªå‹•ç•«åœ¨ Excel è£¡ï¼Ÿ

```Python
import pandas as pd
import numpy as np
import sys
from openpyxl import Workbook
from openpyxl.utils.dataframe import dataframe_to_rows
from openpyxl.chart import LineChart, Reference, BarChart

# === è®€å– JMeter å£“æ¸¬çµæœ (JTL/CSV) ===
def load_jmeter_result(file_path: str):
    try:
        df = pd.read_csv(file_path)
    except Exception as e:
        print(f"è®€å–æª”æ¡ˆå¤±æ•—: {e}")
        sys.exit(1)

    # ç¢ºä¿å¿…è¦æ¬„ä½å­˜åœ¨
    required_cols = {"timeStamp", "elapsed", "success", "label"}
    if not required_cols.issubset(df.columns):
        raise ValueError(f"ç¼ºå°‘å¿…è¦æ¬„ä½, éœ€è¦ {required_cols}, ä½†æ‰¾åˆ° {df.columns}")
    return df

# === è¨ˆç®— KPI ===
def calculate_kpi(df: pd.DataFrame):
    total_requests = len(df)
    success_requests = df[df["success"] == True]
    error_rate = (1 - len(success_requests) / total_requests) * 100

    p95 = np.percentile(df["elapsed"], 95)
    avg_resp = df["elapsed"].mean()
    max_resp = df["elapsed"].max()

    test_duration_sec = (df["timeStamp"].max() - df["timeStamp"].min()) / 1000
    tps = total_requests / test_duration_sec if test_duration_sec > 0 else 0

    kpi = {
        "95% Response Time (ms)": round(p95, 2),
        "Average Response Time (ms)": round(avg_resp, 2),
        "Max Response Time (ms)": round(max_resp, 2),
        "Error Rate (%)": round(error_rate, 2),
        "Throughput (req/s)": round(tps, 2),
        "Total Requests": total_requests,
    }
    return kpi

# === åŒ¯å‡º Excel å ±è¡¨ ===
def export_to_excel(df: pd.DataFrame, kpi: dict, output_path: str):
    wb = Workbook()

    # Sheet1: åŸå§‹æ•¸æ“š
    ws1 = wb.active
    ws1.title = "Raw Data"
    for r in dataframe_to_rows(df, index=False, header=True):
        ws1.append(r)

    # Sheet2: KPI Summary
    ws2 = wb.create_sheet(title="KPI Summary")
    ws2.append(["æŒ‡æ¨™", "å¯¦æ¸¬æ•¸æ“š", "é–€æª»", "ç‹€æ…‹"])

    thresholds = {
        "95% Response Time (ms)": 3000,
        "Error Rate (%)": 1,
        "Average Response Time (ms)": 2000,
    }

    for key, value in kpi.items():
        threshold = thresholds.get(key, "-")
        if threshold != "-":
            status = "OK" if value <= threshold else "NG"
        else:
            status = "-"
        ws2.append([key, value, threshold, status])

    # Sheet3: æ¸¬è©¦è¨­å®šæª¢æ ¸è¡¨
    ws3 = wb.create_sheet(title="Checklist")
    ws3.append(["åˆ†é¡", "æª¢æ ¸é …ç›®", "ç‹€æ…‹ (OK/NG)", "å¯¦æ¸¬æ•¸æ“š/å‚™è¨»"])
    checklist_items = [
        ("JMeter", "é GUI æ¨¡å¼åŸ·è¡Œ"),
        ("JMeter", "Thread Group è¨­å®š (50 users, 1hr)"),
        ("Liberty", "JVM Xms=Xmx, GC=gencon"),
        ("Liberty", "Thread Pool min=50, max=100"),
        ("DB2", "Max Connections â‰¥ 100"),
        ("DB2", "SQL ç´¢å¼•æª¢æŸ¥"),
        ("AIX", "ulimit -n 65535"),
        ("AIX", "tcp_nodelay=1, rfc1323=1"),
        ("KPI", "95% Response Time < 3 ç§’"),
        ("KPI", "Error Rate < 1%"),
    ]
    for cat, item in checklist_items:
        ws3.append([cat, item, "", ""])

    # Sheet4: Charts
    ws4 = wb.create_sheet(title="Charts")

    # æº–å‚™ Response Time åˆ†ä½ˆè³‡æ–™
    ws4.append(["Request #", "Response Time (ms)"])
    for i, v in enumerate(df["elapsed"].values[:500], start=1):  # åªå–å‰500ç­†é¿å…æª”æ¡ˆéå¤§
        ws4.append([i, v])

    # åŠ å…¥ Response Time åˆ†ä½ˆåœ– (BarChart)
    chart1 = BarChart()
    chart1.title = "Response Time åˆ†ä½ˆ (å‰500ç­†)"
    data = Reference(ws4, min_col=2, min_row=2, max_row=501)
    cats = Reference(ws4, min_col=1, min_row=2, max_row=501)
    chart1.add_data(data, titles_from_data=False)
    chart1.set_categories(cats)
    chart1.y_axis.title = "ms"
    chart1.x_axis.title = "Request #"
    ws4.add_chart(chart1, "E2")

    # æº–å‚™ TPS è¶¨å‹¢è³‡æ–™ (æ¯ç§’è«‹æ±‚æ•¸)
    df["second"] = (df["timeStamp"] / 1000).astype(int)
    tps_data = df.groupby("second").size().reset_index(name="tps")
    ws4.append([])
    ws4.append(["Second", "TPS"])
    for _, row in tps_data.iterrows():
        ws4.append([row["second"], row["tps"]])

    # åŠ å…¥ TPS è¶¨å‹¢åœ– (LineChart)
    chart2 = LineChart()
    chart2.title = "TPS è¶¨å‹¢åœ–"
    data = Reference(ws4, min_col=2, min_row=503, max_row=503 + len(tps_data))
    cats = Reference(ws4, min_col=1, min_row=503, max_row=503 + len(tps_data))
    chart2.add_data(data, titles_from_data=False)
    chart2.set_categories(cats)
    chart2.y_axis.title = "Requests/sec"
    chart2.x_axis.title = "Second"
    ws4.add_chart(chart2, "E20")

    wb.save(output_path)
    print(f"Excel å ±è¡¨å·²ç”¢ç”Ÿ (å«åœ–è¡¨): {output_path}")


if __name__ == "__main__":
    if len(sys.argv) < 3:
        print("ä½¿ç”¨æ–¹å¼: python jmeter_report_analysis.py <JMeterçµæœæª”.csv> <è¼¸å‡ºExcelæª”.xlsx>")
        sys.exit(1)

    input_file = sys.argv[1]
    output_file = sys.argv[2]

    df = load_jmeter_result(input_file)
    kpi = calculate_kpi(df)
    export_to_excel(df, kpi, output_file)
```

æˆ‘å·²ç¶“å¹«ä½ æŠŠ **Response Time åˆ†ä½ˆåœ–** å’Œ **TPS è¶¨å‹¢åœ–** åŠ å…¥ Python è…³æœ¬ âœ…
åŸ·è¡Œå¾Œæœƒåœ¨ Excel å ±è¡¨è£¡è‡ªå‹•ç”Ÿæˆåœ–è¡¨ï¼Œæ–¹ä¾¿ç›´è§€è§€å¯Ÿå£“æ¸¬çµæœã€‚

è¦ä¸è¦æˆ‘å†å¹«ä½ åŠ ä¸Š **è‡ªå‹•å¯„é€å ±è¡¨ï¼ˆé™„ Excel & åœ–è¡¨æˆªåœ–ï¼‰åˆ° Email/Teams** çš„åŠŸèƒ½ï¼Ÿ
