# Domain-Driven Design æ•™å­¸æ‰‹å†Šï¼ˆä¸€ï¼‰

## ğŸ¯ æ•™å­¸ç›®æ¨™
æœ¬æ•™å­¸æ‰‹å†Šæ—¨åœ¨å¹«åŠ©é–‹ç™¼åœ˜éšŠæˆå“¡æ·±å…¥ç†è§£ä¸¦æ­£ç¢ºæ‡‰ç”¨ Domain-Driven Design (DDD)ï¼Œå¾åŸºç¤æ¦‚å¿µåˆ°å¯¦éš›æ‡‰ç”¨ï¼Œæœ€çµ‚èƒ½å¤ é€šé DDD èªè­‰è€ƒè©¦ã€‚

## ğŸ“š å®Œæ•´ç›®éŒ„

### [ç¬¬ä¸€ç¯‡ï¼šåŸºç¤å…¥é–€](#ç¬¬ä¸€ç¯‡åŸºç¤å…¥é–€)

- **[1. ä»€éº¼æ˜¯ Domain-Driven Design (DDD)](#1-ä»€éº¼æ˜¯-domain-driven-design-ddd)**
  - [1.1 èƒŒæ™¯èˆ‡æ­·å²](#11-èƒŒæ™¯èˆ‡æ­·å²)
  - [1.2 ç‚ºä»€éº¼éœ€è¦ DDD](#12-ç‚ºä»€éº¼éœ€è¦-ddd)
  - [1.3 èˆ‡å‚³çµ±é–‹ç™¼æ–¹å¼çš„å·®ç•°](#13-èˆ‡å‚³çµ±é–‹ç™¼æ–¹å¼çš„å·®ç•°)
  - ğŸ’¡ å¯¦å‹™æ¡ˆä¾‹ï¼šé›»å•†ç³»çµ±è¨­è¨ˆå·®ç•°
- **[2. DDD çš„æ ¸å¿ƒç†å¿µ](#2-ddd-çš„æ ¸å¿ƒç†å¿µ)**
  - [2.1 Domainï¼ˆé ˜åŸŸï¼‰çš„é‡è¦æ€§](#21-domainé ˜åŸŸçš„é‡è¦æ€§)
  - [2.2 Ubiquitous Languageï¼ˆé€šç”¨èªè¨€ï¼‰](#22-ubiquitous-languageé€šç”¨èªè¨€)
  - [2.3 Model-Driven Designï¼ˆæ¨¡å‹é©…å‹•è¨­è¨ˆï¼‰](#23-model-driven-designæ¨¡å‹é©…å‹•è¨­è¨ˆ)
- **[3. DDD çš„å…©å¤§é¢å‘](#3-ddd-çš„å…©å¤§é¢å‘)**
  - [3.1 æˆ°ç•¥è¨­è¨ˆ (Strategic Design)](#31-æˆ°ç•¥è¨­è¨ˆ-strategic-design)
  - [3.2 æˆ°è¡“è¨­è¨ˆ (Tactical Design)](#32-æˆ°è¡“è¨­è¨ˆ-tactical-design)
  - [3.3 æˆ°ç•¥èˆ‡æˆ°è¡“è¨­è¨ˆçš„é—œä¿‚](#33-æˆ°ç•¥èˆ‡æˆ°è¡“è¨­è¨ˆçš„é—œä¿‚)
- **[ğŸ’¯ ç¬¬ä¸€ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰](#-ç¬¬ä¸€ç¯‡æª¢æŸ¥æ¸…å–®checklist)**
- **[ğŸ“ ç¬¬ä¸€ç¯‡ç¸½çµ](#-ç¬¬ä¸€ç¯‡ç¸½çµ)**

### [ç¬¬äºŒç¯‡ï¼šDDD æˆ°ç•¥è¨­è¨ˆ (Strategic Design)](#ç¬¬äºŒç¯‡ddd-æˆ°ç•¥è¨­è¨ˆ-strategic-design)

- **[4. å­åŸŸ (Subdomain) çš„åˆ†é¡](#4-å­åŸŸ-subdomain-çš„åˆ†é¡)**
  - [4.1 ä»€éº¼æ˜¯å­åŸŸ](#41-ä»€éº¼æ˜¯å­åŸŸ)
  - [4.2 æ ¸å¿ƒé ˜åŸŸ (Core Domain)](#42-æ ¸å¿ƒé ˜åŸŸ-core-domain)
  - [4.3 æ”¯æ´å­åŸŸ (Supporting Subdomain)](#43-æ”¯æ´å­åŸŸ-supporting-subdomain)
  - [4.4 é€šç”¨å­åŸŸ (Generic Subdomain)](#44-é€šç”¨å­åŸŸ-generic-subdomain)
  - [4.5 å­åŸŸåˆ†é¡å¯¦å‹™å·¥ä½œåŠ](#45-å­åŸŸåˆ†é¡å¯¦å‹™å·¥ä½œåŠ)
- **[5. é™ç•Œä¸Šä¸‹æ–‡ (Bounded Context)](#5-é™ç•Œä¸Šä¸‹æ–‡-bounded-context)**
  - [5.1 å®šç¾©èˆ‡è­˜åˆ¥æ–¹æ³•](#51-å®šç¾©èˆ‡è­˜åˆ¥æ–¹æ³•)
  - [5.2 ç•Œå®šä¸Šä¸‹æ–‡çš„æº–å‰‡](#52-ç•Œå®šä¸Šä¸‹æ–‡çš„æº–å‰‡)
  - [5.3 é™ç•Œä¸Šä¸‹æ–‡çš„é‚Šç•ŒåŠƒåˆ†ç¯„ä¾‹](#53-é™ç•Œä¸Šä¸‹æ–‡çš„é‚Šç•ŒåŠƒåˆ†ç¯„ä¾‹)
  - [5.4 ä¸Šä¸‹æ–‡å¤§å°çš„è€ƒé‡](#54-ä¸Šä¸‹æ–‡å¤§å°çš„è€ƒé‡)
- **[6. ä¸Šä¸‹æ–‡æ˜ å°„ (Context Mapping)](#6-ä¸Šä¸‹æ–‡æ˜ å°„-context-mapping)**
  - [6.1 Context Map åŸºæœ¬åœ–ç¤º](#61-context-map-åŸºæœ¬åœ–ç¤º)
  - [6.2 ä¸Šä¸‹æ–‡ä¹‹é–“çš„é—œä¿‚æ¨¡å¼](#62-ä¸Šä¸‹æ–‡ä¹‹é–“çš„é—œä¿‚æ¨¡å¼)
  - [6.3 æ•´åˆæ¨¡å¼é¸æ“‡æŒ‡å—](#63-æ•´åˆæ¨¡å¼é¸æ“‡æŒ‡å—)
- **[7. æ¡ˆä¾‹åˆ†æ](#7-æ¡ˆä¾‹åˆ†æ)**
  - [7.1 å¦‚ä½•å°‡çœŸå¯¦å°ˆæ¡ˆåˆ‡åˆ†ç‚ºå­åŸŸèˆ‡é™ç•Œä¸Šä¸‹æ–‡](#71-å¦‚ä½•å°‡çœŸå¯¦å°ˆæ¡ˆåˆ‡åˆ†ç‚ºå­åŸŸèˆ‡é™ç•Œä¸Šä¸‹æ–‡)
  - [7.2 åˆ†æéŠ€è¡Œ/é‡‘èç³»çµ±æ¡ˆä¾‹](#72-åˆ†æéŠ€è¡Œé‡‘èç³»çµ±æ¡ˆä¾‹)
- **[ğŸ’¯ ç¬¬äºŒç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰](#-ç¬¬äºŒç¯‡æª¢æŸ¥æ¸…å–®checklist)**
- **[ğŸ“ ç¬¬äºŒç¯‡ç¸½çµ](#-ç¬¬äºŒç¯‡ç¸½çµ)**

### [ç¬¬ä¸‰ç¯‡ï¼šDDD æˆ°è¡“è¨­è¨ˆ (Tactical Design)](#ç¬¬ä¸‰ç¯‡ddd-æˆ°è¡“è¨­è¨ˆ-tactical-design)

- **[8. æ ¸å¿ƒæ§‹ä»¶ä»‹ç´¹](#8-æ ¸å¿ƒæ§‹ä»¶ä»‹ç´¹)**
  - [8.1 Entityï¼ˆå¯¦é«”ï¼‰](#81-entityå¯¦é«”)
  - [8.2 Value Objectï¼ˆå€¼ç‰©ä»¶ï¼‰](#82-value-objectå€¼ç‰©ä»¶)
  - [8.3 Aggregateï¼ˆèšåˆï¼‰èˆ‡ Aggregate Root](#83-aggregateèšåˆèˆ‡-aggregate-root)
  - [8.4 Repositoryï¼ˆå€‰å„²ï¼‰](#84-repositoryå€‰å„²)
  - [8.5 Serviceï¼ˆé ˜åŸŸæœå‹™ / æ‡‰ç”¨æœå‹™ï¼‰](#85-serviceé ˜åŸŸæœå‹™--æ‡‰ç”¨æœå‹™)
  - [8.6 Factoryï¼ˆå·¥å» ï¼‰](#86-factoryå·¥å» )
- **[ğŸ’¯ ç¬¬ä¸‰ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰](#-ç¬¬ä¸‰ç¯‡æª¢æŸ¥æ¸…å–®checklist)**

### [ç¬¬å››ç¯‡ï¼šDDD èˆ‡å¯¦å‹™æ‡‰ç”¨](#ç¬¬å››ç¯‡ddd-èˆ‡å¯¦å‹™æ‡‰ç”¨)

- **[9. é ˜åŸŸäº‹ä»¶ (Domain Events)](#9-é ˜åŸŸäº‹ä»¶-domain-events)**
  - [9.1 ä»€éº¼æ˜¯é ˜åŸŸäº‹ä»¶](#91-ä»€éº¼æ˜¯é ˜åŸŸäº‹ä»¶)
  - [9.2 äº‹ä»¶ç™¼å¸ƒèˆ‡è¨‚é–±æ¨¡å¼](#92-äº‹ä»¶ç™¼å¸ƒèˆ‡è¨‚é–±æ¨¡å¼)
  - [9.3 Event Sourcing](#93-event-sourcing)
  - [9.4 CQRS èˆ‡ DDD çš„çµåˆ](#94-cqrs-èˆ‡-ddd-çš„çµåˆ)
- **[10. æ¨¡çµ„åŒ–èˆ‡åˆ†å±¤æ¶æ§‹](#10-æ¨¡çµ„åŒ–èˆ‡åˆ†å±¤æ¶æ§‹)**
  - [10.1 DDD åˆ†å±¤æ¶æ§‹](#101-ddd-åˆ†å±¤æ¶æ§‹)
  - [10.2 Hexagonal Architectureï¼ˆå…­è§’æ¶æ§‹ï¼‰](#102-hexagonal-architectureå…­è§’æ¶æ§‹)
  - [10.3 Clean Architecture](#103-clean-architecture)
- **[11. åœ¨å¾®æœå‹™æ¶æ§‹ä¸­çš„ DDD](#11-åœ¨å¾®æœå‹™æ¶æ§‹ä¸­çš„-ddd)**
  - [11.1 Bounded Context èˆ‡å¾®æœå‹™çš„å°æ‡‰](#111-bounded-context-èˆ‡å¾®æœå‹™çš„å°æ‡‰)
  - [11.2 å¾®æœå‹™é‚Šç•Œè¨­è¨ˆ](#112-å¾®æœå‹™é‚Šç•Œè¨­è¨ˆ)
  - [11.3 è³‡æ–™ä¸€è‡´æ€§ç­–ç•¥](#113-è³‡æ–™ä¸€è‡´æ€§ç­–ç•¥)
- **[12. èˆ‡æ•æ·ã€Scrum çš„æ•´åˆ](#12-èˆ‡æ•æ·scrum-çš„æ•´åˆ)**
  - [12.1 Event Storming](#121-event-storming)
  - [12.2 Domain Storytelling](#122-domain-storytelling)
  - [12.3 Scrum ä¸­çš„ DDD å¯¦è¸](#123-scrum-ä¸­çš„-ddd-å¯¦è¸)
- **[13. å°ˆæ¡ˆæœ€ä½³å¯¦è¸](#13-å°ˆæ¡ˆæœ€ä½³å¯¦è¸)**
  - [13.1 å¸¸è¦‹éŒ¯èª¤èˆ‡åæ¨¡å¼](#131-å¸¸è¦‹éŒ¯èª¤èˆ‡åæ¨¡å¼)
  - [13.2 æˆåŠŸæ¡ˆä¾‹åˆ†äº«](#132-æˆåŠŸæ¡ˆä¾‹åˆ†äº«)
  - [13.3 DDD å°å…¥è·¯ç·šåœ–](#133-ddd-å°å…¥è·¯ç·šåœ–)
- **[ğŸ’¯ ç¬¬å››ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰](#-ç¬¬å››ç¯‡æª¢æŸ¥æ¸…å–®checklist)**

### [ç¬¬äº”ç¯‡ï¼šå­¸ç¿’æª¢æ¸¬èˆ‡èªè­‰æº–å‚™](#ç¬¬äº”ç¯‡å­¸ç¿’æª¢æ¸¬èˆ‡èªè­‰æº–å‚™)

- **[14. ç« ç¯€å°æ¸¬é©—](#14-ç« ç¯€å°æ¸¬é©—)**
  - [14.1 ç¬¬ä¸€ç¯‡ï¼šåŸºç¤å…¥é–€ - æ¸¬é©—é¡Œ](#141-ç¬¬ä¸€ç¯‡åŸºç¤å…¥é–€---æ¸¬é©—é¡Œ)
  - [14.2 ç¬¬äºŒç¯‡ï¼šæˆ°ç•¥è¨­è¨ˆ - æ¸¬é©—é¡Œ](#142-ç¬¬äºŒç¯‡æˆ°ç•¥è¨­è¨ˆ---æ¸¬é©—é¡Œ)
  - [14.3 ç¬¬ä¸‰ç¯‡ï¼šæˆ°è¡“è¨­è¨ˆ - æ¸¬é©—é¡Œ](#143-ç¬¬ä¸‰ç¯‡æˆ°è¡“è¨­è¨ˆ---æ¸¬é©—é¡Œ)
  - [14.4 ç¬¬å››ç¯‡ï¼šå¯¦å‹™æ‡‰ç”¨ - æ¸¬é©—é¡Œ](#144-ç¬¬å››ç¯‡å¯¦å‹™æ‡‰ç”¨---æ¸¬é©—é¡Œ)
- **[15. DDD èªè­‰è€ƒè©¦é‡é»æ•´ç†](#15-ddd-èªè­‰è€ƒè©¦é‡é»æ•´ç†)**
  - [15.1 å¿…è€ƒæ ¸å¿ƒæ¦‚å¿µ](#151-å¿…è€ƒæ ¸å¿ƒæ¦‚å¿µ)
  - [15.2 èªè­‰æº–å‚™ç­–ç•¥](#152-èªè­‰æº–å‚™ç­–ç•¥)
- **[16. æ¨¡æ“¬æ¸¬é©—é¡Œåº«](#16-æ¨¡æ“¬æ¸¬é©—é¡Œåº«)**
  - [16.1 ç¶œåˆæ¨¡æ“¬è©¦é¡Œ](#161-ç¶œåˆæ¨¡æ“¬è©¦é¡Œ)
  - [16.2 æ¨¡æ“¬è©¦é¡Œç­”æ¡ˆ](#162-æ¨¡æ“¬è©¦é¡Œç­”æ¡ˆ)
- **[ğŸ’¯ ç¬¬äº”ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰](#-ç¬¬äº”ç¯‡æª¢æŸ¥æ¸…å–®checklist)**

### [é™„éŒ„](#é™„éŒ„)

- **[A. å¿«é€Ÿåƒè€ƒæŒ‡å—](#a-å¿«é€Ÿåƒè€ƒæŒ‡å—)**
  - [A.1 DDD æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨](#a1-ddd-æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨)
- **[B. æˆåŠŸæ¡ˆä¾‹ç ”ç©¶](#b-æˆåŠŸæ¡ˆä¾‹ç ”ç©¶)**
  - [B.1 é›»å•†å¹³å° DDD å¯¦æ–½](#b1-é›»å•†å¹³å°-ddd-å¯¦æ–½)
- **[C. æ¨è–¦è³‡æº](#c-æ¨è–¦è³‡æº)**
  - [C.1 ç¶“å…¸æ›¸ç±](#c1-ç¶“å…¸æ›¸ç±)
  - [C.2 ç·šä¸Šè³‡æº](#c2-ç·šä¸Šè³‡æº)

---

# ç¬¬ä¸€ç¯‡ï¼šåŸºç¤å…¥é–€

## 1. ä»€éº¼æ˜¯ Domain-Driven Design (DDD)

### 1.1 èƒŒæ™¯èˆ‡æ­·å²

Domain-Driven Designï¼ˆé ˜åŸŸé©…å‹•è¨­è¨ˆï¼‰æ˜¯ç”± Eric Evans åœ¨ 2003 å¹´å‡ºç‰ˆçš„åŒåæ›¸ç±ä¸­é¦–æ¬¡ç³»çµ±æ€§æå‡ºçš„è»Ÿé«”é–‹ç™¼æ–¹æ³•è«–ã€‚DDD çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°‡è¤‡é›œçš„æ¥­å‹™é‚è¼¯é€éé ˜åŸŸæ¨¡å‹ä¾†è¡¨é”ï¼Œè®“è»Ÿé«”è¨­è¨ˆæ›´è²¼è¿‘å¯¦éš›æ¥­å‹™éœ€æ±‚ã€‚

#### ğŸ“… DDD ç™¼å±•æ™‚é–“è»¸
```mermaid
timeline
    title DDD ç™¼å±•æ­·ç¨‹
    2003 : Eric Evans å‡ºç‰ˆã€ŠDomain-Driven Designã€‹
    2004-2010 : ç¤¾ç¾¤é–‹å§‹æ¡ç”¨èˆ‡å¯¦è¸
    2013 : Vaughn Vernon å‡ºç‰ˆã€ŠImplementing DDDã€‹
    2016 : Alberto Brandolini æå‡º Event Storming
    2020+ : DDD èˆ‡å¾®æœå‹™æ¶æ§‹å»£æ³›çµåˆ
```

### 1.2 ç‚ºä»€éº¼éœ€è¦ DDD

#### ğŸ” å‚³çµ±é–‹ç™¼æ–¹å¼çš„æŒ‘æˆ°

1. **æ¥­å‹™é‚è¼¯åˆ†æ•£**
   - æ¥­å‹™è¦å‰‡æ•£è½åœ¨å„å€‹å±¤ç´š
   - ç¼ºä¹çµ±ä¸€çš„æ¥­å‹™èªè¨€
   - é›£ä»¥è¿½è¹¤æ¥­å‹™è®Šæ›´çš„å½±éŸ¿

2. **æŠ€è¡“èˆ‡æ¥­å‹™è„«ç¯€**
   - é–‹ç™¼äººå“¡å°ˆæ³¨æ–¼æŠ€è¡“å¯¦ä½œ
   - æ¥­å‹™å°ˆå®¶é›£ä»¥åƒèˆ‡è¨­è¨ˆéç¨‹
   - éœ€æ±‚ç†è§£å­˜åœ¨åå·®

3. **ç³»çµ±è¤‡é›œåº¦é›£ä»¥æ§åˆ¶**
   - ç¼ºä¹æ¸…æ™°çš„é‚Šç•ŒåŠƒåˆ†
   - æ¨¡çµ„é–“è€¦åˆåº¦éé«˜
   - ç¶­è­·æˆæœ¬æŒçºŒä¸Šå‡

#### âœ… DDD å¸¶ä¾†çš„åƒ¹å€¼

```mermaid
mindmap
  root)DDD åƒ¹å€¼(
    æ¥­å‹™å°é½Š
      é€šç”¨èªè¨€
      æ¨¡å‹é©…å‹•
      æŒçºŒå”ä½œ
    è¨­è¨ˆå“è³ª
      æ¸…æ™°é‚Šç•Œ
      é«˜å…§èšä½è€¦åˆ
      å¯æ¸¬è©¦æ€§
    é–‹ç™¼æ•ˆç‡
      æ¸›å°‘æºé€šæˆæœ¬
      é™ä½ç¶­è­·è¤‡é›œåº¦
      æé«˜äº¤ä»˜å“è³ª
    çµ„ç¹”æ•ˆç›Š
      è·¨è·èƒ½å”ä½œ
      çŸ¥è­˜å…±äº«
      å¿«é€ŸéŸ¿æ‡‰è®ŠåŒ–
```

### 1.3 èˆ‡å‚³çµ±é–‹ç™¼æ–¹å¼çš„å·®ç•°

| æ¯”è¼ƒé …ç›® | å‚³çµ±é–‹ç™¼æ–¹å¼ | DDD æ–¹å¼ |
|---------|-------------|----------|
| **é—œæ³¨ç„¦é»** | æŠ€è¡“å¯¦ä½œã€è³‡æ–™åº«è¨­è¨ˆ | æ¥­å‹™é ˜åŸŸã€æ ¸å¿ƒé‚è¼¯ |
| **è¨­è¨ˆèµ·é»** | è³‡æ–™æ¨¡å‹æˆ–æŠ€è¡“æ¶æ§‹ | æ¥­å‹™æ¨¡å‹èˆ‡é ˜åŸŸçŸ¥è­˜ |
| **èªè¨€æºé€š** | æŠ€è¡“è¡“èªç‚ºä¸» | æ¥­å‹™é€šç”¨èªè¨€ |
| **é‚Šç•ŒåŠƒåˆ†** | æŠ€è¡“å±¤ç´šï¼ˆMVCã€ä¸‰å±¤å¼ï¼‰ | æ¥­å‹™é‚Šç•Œï¼ˆé™ç•Œä¸Šä¸‹æ–‡ï¼‰ |
| **è®Šæ›´è™•ç†** | æŠ€è¡“é©…å‹•çš„é‡æ§‹ | æ¥­å‹™é©…å‹•çš„æ¼”é€² |
| **æ¸¬è©¦ç­–ç•¥** | å–®å…ƒæ¸¬è©¦ã€æ•´åˆæ¸¬è©¦ | é ˜åŸŸæ¸¬è©¦ã€æ¥­å‹™è¦å‰‡é©—è­‰ |

#### ğŸ—ï¸ å‚³çµ±åˆ†å±¤æ¶æ§‹ vs DDD æ¶æ§‹

```mermaid
graph TB
    subgraph "å‚³çµ±åˆ†å±¤æ¶æ§‹"
        A1[Presentation Layer] --> A2[Business Logic Layer]
        A2 --> A3[Data Access Layer]
        A3 --> A4[Database]
    end
    
    subgraph "DDD æ¶æ§‹"
        B1[User Interface] --> B2[Application Layer]
        B2 --> B3[Domain Layer]
        B3 --> B4[Infrastructure Layer]
        B4 --> B5[Database/External Services]
    end
```

### ğŸ’¡ å¯¦å‹™æ¡ˆä¾‹ï¼šé›»å•†ç³»çµ±è¨­è¨ˆå·®ç•°

#### å‚³çµ±æ–¹å¼ï¼š
```java
// ä»¥è³‡æ–™è¡¨çµæ§‹ç‚ºä¸­å¿ƒ
public class OrderService {
    public void createOrder(OrderDTO orderDto) {
        // ç›´æ¥æ“ä½œè³‡æ–™åº«
        orderRepository.save(orderDto);
        // æ¥­å‹™é‚è¼¯æ•£è½å„è™•
        if (orderDto.getAmount() > 1000) {
            // æŠ˜æ‰£é‚è¼¯
        }
    }
}
```

#### DDD æ–¹å¼ï¼š
```java
// ä»¥é ˜åŸŸæ¨¡å‹ç‚ºä¸­å¿ƒ
public class Order {
    private OrderId id;
    private CustomerId customerId;
    private Money totalAmount;
    private List<OrderItem> items;
    
    public Order(CustomerId customerId, List<OrderItem> items) {
        this.customerId = customerId;
        this.items = items;
        this.totalAmount = calculateTotal(items);
        this.applyDiscountRules(); // æ¥­å‹™é‚è¼¯å°è£åœ¨é ˜åŸŸç‰©ä»¶ä¸­
    }
    
    private void applyDiscountRules() {
        // é ˜åŸŸè¦å‰‡çš„å¯¦ä½œ
    }
}
```

---

## 2. DDD çš„æ ¸å¿ƒç†å¿µ

### 2.1 Domainï¼ˆé ˜åŸŸï¼‰çš„é‡è¦æ€§

#### ğŸ¯ ä»€éº¼æ˜¯é ˜åŸŸï¼ˆDomainï¼‰

é ˜åŸŸæ˜¯æŒ‡çµ„ç¹”æˆ–ä¼æ¥­æ‰€å°ˆæ³¨çš„ç‰¹å®šæ¥­å‹™ç¯„åœï¼ŒåŒ…å«äº†è©²ç¯„åœå…§çš„æ‰€æœ‰æ¥­å‹™æ¦‚å¿µã€è¦å‰‡ã€æµç¨‹å’Œç´„æŸæ¢ä»¶ã€‚

```mermaid
graph LR
    subgraph "éŠ€è¡Œæ¥­é ˜åŸŸ"
        A[å¸³æˆ¶ç®¡ç†]
        B[äº¤æ˜“è™•ç†]
        C[é¢¨éšªæ§åˆ¶]
        D[æ³•è¦éµå¾ª]
        E[å®¢æˆ¶æœå‹™]
    end
    
    A --- B
    B --- C
    C --- D
    D --- E
    E --- A
```

#### ğŸ” é ˜åŸŸçš„ç‰¹å¾µ

1. **æ¥­å‹™æ ¸å¿ƒæ€§**ï¼šé ˜åŸŸåŒ…å«çµ„ç¹”çš„æ ¸å¿ƒæ¥­å‹™é‚è¼¯
2. **è¤‡é›œæ€§**ï¼šçœŸå¯¦æ¥­å‹™å ´æ™¯å¾€å¾€éå¸¸è¤‡é›œ
3. **è®ŠåŒ–æ€§**ï¼šæ¥­å‹™éœ€æ±‚æŒçºŒæ¼”é€²
4. **å°ˆæ¥­æ€§**ï¼šéœ€è¦é ˜åŸŸå°ˆå®¶çš„æ·±åº¦åƒèˆ‡

### 2.2 Ubiquitous Languageï¼ˆé€šç”¨èªè¨€ï¼‰

#### ğŸ“ å®šç¾©èˆ‡é‡è¦æ€§

é€šç”¨èªè¨€æ˜¯é–‹ç™¼åœ˜éšŠã€æ¥­å‹™å°ˆå®¶ã€åˆ©å®³é—œä¿‚äººä¹‹é–“å…±åŒä½¿ç”¨çš„èªè¨€ï¼Œç¢ºä¿æ‰€æœ‰åƒèˆ‡è€…å°æ¥­å‹™æ¦‚å¿µæœ‰ä¸€è‡´çš„ç†è§£ã€‚

#### ğŸ¯ é€šç”¨èªè¨€çš„å»ºç«‹åŸå‰‡

```mermaid
flowchart TD
    A[è­˜åˆ¥æ ¸å¿ƒæ¦‚å¿µ] --> B[å®šç¾©æ¥­å‹™è¡“èª]
    B --> C[å»ºç«‹è©å½™è¡¨]
    C --> D[åœ¨ä»£ç¢¼ä¸­é«”ç¾]
    D --> E[æŒçºŒç²¾ç…‰]
    E --> A
    
    style A fill:#e1f5fe
    style B fill:#e8f5e8
    style C fill:#fff3e0
    style D fill:#fce4ec
    style E fill:#f3e5f5
```

#### ğŸ“‹ é€šç”¨èªè¨€è©å½™è¡¨ç¯„ä¾‹ï¼ˆé›»å•†é ˜åŸŸï¼‰

| æ¥­å‹™è¡“èª | è‹±æ–‡å°æ‡‰ | å®šç¾© | ä½¿ç”¨å ´æ™¯ |
|---------|----------|------|----------|
| è¨‚å–® | Order | å®¢æˆ¶æäº¤çš„è³¼è²·è«‹æ±‚ | ä¸‹å–®ã€ä»˜æ¬¾ã€å‡ºè²¨ |
| å•†å“ | Product | å¯ä¾›éŠ·å”®çš„ç‰©å“ | å•†å“ç®¡ç†ã€åº«å­˜æ§åˆ¶ |
| è³¼ç‰©è»Š | Cart | å®¢æˆ¶æš«å­˜çš„å¾…è³¼å•†å“ | è³¼ç‰©æµç¨‹ã€çµå¸³ |
| åº«å­˜ | Inventory | å¯ä¾›éŠ·å”®çš„å•†å“æ•¸é‡ | åº«å­˜ç®¡ç†ã€è£œè²¨ |
| å®¢æˆ¶ | Customer | è¨»å†Šä¸¦å¯èƒ½è³¼è²·çš„ä½¿ç”¨è€… | å®¢æˆ¶ç®¡ç†ã€è¨‚å–®è™•ç† |

#### âš ï¸ é€šç”¨èªè¨€çš„æ³¨æ„äº‹é …

1. **é¿å…æŠ€è¡“è¡“èª**ï¼šä¸ä½¿ç”¨ "DTO"ã€"DAO"ã€"Entity" ç­‰æŠ€è¡“æ¦‚å¿µ
2. **ä¿æŒä¸€è‡´æ€§**ï¼šåŒä¸€æ¦‚å¿µåœ¨æ‰€æœ‰åœ°æ–¹ä½¿ç”¨ç›¸åŒåè©
3. **å®šæœŸæª¢è¦–**ï¼šéš¨æ¥­å‹™ç™¼å±•æŒçºŒæ›´æ–°è©å½™å®šç¾©
4. **ä»£ç¢¼å°æ‡‰**ï¼šç¨‹å¼ç¢¼ä¸­çš„é¡åˆ¥ã€æ–¹æ³•åç¨±æ‡‰åæ˜ é€šç”¨èªè¨€

### 2.3 Model-Driven Designï¼ˆæ¨¡å‹é©…å‹•è¨­è¨ˆï¼‰

#### ğŸ¨ è¨­è¨ˆç†å¿µ

æ¨¡å‹é©…å‹•è¨­è¨ˆå¼·èª¿é ˜åŸŸæ¨¡å‹æ˜¯è»Ÿé«”è¨­è¨ˆçš„æ ¸å¿ƒï¼Œæ‰€æœ‰çš„å¯¦ä½œéƒ½æ‡‰è©²å¿ å¯¦åæ˜ é ˜åŸŸæ¨¡å‹ã€‚

```mermaid
graph TB
    A[æ¥­å‹™éœ€æ±‚] --> B[é ˜åŸŸæ¨¡å‹]
    B --> C[è¨­è¨ˆæ¨¡å‹]
    C --> D[å¯¦ä½œä»£ç¢¼]
    D --> E[æ¸¬è©¦é©—è­‰]
    E --> B
    
    style B fill:#ffeb3b,color:#000
```

#### ğŸ—ï¸ æ¨¡å‹è¨­è¨ˆçš„å±¤æ¬¡

1. **æ¦‚å¿µæ¨¡å‹**ï¼šæŠ½è±¡çš„æ¥­å‹™æ¦‚å¿µèˆ‡é—œä¿‚
2. **åˆ†ææ¨¡å‹**ï¼šåŠ å…¥æ›´å¤šæ¥­å‹™è¦å‰‡èˆ‡ç´„æŸ
3. **è¨­è¨ˆæ¨¡å‹**ï¼šè€ƒæ…®æŠ€è¡“å¯¦ä½œçš„å…·é«”æ¨¡å‹
4. **å¯¦ä½œæ¨¡å‹**ï¼šæœ€çµ‚çš„ç¨‹å¼ç¢¼å¯¦ç¾

#### ğŸ“ æ¨¡å‹é©…å‹•è¨­è¨ˆå¯¦ä¾‹

ä»¥ã€Œåœ–æ›¸é¤¨å€Ÿé–±ç³»çµ±ã€ç‚ºä¾‹ï¼š

```java
// é ˜åŸŸæ¨¡å‹ï¼šæœƒå“¡
public class Member {
    private MemberId memberId;
    private String name;
    private MembershipType type;
    private List<BorrowRecord> borrowHistory;
    
    public boolean canBorrow(Book book) {
        // æ¥­å‹™è¦å‰‡ï¼šæª¢æŸ¥å€Ÿé–±è³‡æ ¼
        return !isOverdue() && !exceedsBorrowLimit() && book.isAvailable();
    }
    
    public BorrowRecord borrowBook(Book book) {
        if (!canBorrow(book)) {
            throw new BorrowingNotAllowedException("ç„¡æ³•å€Ÿé–±æ­¤æ›¸ç±");
        }
        // æ¥­å‹™é‚è¼¯çš„å¯¦ä½œ
        book.markAsBorrowed(this);
        BorrowRecord record = new BorrowRecord(this, book, LocalDate.now());
        borrowHistory.add(record);
        return record;
    }
}
```

---

## 3. DDD çš„å…©å¤§é¢å‘

### 3.1 æˆ°ç•¥è¨­è¨ˆ (Strategic Design)

#### ğŸ¯ ç›®æ¨™èˆ‡ç¯„åœ

æˆ°ç•¥è¨­è¨ˆå°ˆæ³¨æ–¼å¤§ç¯„åœçš„æ¶æ§‹æ±ºç­–ï¼Œå¹«åŠ©åœ˜éšŠç†è§£å’ŒåŠƒåˆ†è¤‡é›œçš„æ¥­å‹™é ˜åŸŸã€‚

```mermaid
mindmap
  root)æˆ°ç•¥è¨­è¨ˆ(
    é ˜åŸŸåŠƒåˆ†
      å­åŸŸè­˜åˆ¥
      æ ¸å¿ƒé ˜åŸŸ
      æ”¯æ´é ˜åŸŸ
      é€šç”¨é ˜åŸŸ
    é‚Šç•Œå®šç¾©
      é™ç•Œä¸Šä¸‹æ–‡
      ä¸Šä¸‹æ–‡é‚Šç•Œ
      åœ˜éšŠé‚Šç•Œ
    æ•´åˆç­–ç•¥
      ä¸Šä¸‹æ–‡æ˜ å°„
      é˜²è…å±¤
      é–‹æ”¾ä¸»æ©Ÿæœå‹™
```

#### ğŸ“Š æˆ°ç•¥è¨­è¨ˆçš„ä¸»è¦ç”¢å‡º

1. **é ˜åŸŸé¡˜æ™¯é™³è¿°**ï¼šæ¸…æ¥šæè¿°æ ¸å¿ƒé ˜åŸŸçš„åƒ¹å€¼
2. **å­åŸŸåŠƒåˆ†åœ–**ï¼šè­˜åˆ¥ä¸¦åˆ†é¡å„å€‹å­åŸŸ
3. **é™ç•Œä¸Šä¸‹æ–‡åœ–**ï¼šå®šç¾©å„å€‹ä¸Šä¸‹æ–‡çš„é‚Šç•Œ
4. **ä¸Šä¸‹æ–‡æ˜ å°„åœ–**ï¼šæè¿°ä¸Šä¸‹æ–‡é–“çš„é—œä¿‚

### 3.2 æˆ°è¡“è¨­è¨ˆ (Tactical Design)

#### ğŸ› ï¸ ç›®æ¨™èˆ‡ç¯„åœ

æˆ°è¡“è¨­è¨ˆå°ˆæ³¨æ–¼é™ç•Œä¸Šä¸‹æ–‡å…§éƒ¨çš„æ¨¡å‹è¨­è¨ˆï¼Œæä¾›å…·é«”çš„è¨­è¨ˆæ¨¡å¼å’Œå¯¦ä½œæŒ‡å°ã€‚

```mermaid
graph LR
    subgraph "æˆ°è¡“è¨­è¨ˆæ§‹ä»¶"
        A[Entity å¯¦é«”]
        B[Value Object å€¼ç‰©ä»¶]
        C[Aggregate èšåˆ]
        D[Repository å€‰å„²]
        E[Domain Service é ˜åŸŸæœå‹™]
        F[Factory å·¥å» ]
        G[Domain Event é ˜åŸŸäº‹ä»¶]
    end
    
    C --> A
    C --> B
    A --> D
    E --> A
    F --> A
    A --> G
```

#### ğŸ¨ æˆ°è¡“è¨­è¨ˆæ¨¡å¼ç‰¹å¾µ

| è¨­è¨ˆæ¨¡å¼ | ä¸»è¦è·è²¬ | è­˜åˆ¥ç‰¹å¾µ | å¯¦ä½œé‡é» |
|---------|----------|----------|----------|
| **Entity** | å…·æœ‰å”¯ä¸€è­˜åˆ¥çš„æ¥­å‹™å°è±¡ | æœ‰ç”Ÿå‘½é€±æœŸã€æœƒè®ŠåŒ– | ä¿è­‰è­˜åˆ¥æ€§èˆ‡ä¸€è‡´æ€§ |
| **Value Object** | æè¿°äº‹ç‰©ç‰¹å¾µçš„å€¼ | ä¸å¯è®Šã€å¯æ›¿æ› | å€¼ç›¸ç­‰æ€§èˆ‡ä¸å¯è®Šæ€§ |
| **Aggregate** | è³‡æ–™è®Šæ›´çš„ä¸€è‡´æ€§é‚Šç•Œ | æ¥­å‹™ä¸è®Šæ€§ | äº‹å‹™é‚Šç•Œèˆ‡å°è£ |
| **Repository** | èšåˆçš„å­˜å–ä»‹é¢ | é¡ä¼¼é›†åˆçš„æ“ä½œ | æŠ½è±¡åŒ–è³‡æ–™å­˜å– |
| **Domain Service** | è·¨å¤šå€‹ç‰©ä»¶çš„æ¥­å‹™é‚è¼¯ | ç„¡ç‹€æ…‹çš„æœå‹™ | ç´”ç²¹çš„æ¥­å‹™é‚è¼¯ |

### 3.3 æˆ°ç•¥èˆ‡æˆ°è¡“è¨­è¨ˆçš„é—œä¿‚

```mermaid
flowchart TD
    A[æˆ°ç•¥è¨­è¨ˆ] --> B[è­˜åˆ¥å­åŸŸ]
    B --> C[å®šç¾©é™ç•Œä¸Šä¸‹æ–‡]
    C --> D[æˆ°è¡“è¨­è¨ˆ]
    D --> E[è¨­è¨ˆèšåˆ]
    E --> F[å¯¦ä½œå¯¦é«”èˆ‡å€¼ç‰©ä»¶]
    F --> G[å»ºç«‹å€‰å„²]
    G --> H[å¯¦ä½œé ˜åŸŸæœå‹™]
    
    style A fill:#ff9800,color:white
    style D fill:#4caf50,color:white
```

#### ğŸ”„ è¿­ä»£èˆ‡æ¼”é€²

DDD çš„è¨­è¨ˆæ˜¯ä¸€å€‹æŒçºŒæ¼”é€²çš„éç¨‹ï¼š

1. **æˆ°ç•¥å±¤é¢çš„èª¿æ•´**ï¼šæ ¹æ“šæ¥­å‹™ç™¼å±•èª¿æ•´å­åŸŸåŠƒåˆ†
2. **æˆ°è¡“å±¤é¢çš„ç²¾ç…‰**ï¼šæŒçºŒé‡æ§‹é ˜åŸŸæ¨¡å‹
3. **è·¨å±¤é¢çš„å”èª¿**ï¼šç¢ºä¿æˆ°ç•¥æ±ºç­–èˆ‡æˆ°è¡“å¯¦ä½œçš„ä¸€è‡´æ€§

---

## ğŸ’¯ ç¬¬ä¸€ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰

### âœ… åŸºç¤æ¦‚å¿µç†è§£
- [ ] èƒ½å¤ è§£é‡‹ DDD çš„æ ¸å¿ƒåƒ¹å€¼èˆ‡é©ç”¨å ´æ™¯
- [ ] ç†è§£å‚³çµ±é–‹ç™¼æ–¹å¼èˆ‡ DDD çš„å·®ç•°
- [ ] æŒæ¡é ˜åŸŸã€é€šç”¨èªè¨€ã€æ¨¡å‹é©…å‹•è¨­è¨ˆçš„æ¦‚å¿µ
- [ ] èƒ½å¤ å€åˆ†æˆ°ç•¥è¨­è¨ˆèˆ‡æˆ°è¡“è¨­è¨ˆçš„è·è²¬ç¯„åœ

### âœ… å¯¦å‹™æ‡‰ç”¨æº–å‚™
- [ ] å»ºç«‹åœ˜éšŠçš„é€šç”¨èªè¨€è©å½™è¡¨
- [ ] è­˜åˆ¥å°ˆæ¡ˆä¸­çš„æ ¸å¿ƒæ¥­å‹™é ˜åŸŸ
- [ ] è©•ä¼°ç¾æœ‰ç³»çµ±æ˜¯å¦é©åˆå¼•å…¥ DDD
- [ ] è¦åŠƒ DDD å°å…¥çš„éšæ®µæ€§ç›®æ¨™

### âœ… åœ˜éšŠå”ä½œæ©Ÿåˆ¶
- [ ] å»ºç«‹æ¥­å‹™å°ˆå®¶èˆ‡é–‹ç™¼åœ˜éšŠçš„å”ä½œæ¨¡å¼
- [ ] å®šæœŸæª¢è¦–èˆ‡æ›´æ–°é€šç”¨èªè¨€
- [ ] å»ºç«‹é ˜åŸŸçŸ¥è­˜çš„æ–‡æª”åŒ–æ©Ÿåˆ¶
- [ ] åŸ¹é¤Šæ¨¡å‹é©…å‹•çš„è¨­è¨ˆæ€ç¶­

---

## ğŸ“ ç¬¬ä¸€ç¯‡ç¸½çµ

Domain-Driven Design ä¸åƒ…æ˜¯ä¸€å¥—è¨­è¨ˆæ–¹æ³•è«–ï¼Œæ›´æ˜¯ä¸€ç¨®æ€ç¶­æ–¹å¼çš„è½‰è®Šã€‚å®ƒè¦æ±‚æˆ‘å€‘ï¼š

1. **ä»¥æ¥­å‹™ç‚ºä¸­å¿ƒ**ï¼šå°‡é—œæ³¨é»å¾æŠ€è¡“è½‰å‘æ¥­å‹™åƒ¹å€¼
2. **å»ºç«‹å…±åŒèªè¨€**ï¼šç¢ºä¿åœ˜éšŠå°æ¥­å‹™æœ‰ä¸€è‡´ç†è§£
3. **æ¨¡å‹é©…å‹•è¨­è¨ˆ**ï¼šè®“ä»£ç¢¼å¿ å¯¦åæ˜ æ¥­å‹™æ¨¡å‹
4. **æŒçºŒæ¼”é€²**ï¼šéš¨æ¥­å‹™ç™¼å±•ä¸æ–·ç²¾ç…‰æ¨¡å‹

é€éæˆ°ç•¥è¨­è¨ˆèˆ‡æˆ°è¡“è¨­è¨ˆçš„çµåˆï¼ŒDDD å¹«åŠ©æˆ‘å€‘æ§‹å»ºæ—¢èƒ½æ»¿è¶³æ¥­å‹™éœ€æ±‚ï¼Œåˆå…·æœ‰è‰¯å¥½æŠ€è¡“å“è³ªçš„è»Ÿé«”ç³»çµ±ã€‚

ä¸‹ä¸€ç¯‡æˆ‘å€‘å°‡æ·±å…¥æ¢è¨ **DDD æˆ°ç•¥è¨­è¨ˆ**ï¼Œå­¸ç¿’å¦‚ä½•è­˜åˆ¥å­åŸŸã€åŠƒåˆ†é™ç•Œä¸Šä¸‹æ–‡ï¼Œä»¥åŠå»ºç«‹ä¸Šä¸‹æ–‡æ˜ å°„ã€‚

---

# ç¬¬äºŒç¯‡ï¼šDDD æˆ°ç•¥è¨­è¨ˆ (Strategic Design)

## 4. å­åŸŸ (Subdomain) çš„åˆ†é¡

### 4.1 ä»€éº¼æ˜¯å­åŸŸ

å­åŸŸæ˜¯æ•´å€‹æ¥­å‹™é ˜åŸŸä¸­çš„ä¸€å€‹ç‰¹å®šå€åŸŸï¼Œä»£è¡¨æ¥­å‹™çš„æŸå€‹æ–¹é¢æˆ–åŠŸèƒ½é ˜åŸŸã€‚å°‡è¤‡é›œçš„æ¥­å‹™é ˜åŸŸåˆ†è§£ç‚ºå¤šå€‹å­åŸŸï¼Œæœ‰åŠ©æ–¼åœ˜éšŠæ›´å¥½åœ°ç†è§£å’Œç®¡ç†æ¥­å‹™è¤‡é›œæ€§ã€‚

```mermaid
graph TB
    A[é›»å•†æ¥­å‹™é ˜åŸŸ] --> B[å•†å“ç®¡ç†å­åŸŸ]
    A --> C[è¨‚å–®è™•ç†å­åŸŸ]
    A --> D[å®¢æˆ¶ç®¡ç†å­åŸŸ]
    A --> E[åº«å­˜ç®¡ç†å­åŸŸ]
    A --> F[æ”¯ä»˜è™•ç†å­åŸŸ]
    A --> G[ç‰©æµé…é€å­åŸŸ]
    A --> H[è¡ŒéŠ·æ¨å»£å­åŸŸ]
    
    style A fill:#ff9800,color:white
    style B fill:#4caf50,color:white
    style C fill:#4caf50,color:white
    style D fill:#2196f3,color:white
    style E fill:#2196f3,color:white
    style F fill:#9c27b0,color:white
    style G fill:#9c27b0,color:white
    style H fill:#9c27b0,color:white
```

### 4.2 æ ¸å¿ƒé ˜åŸŸ (Core Domain)

#### ğŸ¯ å®šç¾©èˆ‡ç‰¹å¾µ

æ ¸å¿ƒé ˜åŸŸæ˜¯çµ„ç¹”çš„ç«¶çˆ­å„ªå‹¢æ‰€åœ¨ï¼Œæ˜¯æœ€é‡è¦ä¸”æœ€è¤‡é›œçš„æ¥­å‹™é‚è¼¯é›†ä¸­åœ°ã€‚

**è­˜åˆ¥æ¨™æº–ï¼š**
- ç‚ºçµ„ç¹”å¸¶ä¾†ç«¶çˆ­å„ªå‹¢
- æ¥­å‹™é‚è¼¯è¤‡é›œä¸”ç¨ç‰¹
- ç¶“å¸¸è®ŠåŒ–ä¸”éœ€è¦å¿«é€ŸéŸ¿æ‡‰
- ç„¡æ³•ç°¡å–®å¤–åŒ…æˆ–è³¼è²·ç¾æˆè§£æ±ºæ–¹æ¡ˆ

#### ğŸ’¡ æ ¸å¿ƒé ˜åŸŸå¯¦ä¾‹

| è¡Œæ¥­ | æ ¸å¿ƒé ˜åŸŸ | èªªæ˜ |
|------|----------|------|
| **é›»å•†å¹³å°** | æ¨è–¦æ¼”ç®—æ³•ã€å®šåƒ¹ç­–ç•¥ | å½±éŸ¿ç”¨æˆ¶é«”é©—èˆ‡ç‡Ÿæ”¶çš„é—œéµ |
| **é‡‘èæ¥­** | é¢¨éšªè©•ä¼°ã€æŠ•è³‡ç­–ç•¥ | æ ¸å¿ƒç«¶çˆ­åŠ›èˆ‡ç²åˆ©æ¨¡å¼ |
| **ç‰©æµæ¥­** | è·¯ç·šæœ€ä½³åŒ–ã€é…é€æ’ç¨‹ | æ•ˆç‡èˆ‡æˆæœ¬æ§åˆ¶çš„é—œéµ |
| **è£½é€ æ¥­** | ç”Ÿç”¢æ’ç¨‹ã€å“è³ªæ§åˆ¶ | å½±éŸ¿äº¤æœŸèˆ‡ç”¢å“å“è³ª |

#### ğŸ—ï¸ æ ¸å¿ƒé ˜åŸŸçš„è¨­è¨ˆåŸå‰‡

```mermaid
mindmap
  root)æ ¸å¿ƒé ˜åŸŸè¨­è¨ˆåŸå‰‡(
    æŠ•è³‡å„ªå…ˆ
      æœ€ä½³åœ˜éšŠ
      å……è¶³è³‡æº
      æŒçºŒé‡æ§‹
    æ¨¡å‹ç²¾ç…‰
      æ·±åº¦å»ºæ¨¡
      è±å¯Œè¡Œç‚º
      æ¥­å‹™è¦å‰‡å°è£
    å¿«é€Ÿè¿­ä»£
      é »ç¹ç™¼å¸ƒ
      å¿«é€Ÿåé¥‹
      æŒçºŒæ”¹é€²
    çŸ¥è­˜ä¿è­·
      æ–‡æª”åŒ–
      çŸ¥è­˜åˆ†äº«
      æŠ€èƒ½å‚³æ‰¿
```

### 4.3 æ”¯æ´å­åŸŸ (Supporting Subdomain)

#### ğŸ”§ å®šç¾©èˆ‡ç‰¹å¾µ

æ”¯æ´å­åŸŸé›–ç„¶å°æ¥­å‹™é‹ä½œå¾ˆé‡è¦ï¼Œä½†ä¸æ˜¯çµ„ç¹”çš„æ ¸å¿ƒç«¶çˆ­å„ªå‹¢ï¼Œé€šå¸¸å…·æœ‰ä¸€å®šçš„è¤‡é›œæ€§ä½†è®ŠåŒ–è¼ƒå°‘ã€‚

**è­˜åˆ¥æ¨™æº–ï¼š**
- æ”¯æ´æ ¸å¿ƒæ¥­å‹™é‹ä½œ
- å…·æœ‰ä¸€å®šæ¥­å‹™é‚è¼¯è¤‡é›œæ€§
- è®ŠåŒ–é »ç‡ä¸­ç­‰
- å¯èƒ½æœ‰ç¾æˆè§£æ±ºæ–¹æ¡ˆä½†éœ€è¦å®¢è£½åŒ–

#### ğŸ“Š æ”¯æ´å­åŸŸç‰¹å¾µåˆ†æ

```mermaid
radar
    title æ”¯æ´å­åŸŸç‰¹å¾µé›·é”åœ–
    ["æ¥­å‹™é‡è¦æ€§" : 0.7]
    ["æŠ€è¡“è¤‡é›œåº¦" : 0.6]
    ["è®ŠåŒ–é »ç‡" : 0.4]
    ["ç«¶çˆ­å„ªå‹¢" : 0.3]
    ["å®¢è£½åŒ–éœ€æ±‚" : 0.6]
    ["æŠ•è³‡å„ªå…ˆç´š" : 0.5]
```

#### ğŸ’¼ æ”¯æ´å­åŸŸå¯¦ä¾‹

| é ˜åŸŸ | æ”¯æ´å­åŸŸç¯„ä¾‹ | è™•ç†ç­–ç•¥ |
|------|-------------|----------|
| **é›»å•†** | æœƒå“¡ç®¡ç†ã€è¨‚å–®è¿½è¹¤ | å…§éƒ¨é–‹ç™¼æˆ–å®¢è£½åŒ–å¥—è£è»Ÿé«” |
| **éŠ€è¡Œ** | å®¢æˆ¶æœå‹™ã€å ±è¡¨ç³»çµ± | æ¡ç”¨æˆç†Ÿæ¡†æ¶å¿«é€Ÿé–‹ç™¼ |
| **è£½é€ ** | å“¡å·¥æ’ç­ã€è¨­å‚™ç¶­è­· | è³¼è²·å•†ç”¨è»Ÿé«”ä¸¦æ•´åˆ |

### 4.4 é€šç”¨å­åŸŸ (Generic Subdomain)

#### âš™ï¸ å®šç¾©èˆ‡ç‰¹å¾µ

é€šç”¨å­åŸŸæ˜¯æ‰€æœ‰çµ„ç¹”éƒ½éœ€è¦çš„åŸºç¤åŠŸèƒ½ï¼Œæ²’æœ‰æ¥­å‹™å·®ç•°åŒ–åƒ¹å€¼ï¼Œé€šå¸¸æœ‰æˆç†Ÿçš„å¸‚å ´è§£æ±ºæ–¹æ¡ˆã€‚

**è­˜åˆ¥æ¨™æº–ï¼š**
- è·¨è¡Œæ¥­çš„å…±é€šéœ€æ±‚
- æ²’æœ‰æ¥­å‹™ç‰¹æ®Šæ€§
- æœ‰ç¾æˆçš„æˆç†Ÿè§£æ±ºæ–¹æ¡ˆ
- ä¸éœ€è¦æ·±åº¦å®¢è£½åŒ–

#### ğŸ› ï¸ é€šç”¨å­åŸŸè™•ç†ç­–ç•¥

```mermaid
flowchart LR
    A[è­˜åˆ¥é€šç”¨å­åŸŸ] --> B{è©•ä¼°é¸é …}
    B --> C[è³¼è²·ç¾æˆè»Ÿé«”]
    B --> D[ä½¿ç”¨é–‹æºæ–¹æ¡ˆ]
    B --> E[å¤–åŒ…é–‹ç™¼]
    B --> F[é›²ç«¯æœå‹™]
    
    C --> G[æ•´åˆèˆ‡é…ç½®]
    D --> G
    E --> G
    F --> G
    
    style B fill:#ffc107
    style G fill:#4caf50,color:white
```

#### ğŸ“‹ å¸¸è¦‹é€šç”¨å­åŸŸ

| é¡åˆ¥ | åŠŸèƒ½ | å»ºè­°è§£æ±ºæ–¹æ¡ˆ |
|------|------|-------------|
| **èªè­‰æˆæ¬Š** | ç”¨æˆ¶ç™»å…¥ã€æ¬Šé™ç®¡ç† | OAuth 2.0ã€Auth0ã€Keycloak |
| **é€šè¨Šæœå‹™** | éƒµä»¶ã€ç°¡è¨Šã€æ¨æ’­ | SendGridã€Twilioã€FCM |
| **æ”¯ä»˜è™•ç†** | ä¿¡ç”¨å¡ã€é›»å­æ”¯ä»˜ | Stripeã€PayPalã€ç¶ ç•Œ |
| **æª”æ¡ˆå„²å­˜** | æ–‡ä»¶ä¸Šå‚³ã€åœ–ç‰‡è™•ç† | AWS S3ã€Cloudinaryã€Google Cloud |
| **ç›£æ§æ—¥èªŒ** | ç³»çµ±ç›£æ§ã€éŒ¯èª¤è¿½è¹¤ | ELK Stackã€Datadogã€Sentry |

### 4.5 å­åŸŸåˆ†é¡å¯¦å‹™å·¥ä½œåŠ

#### ğŸ¯ åˆ†é¡æ­¥é©Ÿ

1. **æ¥­å‹™æ´»å‹•åˆ—èˆ‰**ï¼šåˆ—å‡ºæ‰€æœ‰æ¥­å‹™æ´»å‹•èˆ‡åŠŸèƒ½
2. **åƒ¹å€¼è©•ä¼°**ï¼šè©•ä¼°æ¯å€‹æ´»å‹•å°çµ„ç¹”çš„åƒ¹å€¼è²¢ç»
3. **è¤‡é›œåº¦åˆ†æ**ï¼šåˆ†ææ¥­å‹™é‚è¼¯çš„è¤‡é›œç¨‹åº¦
4. **è®ŠåŒ–é »ç‡**ï¼šè©•ä¼°éœ€æ±‚è®ŠåŒ–çš„é »ç‡
5. **å¸‚å ´è§£æ±ºæ–¹æ¡ˆ**ï¼šèª¿æŸ¥ç¾æœ‰çš„å¸‚å ´è§£æ±ºæ–¹æ¡ˆ
6. **åˆ†é¡æ±ºç­–**ï¼šæ ¹æ“šä»¥ä¸Šåˆ†æé€²è¡Œåˆ†é¡

#### ğŸ“ åˆ†é¡è©•ä¼°è¡¨

| è©•ä¼°ç¶­åº¦ | æ ¸å¿ƒé ˜åŸŸ | æ”¯æ´å­åŸŸ | é€šç”¨å­åŸŸ |
|---------|----------|----------|----------|
| **æ¥­å‹™åƒ¹å€¼** | æ¥µé«˜ (9-10) | ä¸­é«˜ (6-8) | ä½ä¸­ (1-5) |
| **ç«¶çˆ­å„ªå‹¢** | é¡¯è‘— | æœ‰é™ | ç„¡ |
| **è¤‡é›œåº¦** | é«˜ | ä¸­ | ä½ |
| **è®ŠåŒ–é »ç‡** | é«˜ | ä¸­ | ä½ |
| **ç¾æˆæ–¹æ¡ˆ** | ç„¡æˆ–ä¸é©ç”¨ | éœ€å®¢è£½åŒ– | æœ‰æˆç†Ÿæ–¹æ¡ˆ |

---

## 5. é™ç•Œä¸Šä¸‹æ–‡ (Bounded Context)

### 5.1 å®šç¾©èˆ‡è­˜åˆ¥æ–¹æ³•

#### ğŸ¯ ä»€éº¼æ˜¯é™ç•Œä¸Šä¸‹æ–‡

é™ç•Œä¸Šä¸‹æ–‡æ˜¯ä¸€å€‹æ˜ç¢ºçš„é‚Šç•Œï¼Œåœ¨é€™å€‹é‚Šç•Œå…§ï¼Œé ˜åŸŸæ¨¡å‹å…·æœ‰ç‰¹å®šçš„æ„ç¾©å’Œä¸€è‡´æ€§ã€‚æ¯å€‹é™ç•Œä¸Šä¸‹æ–‡éƒ½æœ‰è‡ªå·±çš„é€šç”¨èªè¨€å’Œæ¨¡å‹ã€‚

```mermaid
graph LR
    subgraph "é›»å•†ç³»çµ±"
        subgraph "å•†å“ç›®éŒ„ä¸Šä¸‹æ–‡"
            A1[Product<br/>å•†å“è³‡è¨Š]
            A2[Category<br/>åˆ†é¡]
            A3[Price<br/>å®šåƒ¹]
        end
        
        subgraph "è¨‚å–®è™•ç†ä¸Šä¸‹æ–‡"
            B1[Product<br/>è¨‚è³¼é …ç›®]
            B2[Order<br/>è¨‚å–®]
            B3[Customer<br/>è³¼è²·è€…]
        end
        
        subgraph "åº«å­˜ç®¡ç†ä¸Šä¸‹æ–‡"
            C1[Product<br/>åº«å­˜å•†å“]
            C2[Stock<br/>åº«å­˜é‡]
            C3[Warehouse<br/>å€‰åº«]
        end
    end
    
    A1 -.-> B1
    A1 -.-> C1
```

**æ³¨æ„**ï¼šåŒä¸€å€‹ "Product" æ¦‚å¿µåœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­æœ‰ä¸åŒçš„å«ç¾©å’Œå±¬æ€§ã€‚

### 5.2 ç•Œå®šä¸Šä¸‹æ–‡çš„æº–å‰‡

#### ğŸ” è­˜åˆ¥æº–å‰‡

1. **èªè¨€é‚Šç•Œ**ï¼šä¸åŒåœ˜éšŠä½¿ç”¨ä¸åŒè¡“èªæè¿°ç›¸åŒæ¦‚å¿µ
2. **è³‡æ–™é‚Šç•Œ**ï¼šä¸åŒçš„è³‡æ–™çµæ§‹å’Œå­˜å–æ¨¡å¼
3. **æ¥­å‹™é‚Šç•Œ**ï¼šä¸åŒçš„æ¥­å‹™è¦å‰‡å’Œæµç¨‹
4. **åœ˜éšŠé‚Šç•Œ**ï¼šä¸åŒåœ˜éšŠè² è²¬çš„åŠŸèƒ½æ¨¡çµ„
5. **æŠ€è¡“é‚Šç•Œ**ï¼šä¸åŒçš„æŠ€è¡“æ£§æˆ–éƒ¨ç½²å–®å…ƒ

#### ğŸ“Š ä¸Šä¸‹æ–‡è­˜åˆ¥çŸ©é™£

```mermaid
graph TB
    A[æ¥­å‹™åŠŸèƒ½] --> B{èªè¨€ä¸€è‡´æ€§?}
    B -->|æ˜¯| C{è³‡æ–™æ¨¡å‹ä¸€è‡´?}
    B -->|å¦| D[ä¸åŒä¸Šä¸‹æ–‡]
    C -->|æ˜¯| E{æ¥­å‹™è¦å‰‡ä¸€è‡´?}
    C -->|å¦| D
    E -->|æ˜¯| F[åŒä¸€ä¸Šä¸‹æ–‡]
    E -->|å¦| D
    
    style F fill:#4caf50,color:white
    style D fill:#f44336,color:white
```

### 5.3 é™ç•Œä¸Šä¸‹æ–‡çš„é‚Šç•ŒåŠƒåˆ†ç¯„ä¾‹

#### ğŸ’¼ éŠ€è¡Œç³»çµ±ç¯„ä¾‹

```mermaid
graph TB
    subgraph "éŠ€è¡Œæ ¸å¿ƒç³»çµ±"
        subgraph "å¸³æˆ¶ç®¡ç†ä¸Šä¸‹æ–‡"
            A1[Account<br/>å¸³æˆ¶é¤˜é¡ã€ç‹€æ…‹]
            A2[Customer<br/>å¸³æˆ¶æŒæœ‰äºº]
            A3[Transaction<br/>å¸³æˆ¶ç•°å‹•]
        end
        
        subgraph "è²¸æ¬¾è™•ç†ä¸Šä¸‹æ–‡"
            B1[Application<br/>è²¸æ¬¾ç”³è«‹]
            B2[Customer<br/>ç”³è«‹äºº]
            B3[CreditScore<br/>ä¿¡ç”¨è©•åˆ†]
        end
        
        subgraph "é¢¨éšªç®¡æ§ä¸Šä¸‹æ–‡"
            C1[RiskProfile<br/>é¢¨éšªæª”æ¡ˆ]
            C2[Customer<br/>é¢¨éšªä¸»é«”]
            C3[RiskAssessment<br/>é¢¨éšªè©•ä¼°]
        end
        
        subgraph "å®¢æˆ¶æœå‹™ä¸Šä¸‹æ–‡"
            D1[Customer<br/>æœå‹™å°è±¡]
            D2[ServiceRequest<br/>æœå‹™ç”³è«‹]
            D3[ContactHistory<br/>è¯çµ¡ç´€éŒ„]
        end
    end
```

#### ğŸ¥ é†«é™¢ç³»çµ±ç¯„ä¾‹

| ä¸Šä¸‹æ–‡ | ä¸»è¦æ¦‚å¿µ | Patient çš„ä¸åŒå«ç¾© |
|--------|----------|-------------------|
| **æ›è™Ÿæ’ç¨‹** | Appointment, Schedule | å¾…è¨ºç—…äºº (åŸºæœ¬è³‡è¨Šã€é ç´„æ™‚é–“) |
| **è¨ºç™‚ç´€éŒ„** | Diagnosis, Treatment | å°±è¨ºç—…äºº (ç—…å²ã€ç—‡ç‹€ã€è¨ºæ–·) |
| **è¨ˆè²»æ”¶è²»** | Bill, Payment | ä»˜è²»å°è±¡ (è²»ç”¨é …ç›®ã€ä¿éšªè³‡è¨Š) |
| **è—¥å“ç®¡ç†** | Prescription, Medicine | ç”¨è—¥å°è±¡ (éæ•å²ã€ç”¨è—¥ç´€éŒ„) |

### 5.4 ä¸Šä¸‹æ–‡å¤§å°çš„è€ƒé‡

#### âš–ï¸ å¤§ä¸Šä¸‹æ–‡ vs å°ä¸Šä¸‹æ–‡

```mermaid
graph LR
    subgraph "å¤§ä¸Šä¸‹æ–‡ç‰¹å¾µ"
        A1[æ¸›å°‘æ•´åˆè¤‡é›œåº¦]
        A2[çµ±ä¸€è³‡æ–™æ¨¡å‹]
        A3[åœ˜éšŠå”ä½œæˆæœ¬é«˜]
        A4[éƒ¨ç½²ç›¸ä¾æ€§å¼·]
    end
    
    subgraph "å°ä¸Šä¸‹æ–‡ç‰¹å¾µ"
        B1[æ¸…æ™°çš„è·è²¬é‚Šç•Œ]
        B2[ç¨ç«‹æ¼”é€²èƒ½åŠ›]
        B3[å¢åŠ æ•´åˆå·¥ä½œ]
        B4[å¯èƒ½éåº¦è¨­è¨ˆ]
    end
    
    style A1 fill:#ff9800
    style A4 fill:#f44336
    style B1 fill:#4caf50
    style B3 fill:#ff9800
```

#### ğŸ¯ æœ€ä½³å¯¦å‹™å»ºè­°

1. **ä»¥åœ˜éšŠè¦æ¨¡ç‚ºåŸºæº–**ï¼šä¸€å€‹åœ˜éšŠ (7Â±2 äºº) è² è²¬ä¸€å€‹ä¸Šä¸‹æ–‡
2. **è€ƒæ…®è®ŠåŒ–é »ç‡**ï¼šè®ŠåŒ–é »ç‡ç›¸ä¼¼çš„åŠŸèƒ½æ”¾åœ¨åŒä¸€ä¸Šä¸‹æ–‡
3. **è©•ä¼°è³‡æ–™ä¸€è‡´æ€§éœ€æ±‚**ï¼šå¼·ä¸€è‡´æ€§éœ€æ±‚çš„åŠŸèƒ½åˆä½µä¸Šä¸‹æ–‡
4. **é¿å…éæ—©åˆ†å‰²**ï¼šå¾è¼ƒå¤§ä¸Šä¸‹æ–‡é–‹å§‹ï¼Œæ ¹æ“šéœ€è¦åˆ†å‰²

---

## 6. ä¸Šä¸‹æ–‡æ˜ å°„ (Context Mapping)

### 6.1 Context Map åŸºæœ¬åœ–ç¤º

#### ğŸ“Š ä¸Šä¸‹æ–‡æ˜ å°„åœ–

ä¸Šä¸‹æ–‡æ˜ å°„åœ–æè¿°äº†ä¸åŒé™ç•Œä¸Šä¸‹æ–‡ä¹‹é–“çš„é—œä¿‚å’Œæ•´åˆæ¨¡å¼ã€‚

```mermaid
graph LR
    subgraph "é›»å•†å¹³å°ä¸Šä¸‹æ–‡æ˜ å°„"
        A[å•†å“ç›®éŒ„] 
        B[è¨‚å–®è™•ç†]
        C[åº«å­˜ç®¡ç†]
        D[å®¢æˆ¶ç®¡ç†]
        E[æ”¯ä»˜è™•ç†]
        F[ç‰©æµé…é€]
        
        A -->|Customer-Supplier| B
        B -->|Partnership| C
        C -->|Conformist| A
        D -->|Shared Kernel| B
        E -->|Anti-Corruption Layer| B
        F -->|Open Host Service| B
    end
```

### 6.2 ä¸Šä¸‹æ–‡ä¹‹é–“çš„é—œä¿‚æ¨¡å¼

#### ğŸ¤ Partnershipï¼ˆå¤¥ä¼´é—œä¿‚ï¼‰

**ç‰¹å¾µï¼š**
- å…©å€‹ä¸Šä¸‹æ–‡éœ€è¦å”èª¿ç™¼å±•
- å…±åŒçš„ç™¼å¸ƒæ’ç¨‹
- äº’ç›¸ä¾è³´çš„æˆåŠŸæ¨™æº–

```mermaid
graph LR
    A[è¨‚å–®ç®¡ç†] <--> B[åº«å­˜ç®¡ç†]
    
    style A fill:#4caf50,color:white
    style B fill:#4caf50,color:white
```

**æ‡‰ç”¨å ´æ™¯ï¼š**
- è¨‚å–®è™•ç†èˆ‡åº«å­˜ç®¡ç†éœ€è¦å³æ™‚åŒæ­¥
- æ”¯ä»˜è™•ç†èˆ‡è¨‚å–®ç‹€æ…‹éœ€è¦å¼·ä¸€è‡´æ€§

#### ğŸ”„ Shared Kernelï¼ˆå…±äº«æ ¸å¿ƒï¼‰

**ç‰¹å¾µï¼š**
- å…±äº«éƒ¨åˆ†é ˜åŸŸæ¨¡å‹
- éœ€è¦å¯†åˆ‡å”èª¿è®Šæ›´
- æ¸›å°‘é‡è¤‡ä½†å¢åŠ è€¦åˆ

```mermaid
graph TB
    A[å®¢æˆ¶ç®¡ç†ä¸Šä¸‹æ–‡]
    B[è¨‚å–®è™•ç†ä¸Šä¸‹æ–‡]
    C[å…±äº«å®¢æˆ¶æ¨¡å‹]
    
    A --- C
    B --- C
    
    style C fill:#ff9800,color:white
```

**å¯¦ä½œè€ƒé‡ï¼š**
```java
// å…±äº«çš„å®¢æˆ¶æ¨¡å‹
public class SharedCustomerModel {
    private CustomerId id;
    private String name;
    private Email email;
    // åªåŒ…å«å…©å€‹ä¸Šä¸‹æ–‡éƒ½éœ€è¦çš„æ ¸å¿ƒå±¬æ€§
}
```

#### ğŸ‘¥ Customer-Supplierï¼ˆå®¢æˆ¶-ä¾›æ‡‰å•†ï¼‰

**ç‰¹å¾µï¼š**
- ä¸Šæ¸¸ä¾›æ‡‰å•†ç‚ºä¸‹æ¸¸å®¢æˆ¶æä¾›æœå‹™
- ä¸‹æ¸¸éœ€æ±‚é©…å‹•ä¸Šæ¸¸é–‹ç™¼
- æ˜ç¢ºçš„æœå‹™åˆç´„

```mermaid
graph LR
    A[å•†å“ç›®éŒ„<br/>Supplier] --> B[è¨‚å–®è™•ç†<br/>Customer]
    
    style A fill:#2196f3,color:white
    style B fill:#ff9800,color:white
```

**å¯¦ä½œæ¨¡å¼ï¼š**
- RESTful API ä»‹é¢
- äº‹ä»¶ç™¼å¸ƒ-è¨‚é–±
- æœå‹™ç­‰ç´šå”è­° (SLA)

#### ğŸ™‡ Conformistï¼ˆé †å¾è€…ï¼‰

**ç‰¹å¾µï¼š**
- ä¸‹æ¸¸å®Œå…¨éµå¾ªä¸Šæ¸¸æ¨¡å‹
- æ²’æœ‰å”å•†èƒ½åŠ›
- é€šå¸¸ç”¨æ–¼æ•´åˆå¤–éƒ¨ç³»çµ±

```mermaid
graph LR
    A[ç¬¬ä¸‰æ–¹æ”¯ä»˜<br/>ä¸Šæ¸¸] --> B[æœ¬åœ°è¨‚å–®<br/>ä¸‹æ¸¸]
    
    style A fill:#9c27b0,color:white
    style B fill:#ff5722,color:white
```

#### ğŸ›¡ï¸ Anti-Corruption Layerï¼ˆé˜²è…å±¤ï¼‰

**ç‰¹å¾µï¼š**
- ä¿è­·ä¸‹æ¸¸æ¨¡å‹ä¸å—ä¸Šæ¸¸å½±éŸ¿
- è½‰è­¯å’Œé©é…å¤–éƒ¨æ¨¡å‹
- éš”é›¢è®ŠåŒ–å½±éŸ¿

```mermaid
graph LR
    A[å¤–éƒ¨ ERP ç³»çµ±] --> B[é˜²è…å±¤] --> C[å…§éƒ¨è¨‚å–®ç³»çµ±]
    
    style B fill:#4caf50,color:white
```

**å¯¦ä½œç¯„ä¾‹ï¼š**
```java
// é˜²è…å±¤ï¼šè½‰è­¯å¤–éƒ¨æ¨¡å‹åˆ°å…§éƒ¨æ¨¡å‹
public class ERPOrderAdapter {
    public InternalOrder translate(ERPOrderData erpOrder) {
        return InternalOrder.builder()
            .orderId(OrderId.from(erpOrder.getExternalId()))
            .customerInfo(translateCustomer(erpOrder.getCustomerData()))
            .items(translateItems(erpOrder.getLineItems()))
            .build();
    }
}
```

#### ğŸŒ Open Host Serviceï¼ˆé–‹æ”¾ä¸»æ©Ÿæœå‹™ï¼‰

**ç‰¹å¾µï¼š**
- å®šç¾©å…¬é–‹çš„æœå‹™å”è­°
- ç‚ºå¤šå€‹ä¸‹æ¸¸æä¾›æœå‹™
- æœå‹™ä»‹é¢ç©©å®šä¸”ç‰ˆæœ¬åŒ–

```mermaid
graph TB
    A[å®¢æˆ¶ç®¡ç†<br/>Open Host Service]
    A --> B[è¨‚å–®è™•ç†]
    A --> C[å®¢æˆ¶æœå‹™]
    A --> D[è¡ŒéŠ·æ´»å‹•]
    
    style A fill:#4caf50,color:white
```

#### ğŸ”’ Separate Waysï¼ˆå„è¡Œå…¶é“ï¼‰

**ç‰¹å¾µï¼š**
- æ²’æœ‰æ•´åˆé—œä¿‚
- å„è‡ªç¨ç«‹æ¼”é€²
- å¯èƒ½é‡è¤‡å¯¦ä½œç›¸ä¼¼åŠŸèƒ½

```mermaid
graph LR
    A[å…§éƒ¨å®¢æœç³»çµ±] âš¡ B[å¤–éƒ¨è¡ŒéŠ·å¹³å°]
    
    style A fill:#607d8b,color:white
    style B fill:#607d8b,color:white
```

### 6.3 æ•´åˆæ¨¡å¼é¸æ“‡æŒ‡å—

#### ğŸ¯ æ±ºç­–çŸ©é™£

| æ•´åˆæ¨¡å¼ | è€¦åˆåº¦ | é–‹ç™¼æˆæœ¬ | ç¶­è­·æˆæœ¬ | é©ç”¨å ´æ™¯ |
|---------|--------|----------|----------|----------|
| **Shared Kernel** | é«˜ | ä½ | é«˜ | ç·Šå¯†åˆä½œçš„åœ˜éšŠ |
| **Partnership** | ä¸­é«˜ | ä¸­ | ä¸­é«˜ | éœ€è¦å”èª¿æ¼”é€² |
| **Customer-Supplier** | ä¸­ | ä¸­ | ä¸­ | æ˜ç¢ºä¸Šä¸‹æ¸¸é—œä¿‚ |
| **Conformist** | ä¸­ | ä½ | ä¸­ | ç„¡å”å•†èƒ½åŠ› |
| **Anti-Corruption Layer** | ä½ | é«˜ | ä¸­ | ä¿è­·å…§éƒ¨æ¨¡å‹ |
| **Open Host Service** | ä½ | ä¸­ | ä½ | ä¸€å°å¤šæœå‹™ |
| **Separate Ways** | ç„¡ | ä½ | ä½ | ç„¡æ•´åˆéœ€æ±‚ |

---

## 7. æ¡ˆä¾‹åˆ†æ

### 7.1 å¦‚ä½•å°‡çœŸå¯¦å°ˆæ¡ˆåˆ‡åˆ†ç‚ºå­åŸŸèˆ‡é™ç•Œä¸Šä¸‹æ–‡

#### ğŸ¦ æ¡ˆä¾‹ï¼šç¶²è·¯éŠ€è¡Œç³»çµ±

**æ­¥é©Ÿ 1ï¼šæ¥­å‹™åŠŸèƒ½è­˜åˆ¥**

```mermaid
mindmap
  root)ç¶²è·¯éŠ€è¡Œ(
    å¸³æˆ¶æœå‹™
      é–‹æˆ¶
      éŠ·æˆ¶
      å¸³æˆ¶æŸ¥è©¢
      å¸³æˆ¶ç•°å‹•
    è½‰å¸³æœå‹™
      è½‰å¸³äº¤æ˜“
      äº¤æ˜“æŸ¥è©¢
      äº¤æ˜“é™é¡
      äº¤æ˜“æˆæ¬Š
    è²¸æ¬¾æœå‹™
      è²¸æ¬¾ç”³è«‹
      ä¿¡ç”¨è©•ä¼°
      è²¸æ¬¾å¯©æ ¸
      é‚„æ¬¾ç®¡ç†
    æŠ•è³‡æœå‹™
      åŸºé‡‘ç”³è³¼
      è‚¡ç¥¨äº¤æ˜“
      æŠ•è³‡çµ„åˆ
      é¢¨éšªè©•ä¼°
    å®¢æˆ¶æœå‹™
      å®¢æˆ¶è³‡æ–™
      å®¢æˆ¶é©—è­‰
      å®¢æœç´€éŒ„
      ç”³è¨´è™•ç†
```

**æ­¥é©Ÿ 2ï¼šå­åŸŸåˆ†é¡**

| å­åŸŸ | åˆ†é¡ | ç†ç”± | æŠ•è³‡ç­–ç•¥ |
|------|------|------|----------|
| **é¢¨éšªæ§åˆ¶** | æ ¸å¿ƒé ˜åŸŸ | éŠ€è¡Œç«¶çˆ­å„ªå‹¢ï¼Œè¤‡é›œæ¼”ç®—æ³• | æœ€ä½³åœ˜éšŠï¼Œè‡ªä¸»é–‹ç™¼ |
| **äº¤æ˜“è™•ç†** | æ ¸å¿ƒé ˜åŸŸ | æ¥­å‹™æ ¸å¿ƒï¼Œé«˜å¯é æ€§éœ€æ±‚ | é‡é»æŠ•è³‡ï¼ŒæŒçºŒå„ªåŒ– |
| **å®¢æˆ¶ç®¡ç†** | æ”¯æ´å­åŸŸ | é‡è¦ä½†éæ ¸å¿ƒç«¶çˆ­åŠ› | ç©©å¥é–‹ç™¼ï¼Œé©åº¦æŠ•è³‡ |
| **å ±è¡¨ç³»çµ±** | æ”¯æ´å­åŸŸ | æ³•è¦è¦æ±‚ï¼Œè¤‡é›œä½†ç©©å®š | æ¡†æ¶é–‹ç™¼ï¼Œæ•ˆç‡å„ªå…ˆ |
| **èªè­‰æˆæ¬Š** | é€šç”¨å­åŸŸ | æ¨™æº–åŒ–åŠŸèƒ½ | æ¡è³¼æˆ–é–‹æºæ–¹æ¡ˆ |
| **é€šçŸ¥æœå‹™** | é€šç”¨å­åŸŸ | åŸºç¤è¨­æ–½åŠŸèƒ½ | é›²ç«¯æœå‹™æˆ–ç¬¬ä¸‰æ–¹ |

**æ­¥é©Ÿ 3ï¼šé™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†**

```mermaid
graph TB
    subgraph "æ ¸å¿ƒéŠ€è¡Œç³»çµ±"
        subgraph "å¸³æˆ¶ç®¡ç†ä¸Šä¸‹æ–‡"
            A1[Account å¸³æˆ¶å¯¦é«”]
            A2[Customer å¸³æˆ¶æŒæœ‰äºº]
            A3[Balance é¤˜é¡ç®¡ç†]
        end
        
        subgraph "äº¤æ˜“è™•ç†ä¸Šä¸‹æ–‡"
            B1[Transaction äº¤æ˜“è¨˜éŒ„]
            B2[TransferService è½‰å¸³æœå‹™]
            B3[Account äº¤æ˜“ä¸»é«”]
        end
        
        subgraph "é¢¨éšªç®¡æ§ä¸Šä¸‹æ–‡"
            C1[RiskProfile é¢¨éšªæª”æ¡ˆ]
            C2[RiskRule é¢¨éšªè¦å‰‡]
            C3[RiskAssessment é¢¨éšªè©•ä¼°]
        end
        
        subgraph "è²¸æ¬¾æ¥­å‹™ä¸Šä¸‹æ–‡"
            D1[LoanApplication è²¸æ¬¾ç”³è«‹]
            D2[CreditScore ä¿¡ç”¨è©•åˆ†]
            D3[Customer å€Ÿæ¬¾äºº]
        end
    end
```

### 7.2 åˆ†æéŠ€è¡Œ/é‡‘èç³»çµ±æ¡ˆä¾‹

#### ğŸ’° ä¸Šä¸‹æ–‡æ˜ å°„é—œä¿‚

```mermaid
graph LR
    A[å¸³æˆ¶ç®¡ç†] 
    B[äº¤æ˜“è™•ç†]
    C[é¢¨éšªç®¡æ§]
    D[è²¸æ¬¾æ¥­å‹™]
    E[å®¢æˆ¶ç®¡ç†]
    F[å¤–éƒ¨å¾µä¿¡]
    
    A -->|Customer-Supplier| B
    B -->|Partnership| C
    C -->|Anti-Corruption Layer| F
    E -->|Shared Kernel| A
    E -->|Shared Kernel| D
    
    style C fill:#ff9800,color:white
    style F fill:#9c27b0,color:white
```

#### ğŸ”„ æ•´åˆæ¨¡å¼èªªæ˜

1. **å¸³æˆ¶ç®¡ç† â†’ äº¤æ˜“è™•ç† (Customer-Supplier)**
   ```java
   // å¸³æˆ¶ç®¡ç†æä¾›å¸³æˆ¶é©—è­‰æœå‹™
   public interface AccountValidationService {
       ValidationResult validateAccount(AccountId accountId);
       AccountStatus getAccountStatus(AccountId accountId);
   }
   ```

2. **äº¤æ˜“è™•ç† â†” é¢¨éšªç®¡æ§ (Partnership)**
   ```java
   // é›™å‘ä¾è³´ï¼šäº¤æ˜“è§¸ç™¼é¢¨éšªæª¢æŸ¥ï¼Œé¢¨éšªçµæœå½±éŸ¿äº¤æ˜“
   @EventHandler
   public class RiskAssessmentHandler {
       public void handle(TransactionInitiated event) {
           RiskAssessment assessment = riskEngine.assess(event);
           if (assessment.isHighRisk()) {
               transactionService.flagForReview(event.getTransactionId());
           }
       }
   }
   ```

3. **é¢¨éšªç®¡æ§ â†’ å¤–éƒ¨å¾µä¿¡ (Anti-Corruption Layer)**
   ```java
   // é˜²è…å±¤è½‰è­¯å¤–éƒ¨å¾µä¿¡è³‡æ–™
   public class CreditBureauAdapter {
       public CreditScore translateScore(ExternalCreditData data) {
           return CreditScore.builder()
               .score(normalizeScore(data.getRawScore()))
               .riskLevel(mapRiskLevel(data.getRiskCategory()))
               .build();
       }
   }
   ```

#### ğŸ“Š å¯¦ä½œæ¶æ§‹åœ–

```mermaid
graph TB
    subgraph "API Gateway"
        API[çµ±ä¸€ API å…¥å£]
    end
    
    subgraph "æ‡‰ç”¨æœå‹™å±¤"
        AS1[å¸³æˆ¶æ‡‰ç”¨æœå‹™]
        AS2[äº¤æ˜“æ‡‰ç”¨æœå‹™]
        AS3[é¢¨éšªæ‡‰ç”¨æœå‹™]
    end
    
    subgraph "é ˜åŸŸæœå‹™å±¤"
        DS1[å¸³æˆ¶é ˜åŸŸæœå‹™]
        DS2[äº¤æ˜“é ˜åŸŸæœå‹™]
        DS3[é¢¨éšªé ˜åŸŸæœå‹™]
    end
    
    subgraph "åŸºç¤è¨­æ–½å±¤"
        DB1[å¸³æˆ¶è³‡æ–™åº«]
        DB2[äº¤æ˜“è³‡æ–™åº«]
        DB3[é¢¨éšªè³‡æ–™åº«]
        EXT[å¤–éƒ¨æœå‹™]
    end
    
    API --> AS1
    API --> AS2
    API --> AS3
    
    AS1 --> DS1
    AS2 --> DS2
    AS3 --> DS3
    
    DS1 --> DB1
    DS2 --> DB2
    DS3 --> DB3
    DS3 --> EXT
```

---

## ğŸ’¯ ç¬¬äºŒç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰

### âœ… æˆ°ç•¥è¨­è¨ˆæ¦‚å¿µ
- [ ] èƒ½å¤ å€åˆ†æ ¸å¿ƒé ˜åŸŸã€æ”¯æ´å­åŸŸã€é€šç”¨å­åŸŸ
- [ ] ç†è§£é™ç•Œä¸Šä¸‹æ–‡çš„å®šç¾©èˆ‡è­˜åˆ¥æ–¹æ³•
- [ ] æŒæ¡å„ç¨®ä¸Šä¸‹æ–‡æ˜ å°„æ¨¡å¼çš„ç‰¹å¾µèˆ‡æ‡‰ç”¨
- [ ] èƒ½å¤ ç¹ªè£½ä¸Šä¸‹æ–‡æ˜ å°„åœ–

### âœ… å¯¦å‹™åˆ†æèƒ½åŠ›
- [ ] èƒ½å¤ åˆ†ææ¥­å‹™é ˜åŸŸä¸¦é€²è¡Œå­åŸŸåˆ†é¡
- [ ] èƒ½å¤ è­˜åˆ¥é©ç•¶çš„é™ç•Œä¸Šä¸‹æ–‡é‚Šç•Œ
- [ ] èƒ½å¤ é¸æ“‡åˆé©çš„ä¸Šä¸‹æ–‡æ•´åˆæ¨¡å¼
- [ ] èƒ½å¤ è©•ä¼°ä¸åŒè¨­è¨ˆé¸æ“‡çš„æ¬Šè¡¡

### âœ… è¨­è¨ˆç”¢å‡ºäº¤ä»˜
- [ ] å®Œæˆå­åŸŸåˆ†é¡èˆ‡æŠ•è³‡ç­–ç•¥è¦åŠƒ
- [ ] å»ºç«‹é™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†æ–‡æª”
- [ ] ç¹ªè£½å®Œæ•´çš„ä¸Šä¸‹æ–‡æ˜ å°„åœ–
- [ ] å®šç¾©ä¸Šä¸‹æ–‡é–“çš„æ•´åˆä»‹é¢

---

## ğŸ“ ç¬¬äºŒç¯‡ç¸½çµ

DDD æˆ°ç•¥è¨­è¨ˆç‚ºæˆ‘å€‘æä¾›äº†ç³»çµ±æ€§çš„æ–¹æ³•ä¾†åˆ†è§£å’Œç†è§£è¤‡é›œçš„æ¥­å‹™é ˜åŸŸï¼š

1. **å­åŸŸåˆ†é¡**å¹«åŠ©æˆ‘å€‘è­˜åˆ¥æŠ•è³‡å„ªå…ˆç´šï¼Œå°‡è³‡æºé›†ä¸­åœ¨æ ¸å¿ƒç«¶çˆ­åŠ›ä¸Š
2. **é™ç•Œä¸Šä¸‹æ–‡**æä¾›äº†æ¸…æ™°çš„é‚Šç•ŒåŠƒåˆ†ï¼Œé¿å…æ¨¡å‹æ··æ·†å’Œè€¦åˆå•é¡Œ
3. **ä¸Šä¸‹æ–‡æ˜ å°„**æ˜ç¢ºäº†æ•´åˆç­–ç•¥ï¼Œé™ä½ç³»çµ±é–“çš„ç›¸ä¾é¢¨éšª

é€éæˆ°ç•¥è¨­è¨ˆï¼Œæˆ‘å€‘èƒ½å¤ å»ºç«‹èµ·é«˜å±¤æ¬¡çš„æ¶æ§‹è—åœ–ï¼Œç‚ºå¾ŒçºŒçš„æˆ°è¡“è¨­è¨ˆå¥ å®šå …å¯¦çš„åŸºç¤ã€‚

ä¸‹ä¸€ç¯‡æˆ‘å€‘å°‡æ·±å…¥æ¢è¨ **DDD æˆ°è¡“è¨­è¨ˆ**ï¼Œå­¸ç¿’å¦‚ä½•åœ¨é™ç•Œä¸Šä¸‹æ–‡å…§éƒ¨è¨­è¨ˆç²¾è‰¯çš„é ˜åŸŸæ¨¡å‹ã€‚

---

ğŸ“š **å»¶ä¼¸é–±è®€**
- Eric Evansã€ŠDomain-Driven Design: Tackling Complexity in the Heart of Softwareã€‹
- Vaughn Vernonã€ŠImplementing Domain-Driven Designã€‹
- Scott Millettã€ŠPatterns, Principles, and Practices of Domain-Driven Designã€‹

---

# ç¬¬ä¸‰ç¯‡ï¼šDDD æˆ°è¡“è¨­è¨ˆ (Tactical Design)

## 8. æ ¸å¿ƒæ§‹ä»¶ä»‹ç´¹

### 8.1 Entityï¼ˆå¯¦é«”ï¼‰

#### ğŸ†” å®šç¾©èˆ‡ç‰¹å¾µ

å¯¦é«”æ˜¯å…·æœ‰å”¯ä¸€è­˜åˆ¥æ€§çš„é ˜åŸŸç‰©ä»¶ï¼Œå³ä½¿å…¶å±¬æ€§ç™¼ç”Ÿè®ŠåŒ–ï¼Œå…¶èº«ä»½ä¾ç„¶ä¿æŒä¸è®Šã€‚

**æ ¸å¿ƒç‰¹å¾µï¼š**
- å…·æœ‰å”¯ä¸€è­˜åˆ¥ç¬¦ (Identity)
- æœ‰ç”Ÿå‘½é€±æœŸï¼Œç‹€æ…‹æœƒè®ŠåŒ–
- èº«ä»½çš„é€£çºŒæ€§æ¯”å±¬æ€§å€¼æ›´é‡è¦
- é€šé ID ä¾†åˆ¤æ–·ç›¸ç­‰æ€§

```mermaid
graph LR
    A[Entity ç‰¹å¾µ] --> B[å”¯ä¸€è­˜åˆ¥æ€§]
    A --> C[å¯è®Šæ€§]
    A --> D[ç”Ÿå‘½é€±æœŸ]
    A --> E[èº«ä»½é€£çºŒæ€§]
    
    style A fill:#4caf50,color:white
```

#### ğŸ’¼ å¯¦é«”è¨­è¨ˆç¯„ä¾‹

```java
// å®¢æˆ¶å¯¦é«” - æœ‰æ˜ç¢ºçš„èº«ä»½è­˜åˆ¥
@Entity
public class Customer {
    private CustomerId customerId;    // å”¯ä¸€è­˜åˆ¥ç¬¦
    private String name;             // å¯è®Šå±¬æ€§
    private Email email;             // å¯è®Šå±¬æ€§
    private CustomerStatus status;   // å¯è®Šç‹€æ…‹
    private LocalDateTime createdAt; // ä¸è®Šå±¬æ€§
    
    // å»ºæ§‹å­ç¢ºä¿å¯¦é«”å»ºç«‹æ™‚å°±æœ‰èº«ä»½
    public Customer(CustomerId customerId, String name, Email email) {
        this.customerId = Objects.requireNonNull(customerId);
        this.name = Objects.requireNonNull(name);
        this.email = Objects.requireNonNull(email);
        this.status = CustomerStatus.ACTIVE;
        this.createdAt = LocalDateTime.now();
    }
    
    // æ¥­å‹™è¡Œç‚ºï¼šè®Šæ›´å®¢æˆ¶è³‡è¨Š
    public void updateContactInfo(String newName, Email newEmail) {
        validateNameChange(newName);
        validateEmailChange(newEmail);
        
        this.name = newName;
        this.email = newEmail;
    }
    
    // æ¥­å‹™è¡Œç‚ºï¼šåœç”¨å®¢æˆ¶
    public void deactivate(String reason) {
        if (this.status == CustomerStatus.INACTIVE) {
            throw new IllegalStateException("å®¢æˆ¶å·²ç¶“æ˜¯åœç”¨ç‹€æ…‹");
        }
        this.status = CustomerStatus.INACTIVE;
        // è§¸ç™¼é ˜åŸŸäº‹ä»¶
        DomainEventPublisher.instance().publish(
            new CustomerDeactivated(this.customerId, reason)
        );
    }
    
    // ç›¸ç­‰æ€§åŸºæ–¼èº«ä»½è€Œéå±¬æ€§
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (!(obj instanceof Customer)) return false;
        Customer other = (Customer) obj;
        return Objects.equals(this.customerId, other.customerId);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(customerId);
    }
}
```

#### ğŸ” å¯¦é«”è­˜åˆ¥çš„æœ€ä½³å¯¦è¸

```mermaid
flowchart TD
    A[å»ºç«‹å¯¦é«”] --> B{æ˜¯å¦æœ‰è‡ªç„¶è­˜åˆ¥?}
    B -->|æœ‰| C[ä½¿ç”¨æ¥­å‹™è­˜åˆ¥ç¬¦<br/>å¦‚:å“¡å·¥ç·¨è™Ÿã€èº«åˆ†è­‰å­—è™Ÿ]
    B -->|ç„¡| D[ç”¢ç”ŸæŠ€è¡“è­˜åˆ¥ç¬¦<br/>å¦‚:UUIDã€è‡ªå¢ ID]
    
    C --> E[è¨­è¨ˆå¼·å‹åˆ¥ ID]
    D --> E
    E --> F[ç¢ºä¿ä¸å¯è®Šæ€§]
    F --> G[é©—è­‰å”¯ä¸€æ€§]
    
    style E fill:#ff9800,color:white
    style G fill:#4caf50,color:white
```

### 8.2 Value Objectï¼ˆå€¼ç‰©ä»¶ï¼‰

#### ğŸ’ å®šç¾©èˆ‡ç‰¹å¾µ

å€¼ç‰©ä»¶æè¿°äº‹ç‰©çš„ç‰¹å¾µæˆ–å±¬æ€§ï¼Œæ²’æœ‰æ¦‚å¿µä¸Šçš„èº«ä»½è­˜åˆ¥ï¼Œå®Œå…¨ç”±å…¶å±¬æ€§å€¼å®šç¾©ã€‚

**æ ¸å¿ƒç‰¹å¾µï¼š**
- ä¸å¯è®Šæ€§ (Immutable)
- å€¼ç›¸ç­‰æ€§ (Value Equality)
- å¯æ›¿æ›æ€§ (Replaceable)
- æ²’æœ‰èº«ä»½è­˜åˆ¥

#### ğŸ“ å€¼ç‰©ä»¶è¨­è¨ˆç¯„ä¾‹

```java
// é‡‘é¡å€¼ç‰©ä»¶
public final class Money {
    private final BigDecimal amount;
    private final Currency currency;
    
    public Money(BigDecimal amount, Currency currency) {
        this.amount = Objects.requireNonNull(amount);
        this.currency = Objects.requireNonNull(currency);
        validateAmount(amount);
    }
    
    // éœæ…‹å·¥å» æ–¹æ³•
    public static Money of(double amount, String currencyCode) {
        return new Money(
            BigDecimal.valueOf(amount), 
            Currency.getInstance(currencyCode)
        );
    }
    
    // æ¥­å‹™æ“ä½œè¿”å›æ–°çš„å€¼ç‰©ä»¶
    public Money add(Money other) {
        validateSameCurrency(other);
        return new Money(
            this.amount.add(other.amount), 
            this.currency
        );
    }
    
    public Money multiply(BigDecimal factor) {
        return new Money(
            this.amount.multiply(factor), 
            this.currency
        );
    }
    
    // å€¼ç›¸ç­‰æ€§
    @Override
    public boolean equals(Object obj) {
        if (this == obj) return true;
        if (!(obj instanceof Money)) return false;
        Money other = (Money) obj;
        return Objects.equals(amount, other.amount) && 
               Objects.equals(currency, other.currency);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(amount, currency);
    }
    
    // ä¸æä¾› setter æ–¹æ³•ï¼Œç¢ºä¿ä¸å¯è®Šæ€§
    public BigDecimal getAmount() { return amount; }
    public Currency getCurrency() { return currency; }
}
```

#### ğŸ—ï¸ è¤‡é›œå€¼ç‰©ä»¶ç¯„ä¾‹

```java
// åœ°å€å€¼ç‰©ä»¶
public final class Address {
    private final String street;
    private final String city;
    private final String postalCode;
    private final String country;
    
    private Address(Builder builder) {
        this.street = builder.street;
        this.city = builder.city;
        this.postalCode = builder.postalCode;
        this.country = builder.country;
        
        validate();
    }
    
    // Builder æ¨¡å¼forè¤‡é›œå€¼ç‰©ä»¶
    public static class Builder {
        private String street;
        private String city;
        private String postalCode;
        private String country;
        
        public Builder street(String street) {
            this.street = street;
            return this;
        }
        
        public Builder city(String city) {
            this.city = city;
            return this;
        }
        
        public Builder postalCode(String postalCode) {
            this.postalCode = postalCode;
            return this;
        }
        
        public Builder country(String country) {
            this.country = country;
            return this;
        }
        
        public Address build() {
            return new Address(this);
        }
    }
    
    // æ¥­å‹™é‚è¼¯ï¼šåœ°å€é©—è­‰
    private void validate() {
        if (isEmpty(street) || isEmpty(city) || 
            isEmpty(postalCode) || isEmpty(country)) {
            throw new IllegalArgumentException("åœ°å€è³‡è¨Šä¸å®Œæ•´");
        }
        
        if (!isValidPostalCode(postalCode, country)) {
            throw new IllegalArgumentException("éƒµéå€è™Ÿæ ¼å¼ä¸æ­£ç¢º");
        }
    }
    
    // æ¥­å‹™æŸ¥è©¢ï¼šæ˜¯å¦ç‚ºåŒä¸€åœ‹å®¶
    public boolean isSameCountry(Address other) {
        return this.country.equals(other.country);
    }
}
```

### 8.3 Aggregateï¼ˆèšåˆï¼‰èˆ‡ Aggregate Root

#### ğŸ”— å®šç¾©èˆ‡è¨­è¨ˆåŸå‰‡

èšåˆæ˜¯ä¸€ç¾¤ç›¸é—œç‰©ä»¶çš„é›†åˆï¼Œä½œç‚ºè³‡æ–™è®Šæ›´çš„ä¸€è‡´æ€§é‚Šç•Œã€‚èšåˆæ ¹æ˜¯èšåˆçš„å”¯ä¸€å…¥å£é»ã€‚

```mermaid
graph TB
    subgraph "Order Aggregate"
        A[Order<br/>èšåˆæ ¹] --> B[OrderItem<br/>å¯¦é«”]
        A --> C[ShippingAddress<br/>å€¼ç‰©ä»¶]
        A --> D[BillingAddress<br/>å€¼ç‰©ä»¶]
        B --> E[Product<br/>å€¼ç‰©ä»¶åƒè€ƒ]
        B --> F[Money<br/>å€¼ç‰©ä»¶]
    end
    
    style A fill:#ff9800,color:white
    style B fill:#4caf50,color:white
    style C fill:#2196f3,color:white
    style D fill:#2196f3,color:white
```

#### ğŸ“‹ èšåˆè¨­è¨ˆåŸå‰‡

1. **ä¸€è‡´æ€§é‚Šç•Œ**ï¼šèšåˆå…§çš„ä¸è®Šæ¢ä»¶å¿…é ˆå§‹çµ‚æ»¿è¶³
2. **äº‹å‹™é‚Šç•Œ**ï¼šä¸€å€‹äº‹å‹™åªèƒ½ä¿®æ”¹ä¸€å€‹èšåˆ
3. **å”¯ä¸€å…¥å£**ï¼šå¤–éƒ¨åªèƒ½é€šéèšåˆæ ¹è¨ªå•èšåˆ
4. **å¼•ç”¨ç´„æŸ**ï¼šèšåˆé–“åªèƒ½é€šé ID å¼•ç”¨ï¼Œä¸èƒ½ç›´æ¥æŒæœ‰ç‰©ä»¶å¼•ç”¨

#### ğŸ›’ è¨‚å–®èšåˆå¯¦ä½œç¯„ä¾‹

```java
// è¨‚å–®èšåˆæ ¹
@Aggregate
public class Order {
    private OrderId orderId;
    private CustomerId customerId;
    private OrderStatus status;
    private List<OrderItem> items;
    private ShippingAddress shippingAddress;
    private Money totalAmount;
    private LocalDateTime orderDate;
    
    // é€éå·¥å» æ–¹æ³•å»ºç«‹èšåˆ
    public static Order create(CustomerId customerId, 
                              List<OrderItem> items,
                              ShippingAddress shippingAddress) {
        validateItems(items);
        
        Order order = new Order();
        order.orderId = OrderId.generate();
        order.customerId = customerId;
        order.items = new ArrayList<>(items);
        order.shippingAddress = shippingAddress;
        order.status = OrderStatus.PENDING;
        order.orderDate = LocalDateTime.now();
        order.calculateTotal();
        
        // ç™¼å¸ƒé ˜åŸŸäº‹ä»¶
        order.addDomainEvent(new OrderCreated(order.orderId, customerId));
        
        return order;
    }
    
    // æ¥­å‹™æ“ä½œï¼šæ–°å¢è¨‚å–®é …ç›®
    public void addItem(Product product, int quantity, Money unitPrice) {
        validateOrderModifiable();
        
        OrderItem item = new OrderItem(product.getId(), quantity, unitPrice);
        this.items.add(item);
        calculateTotal();
        
        // æª¢æŸ¥æ¥­å‹™ä¸è®Šæ¢ä»¶
        enforceInvariants();
    }
    
    // æ¥­å‹™æ“ä½œï¼šç¢ºèªè¨‚å–®
    public void confirm() {
        if (status != OrderStatus.PENDING) {
            throw new IllegalStateException("åªæœ‰å¾…è™•ç†è¨‚å–®å¯ä»¥ç¢ºèª");
        }
        
        validateMinimumAmount();
        this.status = OrderStatus.CONFIRMED;
        
        addDomainEvent(new OrderConfirmed(this.orderId));
    }
    
    // æ¥­å‹™ä¸è®Šæ¢ä»¶
    private void enforceInvariants() {
        if (items.isEmpty()) {
            throw new IllegalStateException("è¨‚å–®å¿…é ˆåŒ…å«è‡³å°‘ä¸€å€‹é …ç›®");
        }
        
        if (totalAmount.getAmount().compareTo(BigDecimal.ZERO) <= 0) {
            throw new IllegalStateException("è¨‚å–®ç¸½é‡‘é¡å¿…é ˆå¤§æ–¼é›¶");
        }
    }
    
    // èšåˆå…§éƒ¨é‚è¼¯
    private void calculateTotal() {
        this.totalAmount = items.stream()
            .map(OrderItem::getSubtotal)
            .reduce(Money.ZERO, Money::add);
    }
    
    // åªæä¾›å¿…è¦çš„getterï¼Œä¸æä¾›setter
    public OrderId getOrderId() { return orderId; }
    public OrderStatus getStatus() { return status; }
    public Money getTotalAmount() { return totalAmount; }
    
    // èšåˆå…§å¯¦é«”
    public static class OrderItem {
        private ProductId productId;
        private int quantity;
        private Money unitPrice;
        
        public OrderItem(ProductId productId, int quantity, Money unitPrice) {
            this.productId = productId;
            this.quantity = quantity;
            this.unitPrice = unitPrice;
            validate();
        }
        
        public Money getSubtotal() {
            return unitPrice.multiply(BigDecimal.valueOf(quantity));
        }
        
        private void validate() {
            if (quantity <= 0) {
                throw new IllegalArgumentException("æ•¸é‡å¿…é ˆå¤§æ–¼é›¶");
            }
        }
    }
}
```

### 8.4 Repositoryï¼ˆå€‰å„²ï¼‰

#### ğŸ“š å®šç¾©èˆ‡è·è²¬

Repository æä¾›é¡ä¼¼è¨˜æ†¶é«”å…§é›†åˆçš„ä»‹é¢ï¼Œç”¨æ–¼å­˜å–èšåˆã€‚å®ƒå°è£äº†è³‡æ–™å­˜å–çš„ç´°ç¯€ï¼Œè®“é ˜åŸŸå±¤å°ˆæ³¨æ–¼æ¥­å‹™é‚è¼¯ã€‚

```mermaid
graph LR
    A[Domain Layer] --> B[Repository Interface]
    B --> C[Repository Implementation]
    C --> D[Data Access Layer]
    D --> E[Database]
    
    style B fill:#4caf50,color:white
    style C fill:#ff9800,color:white
```

#### ğŸ”§ Repository ä»‹é¢è¨­è¨ˆ

```java
// å€‰å„²ä»‹é¢ - ä½æ–¼é ˜åŸŸå±¤
public interface OrderRepository {
    // åŸºæœ¬ CRUD æ“ä½œ
    void save(Order order);
    Optional<Order> findById(OrderId orderId);
    void remove(Order order);
    
    // æ¥­å‹™å°å‘çš„æŸ¥è©¢æ–¹æ³•
    List<Order> findByCustomerId(CustomerId customerId);
    List<Order> findPendingOrders();
    List<Order> findOrdersByDateRange(LocalDate startDate, LocalDate endDate);
    
    // è¦æ ¼æ¨¡å¼æŸ¥è©¢
    List<Order> findBySpecification(OrderSpecification specification);
    
    // åˆ†é æŸ¥è©¢
    Page<Order> findByCustomerId(CustomerId customerId, Pageable pageable);
    
    // èšåˆè¨ˆç®—
    OrderStatistics calculateStatistics(CustomerId customerId);
}
```

#### ğŸ—ï¸ Repository å¯¦ä½œç¯„ä¾‹

```java
// JPA å¯¦ä½œ - ä½æ–¼åŸºç¤è¨­æ–½å±¤
@Repository
@Transactional
public class JpaOrderRepository implements OrderRepository {
    
    @PersistenceContext
    private EntityManager entityManager;
    
    @Override
    public void save(Order order) {
        if (order.getOrderId() == null) {
            entityManager.persist(order);
        } else {
            entityManager.merge(order);
        }
        
        // è™•ç†é ˜åŸŸäº‹ä»¶
        publishDomainEvents(order);
    }
    
    @Override
    public Optional<Order> findById(OrderId orderId) {
        Order order = entityManager.find(Order.class, orderId);
        return Optional.ofNullable(order);
    }
    
    @Override
    public List<Order> findByCustomerId(CustomerId customerId) {
        TypedQuery<Order> query = entityManager.createQuery(
            "SELECT o FROM Order o WHERE o.customerId = :customerId", 
            Order.class
        );
        query.setParameter("customerId", customerId);
        return query.getResultList();
    }
    
    @Override
    public List<Order> findBySpecification(OrderSpecification specification) {
        CriteriaBuilder cb = entityManager.getCriteriaBuilder();
        CriteriaQuery<Order> query = cb.createQuery(Order.class);
        Root<Order> root = query.from(Order.class);
        
        Predicate predicate = specification.toPredicate(root, query, cb);
        query.where(predicate);
        
        return entityManager.createQuery(query).getResultList();
    }
    
    private void publishDomainEvents(Order order) {
        order.getDomainEvents().forEach(event -> {
            applicationEventPublisher.publishEvent(event);
        });
        order.clearDomainEvents();
    }
}
```

### 8.5 Serviceï¼ˆé ˜åŸŸæœå‹™ / æ‡‰ç”¨æœå‹™ï¼‰

#### ğŸ¯ é ˜åŸŸæœå‹™ (Domain Service)

ç•¶æ¥­å‹™é‚è¼¯ä¸è‡ªç„¶åœ°å±¬æ–¼ä»»ä½•å¯¦é«”æˆ–å€¼ç‰©ä»¶æ™‚ï¼Œä½¿ç”¨é ˜åŸŸæœå‹™ä¾†å°è£é€™äº›é‚è¼¯ã€‚

```java
// é ˜åŸŸæœå‹™ï¼šè½‰å¸³æœå‹™
@DomainService
public class TransferService {
    
    public TransferResult transfer(Account fromAccount, 
                                 Account toAccount, 
                                 Money amount) {
        // è·¨èšåˆçš„æ¥­å‹™é‚è¼¯
        validateTransfer(fromAccount, toAccount, amount);
        
        // åŸ·è¡Œè½‰å¸³
        fromAccount.debit(amount);
        toAccount.credit(amount);
        
        // å»ºç«‹è½‰å¸³è¨˜éŒ„
        TransferRecord record = new TransferRecord(
            fromAccount.getAccountId(),
            toAccount.getAccountId(),
            amount,
            LocalDateTime.now()
        );
        
        return new TransferResult(record, TransferStatus.SUCCESS);
    }
    
    private void validateTransfer(Account from, Account to, Money amount) {
        if (!from.canDebit(amount)) {
            throw new InsufficientFundsException("é¤˜é¡ä¸è¶³");
        }
        
        if (!to.canCredit(amount)) {
            throw new AccountLimitExceededException("è¶…éå¸³æˆ¶é™é¡");
        }
        
        if (amount.getAmount().compareTo(BigDecimal.ZERO) <= 0) {
            throw new InvalidAmountException("è½‰å¸³é‡‘é¡å¿…é ˆå¤§æ–¼é›¶");
        }
    }
}
```

#### ğŸ”„ æ‡‰ç”¨æœå‹™ (Application Service)

å”èª¿é ˜åŸŸç‰©ä»¶åŸ·è¡Œæ¥­å‹™ç”¨ä¾‹ï¼Œè™•ç†äº‹å‹™é‚Šç•Œå’Œå®‰å…¨æ€§ã€‚

```java
// æ‡‰ç”¨æœå‹™ï¼šè¨‚å–®æ‡‰ç”¨æœå‹™
@ApplicationService
@Transactional
public class OrderApplicationService {
    
    private final OrderRepository orderRepository;
    private final CustomerRepository customerRepository;
    private final ProductRepository productRepository;
    private final DomainEventPublisher eventPublisher;
    
    public OrderId createOrder(CreateOrderCommand command) {
        // 1. é©—è­‰æ¬Šé™
        validatePermissions(command.getCustomerId());
        
        // 2. è¼‰å…¥ç›¸é—œèšåˆ
        Customer customer = customerRepository.findById(command.getCustomerId())
            .orElseThrow(() -> new CustomerNotFoundException());
        
        // 3. é©—è­‰æ¥­å‹™è¦å‰‡
        validateOrderCreation(customer);
        
        // 4. å»ºç«‹è¨‚å–®èšåˆ
        List<OrderItem> items = buildOrderItems(command.getItems());
        ShippingAddress address = command.getShippingAddress();
        
        Order order = Order.create(customer.getCustomerId(), items, address);
        
        // 5. å„²å­˜èšåˆ
        orderRepository.save(order);
        
        // 6. è¿”å›çµæœ
        return order.getOrderId();
    }
    
    public void confirmOrder(OrderId orderId) {
        Order order = orderRepository.findById(orderId)
            .orElseThrow(() -> new OrderNotFoundException());
        
        // å§”è¨—çµ¦é ˜åŸŸç‰©ä»¶åŸ·è¡Œæ¥­å‹™é‚è¼¯
        order.confirm();
        
        orderRepository.save(order);
    }
    
    private List<OrderItem> buildOrderItems(List<OrderItemCommand> itemCommands) {
        return itemCommands.stream()
            .map(this::buildOrderItem)
            .collect(Collectors.toList());
    }
    
    private OrderItem buildOrderItem(OrderItemCommand itemCommand) {
        Product product = productRepository.findById(itemCommand.getProductId())
            .orElseThrow(() -> new ProductNotFoundException());
        
        return new OrderItem(
            product.getId(),
            itemCommand.getQuantity(),
            product.getPrice()
        );
    }
}
```

### 8.6 Factoryï¼ˆå·¥å» ï¼‰

#### ğŸ­ å®šç¾©èˆ‡æ‡‰ç”¨å ´æ™¯

Factory å°è£è¤‡é›œç‰©ä»¶çš„å‰µå»ºé‚è¼¯ï¼Œç¢ºä¿å‰µå»ºçš„ç‰©ä»¶è™•æ–¼ä¸€è‡´çš„ç‹€æ…‹ã€‚

```java
// è¨‚å–®å·¥å» 
public class OrderFactory {
    
    private final ProductRepository productRepository;
    private final PricingService pricingService;
    
    public Order createOrder(CustomerId customerId, 
                           List<OrderItemRequest> itemRequests,
                           ShippingAddress shippingAddress) {
        
        // é©—è­‰å®¢æˆ¶
        validateCustomer(customerId);
        
        // å»ºç«‹è¨‚å–®é …ç›®
        List<OrderItem> items = createOrderItems(itemRequests);
        
        // æ‡‰ç”¨åƒ¹æ ¼ç­–ç•¥
        applyPricingRules(items, customerId);
        
        // å»ºç«‹è¨‚å–®
        Order order = Order.create(customerId, items, shippingAddress);
        
        // æ‡‰ç”¨ä¿ƒéŠ·è¦å‰‡
        applyPromotions(order, customerId);
        
        return order;
    }
    
    private List<OrderItem> createOrderItems(List<OrderItemRequest> requests) {
        return requests.stream()
            .map(this::createOrderItem)
            .collect(Collectors.toList());
    }
    
    private OrderItem createOrderItem(OrderItemRequest request) {
        Product product = productRepository.findById(request.getProductId())
            .orElseThrow(() -> new ProductNotFoundException());
        
        // è¤‡é›œçš„é …ç›®å»ºç«‹é‚è¼¯
        Money unitPrice = pricingService.calculatePrice(
            product, request.getQuantity()
        );
        
        return new OrderItem(
            product.getId(),
            request.getQuantity(),
            unitPrice
        );
    }
}
```

---

## ğŸ’¯ ç¬¬ä¸‰ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰

### âœ… æˆ°è¡“è¨­è¨ˆæ§‹ä»¶ç†è§£
- [ ] ç†è§£ Entity èˆ‡ Value Object çš„å€åˆ¥èˆ‡æ‡‰ç”¨
- [ ] æŒæ¡ Aggregate çš„è¨­è¨ˆåŸå‰‡èˆ‡é‚Šç•ŒåŠƒåˆ†
- [ ] èƒ½å¤ è¨­è¨ˆåˆé©çš„ Repository ä»‹é¢
- [ ] å€åˆ†é ˜åŸŸæœå‹™èˆ‡æ‡‰ç”¨æœå‹™çš„è·è²¬
- [ ] äº†è§£ Factory çš„ä½¿ç”¨æ™‚æ©Ÿèˆ‡è¨­è¨ˆæ¨¡å¼

### âœ… ç¨‹å¼ç¢¼å¯¦ä½œèƒ½åŠ›
- [ ] èƒ½å¤ å¯¦ä½œç¬¦åˆ DDD åŸå‰‡çš„å¯¦é«”é¡åˆ¥
- [ ] èƒ½å¤ è¨­è¨ˆä¸å¯è®Šçš„å€¼ç‰©ä»¶
- [ ] èƒ½å¤ è¨­è¨ˆèšåˆä¸¦ç¢ºä¿æ¥­å‹™ä¸è®Šæ¢ä»¶
- [ ] èƒ½å¤ å¯¦ä½œ Repository æ¨¡å¼
- [ ] èƒ½å¤ è¨­è¨ˆæ‡‰ç”¨æœå‹™å”èª¿æ¥­å‹™æµç¨‹

### âœ… è¨­è¨ˆå“è³ªæª¢æŸ¥
- [ ] ç¢ºä¿å¯¦é«”æœ‰å”¯ä¸€è­˜åˆ¥ä¸”ç›¸ç­‰æ€§æ­£ç¢º
- [ ] ç¢ºä¿å€¼ç‰©ä»¶ä¸å¯è®Šä¸”å€¼ç›¸ç­‰
- [ ] ç¢ºä¿èšåˆé‚Šç•Œæ¸…æ™°ä¸”ä¸è®Šæ¢ä»¶å¾—åˆ°ä¿è­·
- [ ] ç¢ºä¿ Repository æä¾›é›†åˆå¼ä»‹é¢
- [ ] ç¢ºä¿æœå‹™è·è²¬å–®ä¸€ä¸”ç„¡ç‹€æ…‹

---

ğŸ“š **å»¶ä¼¸é–±è®€**
- Eric Evansã€ŠDomain-Driven Design: Tackling Complexity in the Heart of Softwareã€‹
- Vaughn Vernonã€ŠImplementing Domain-Driven Designã€‹
- Scott Millettã€ŠPatterns, Principles, and Practices of Domain-Driven Designã€‹

---

# ç¬¬å››ç¯‡ï¼šDDD èˆ‡å¯¦å‹™æ‡‰ç”¨

## 9. é ˜åŸŸäº‹ä»¶ (Domain Events)

### 9.1 ä»€éº¼æ˜¯é ˜åŸŸäº‹ä»¶

é ˜åŸŸäº‹ä»¶æ˜¯é ˜åŸŸä¸­ç™¼ç”Ÿçš„é‡è¦æ¥­å‹™äº‹å¯¦ï¼Œä»£è¡¨äº†æ¥­å‹™ç‹€æ…‹çš„è®ŠåŒ–ã€‚å®ƒå€‘æ˜¯å¯¦ç¾æœ€çµ‚ä¸€è‡´æ€§å’Œè§£è€¦èšåˆé–“äº’å‹•çš„é‡è¦æ©Ÿåˆ¶ã€‚

#### ğŸ¯ é ˜åŸŸäº‹ä»¶çš„ç‰¹å¾µ

```mermaid
mindmap
  root)é ˜åŸŸäº‹ä»¶ç‰¹å¾µ(
    æ¥­å‹™æ„ç¾©
      é‡è¦æ¥­å‹™äº‹å¯¦
      ç‹€æ…‹è®ŠåŒ–
      æ™‚é–“æ•æ„Ÿ
    æŠ€è¡“ç‰¹æ€§
      ä¸å¯è®Š
      å¯åºåˆ—åŒ–
      åŒ…å«å…ƒæ•¸æ“š
    æ‡‰ç”¨åƒ¹å€¼
      è§£è€¦èšåˆ
      æœ€çµ‚ä¸€è‡´æ€§
      å¯©è¨ˆè¿½è¹¤
```

#### ğŸ“ é ˜åŸŸäº‹ä»¶è¨­è¨ˆç¯„ä¾‹

```java
// æŠ½è±¡é ˜åŸŸäº‹ä»¶
public abstract class DomainEvent {
    private final UUID eventId;
    private final LocalDateTime occurredOn;
    private final int version;
    
    protected DomainEvent() {
        this.eventId = UUID.randomUUID();
        this.occurredOn = LocalDateTime.now();
        this.version = 1;
    }
    
    public UUID getEventId() { return eventId; }
    public LocalDateTime getOccurredOn() { return occurredOn; }
    public int getVersion() { return version; }
    
    // äº‹ä»¶åç¨±ç”¨æ–¼è·¯ç”±å’ŒæŒä¹…åŒ–
    public abstract String getEventType();
}

// å…·é«”é ˜åŸŸäº‹ä»¶ï¼šè¨‚å–®å·²ç¢ºèª
public class OrderConfirmed extends DomainEvent {
    private final OrderId orderId;
    private final CustomerId customerId;
    private final Money totalAmount;
    private final LocalDateTime confirmedAt;
    
    public OrderConfirmed(OrderId orderId, CustomerId customerId, Money totalAmount) {
        super();
        this.orderId = orderId;
        this.customerId = customerId;
        this.totalAmount = totalAmount;
        this.confirmedAt = LocalDateTime.now();
    }
    
    @Override
    public String getEventType() {
        return "OrderConfirmed";
    }
    
    // Getters...
    public OrderId getOrderId() { return orderId; }
    public CustomerId getCustomerId() { return customerId; }
    public Money getTotalAmount() { return totalAmount; }
    public LocalDateTime getConfirmedAt() { return confirmedAt; }
}
```

### 9.2 äº‹ä»¶ç™¼å¸ƒèˆ‡è¨‚é–±æ¨¡å¼

#### ğŸ”„ äº‹ä»¶ç™¼å¸ƒæ©Ÿåˆ¶

```java
// é ˜åŸŸäº‹ä»¶ç™¼å¸ƒè€…
@Component
public class DomainEventPublisher {
    private final ApplicationEventPublisher eventPublisher;
    
    public DomainEventPublisher(ApplicationEventPublisher eventPublisher) {
        this.eventPublisher = eventPublisher;
    }
    
    public void publish(DomainEvent event) {
        eventPublisher.publishEvent(event);
    }
    
    public void publishAll(List<DomainEvent> events) {
        events.forEach(this::publish);
    }
}

// èšåˆæ ¹åŸºç¤é¡åˆ¥
public abstract class AggregateRoot {
    private List<DomainEvent> domainEvents = new ArrayList<>();
    
    protected void addDomainEvent(DomainEvent event) {
        this.domainEvents.add(event);
    }
    
    public List<DomainEvent> getDomainEvents() {
        return Collections.unmodifiableList(domainEvents);
    }
    
    public void clearDomainEvents() {
        this.domainEvents.clear();
    }
}

// ä¿®æ”¹å¾Œçš„è¨‚å–®èšåˆ
public class Order extends AggregateRoot {
    // ... å…¶ä»–å±¬æ€§å’Œæ–¹æ³•
    
    public void confirm() {
        if (status != OrderStatus.PENDING) {
            throw new IllegalStateException("åªæœ‰å¾…è™•ç†è¨‚å–®å¯ä»¥ç¢ºèª");
        }
        
        this.status = OrderStatus.CONFIRMED;
        this.confirmedAt = LocalDateTime.now();
        
        // ç™¼å¸ƒé ˜åŸŸäº‹ä»¶
        addDomainEvent(new OrderConfirmed(this.orderId, this.customerId, this.totalAmount));
    }
}
```

#### ğŸ“¨ äº‹ä»¶è™•ç†å™¨

```java
// äº‹ä»¶è™•ç†å™¨ï¼šåº«å­˜æ‰£æ¸›
@EventHandler
@Component
public class InventoryEventHandler {
    private final InventoryService inventoryService;
    
    @EventListener
    @Async
    @Transactional
    public void handle(OrderConfirmed event) {
        try {
            // è™•ç†åº«å­˜æ‰£æ¸›
            inventoryService.reserveInventory(event.getOrderId());
            
            // è¨˜éŒ„è™•ç†æ—¥èªŒ
            log.info("åº«å­˜å·²ç‚ºè¨‚å–® {} é ç•™", event.getOrderId());
            
        } catch (Exception e) {
            // ç™¼å¸ƒè£œå„Ÿäº‹ä»¶
            eventPublisher.publish(new InventoryReservationFailed(
                event.getOrderId(), e.getMessage()
            ));
        }
    }
}

// äº‹ä»¶è™•ç†å™¨ï¼šé€šçŸ¥å®¢æˆ¶
@EventHandler
@Component
public class NotificationEventHandler {
    private final NotificationService notificationService;
    
    @EventListener
    @Async
    public void handle(OrderConfirmed event) {
        CustomerNotification notification = CustomerNotification.builder()
            .customerId(event.getCustomerId())
            .type(NotificationType.ORDER_CONFIRMED)
            .message("æ‚¨çš„è¨‚å–® " + event.getOrderId() + " å·²ç¢ºèª")
            .build();
            
        notificationService.send(notification);
    }
}
```

### 9.3 Event Sourcing

#### ğŸ“œ äº‹ä»¶æº¯æºæ¦‚å¿µ

Event Sourcing æ˜¯ä¸€ç¨®è³‡æ–™æŒä¹…åŒ–æ¨¡å¼ï¼Œé€šéå„²å­˜äº‹ä»¶åºåˆ—ä¾†é‡å»ºèšåˆç‹€æ…‹ï¼Œè€Œä¸æ˜¯ç›´æ¥å„²å­˜ç•¶å‰ç‹€æ…‹ã€‚

```mermaid
flowchart LR
    A[å‘½ä»¤] --> B[èšåˆ]
    B --> C[äº‹ä»¶]
    C --> D[äº‹ä»¶å„²å­˜]
    D --> E[äº‹ä»¶é‡æ’­]
    E --> B
    
    style C fill:#4caf50,color:white
    style D fill:#ff9800,color:white
```

#### ğŸ—ï¸ Event Sourcing å¯¦ä½œ

```java
// äº‹ä»¶å„²å­˜ä»‹é¢
public interface EventStore {
    void saveEvents(String aggregateId, List<DomainEvent> events, int expectedVersion);
    List<DomainEvent> getEventsForAggregate(String aggregateId);
    List<DomainEvent> getEventsForAggregate(String aggregateId, int fromVersion);
}

// æ”¯æ´ Event Sourcing çš„èšåˆæ ¹
public abstract class EventSourcedAggregateRoot extends AggregateRoot {
    private int version = 0;
    
    public int getVersion() { return version; }
    
    // å¾äº‹ä»¶é‡å»ºèšåˆç‹€æ…‹
    public void loadFromHistory(List<DomainEvent> events) {
        for (DomainEvent event : events) {
            applyEvent(event, false);
        }
    }
    
    // æ‡‰ç”¨äº‹ä»¶ä¸¦é¸æ“‡æ€§è¨˜éŒ„
    protected void applyEvent(DomainEvent event, boolean isNew) {
        applyEventToState(event);
        if (isNew) {
            addDomainEvent(event);
        }
        version++;
    }
    
    // å­é¡å¯¦ä½œå…·é«”çš„äº‹ä»¶æ‡‰ç”¨é‚è¼¯
    protected abstract void applyEventToState(DomainEvent event);
}

// Event Sourcing ç‰ˆæœ¬çš„å¸³æˆ¶èšåˆ
public class Account extends EventSourcedAggregateRoot {
    private AccountId accountId;
    private Money balance;
    private AccountStatus status;
    
    // å»ºç«‹æ–°å¸³æˆ¶
    public static Account create(AccountId accountId, Money initialBalance) {
        Account account = new Account();
        account.applyEvent(new AccountCreated(accountId, initialBalance), true);
        return account;
    }
    
    // å­˜æ¬¾
    public void deposit(Money amount) {
        if (status != AccountStatus.ACTIVE) {
            throw new IllegalStateException("å¸³æˆ¶æœªå•Ÿç”¨");
        }
        applyEvent(new MoneyDeposited(accountId, amount), true);
    }
    
    // ææ¬¾
    public void withdraw(Money amount) {
        if (status != AccountStatus.ACTIVE) {
            throw new IllegalStateException("å¸³æˆ¶æœªå•Ÿç”¨");
        }
        if (balance.isLessThan(amount)) {
            throw new InsufficientFundsException("é¤˜é¡ä¸è¶³");
        }
        applyEvent(new MoneyWithdrawn(accountId, amount), true);
    }
    
    @Override
    protected void applyEventToState(DomainEvent event) {
        switch (event.getEventType()) {
            case "AccountCreated":
                AccountCreated created = (AccountCreated) event;
                this.accountId = created.getAccountId();
                this.balance = created.getInitialBalance();
                this.status = AccountStatus.ACTIVE;
                break;
                
            case "MoneyDeposited":
                MoneyDeposited deposited = (MoneyDeposited) event;
                this.balance = this.balance.add(deposited.getAmount());
                break;
                
            case "MoneyWithdrawn":
                MoneyWithdrawn withdrawn = (MoneyWithdrawn) event;
                this.balance = this.balance.subtract(withdrawn.getAmount());
                break;
                
            default:
                throw new IllegalArgumentException("æœªçŸ¥çš„äº‹ä»¶é¡å‹: " + event.getEventType());
        }
    }
}
```

### 9.4 CQRS èˆ‡ DDD çš„çµåˆ

#### ğŸ”€ CQRS åŸºæœ¬æ¦‚å¿µ

CQRS (Command Query Responsibility Segregation) å°‡è®€å–å’Œå¯«å…¥æ“ä½œåˆ†é›¢ï¼Œç‚ºä¸åŒçš„ç”¨é€”ä½¿ç”¨ä¸åŒçš„æ¨¡å‹ã€‚

```mermaid
graph TB
    subgraph "CQRS æ¶æ§‹"
        A[ç”¨æˆ¶ä»‹é¢] --> B[å‘½ä»¤è™•ç†]
        A --> C[æŸ¥è©¢è™•ç†]
        
        B --> D[å¯«å…¥æ¨¡å‹<br/>èšåˆ]
        D --> E[äº‹ä»¶å„²å­˜]
        
        E --> F[äº‹ä»¶è™•ç†å™¨]
        F --> G[è®€å–æ¨¡å‹<br/>æŠ•å½±]
        C --> G
    end
    
    style D fill:#ff9800,color:white
    style G fill:#4caf50,color:white
```

#### ğŸ’¼ CQRS å¯¦ä½œç¯„ä¾‹

```java
// å‘½ä»¤è™•ç†å™¨
@Component
public class OrderCommandHandler {
    private final OrderRepository orderRepository;
    private final EventStore eventStore;
    
    @CommandHandler
    public OrderId handle(CreateOrderCommand command) {
        // é©—è­‰å‘½ä»¤
        validateCommand(command);
        
        // å»ºç«‹èšåˆ
        Order order = Order.create(
            command.getCustomerId(),
            command.getItems(),
            command.getShippingAddress()
        );
        
        // å„²å­˜äº‹ä»¶
        eventStore.saveEvents(
            order.getOrderId().toString(),
            order.getDomainEvents(),
            0
        );
        
        return order.getOrderId();
    }
    
    @CommandHandler
    public void handle(ConfirmOrderCommand command) {
        // è¼‰å…¥èšåˆ
        List<DomainEvent> events = eventStore.getEventsForAggregate(
            command.getOrderId().toString()
        );
        
        Order order = new Order();
        order.loadFromHistory(events);
        
        // åŸ·è¡Œæ¥­å‹™é‚è¼¯
        order.confirm();
        
        // å„²å­˜æ–°äº‹ä»¶
        eventStore.saveEvents(
            command.getOrderId().toString(),
            order.getDomainEvents(),
            order.getVersion()
        );
    }
}

// æŸ¥è©¢è™•ç†å™¨
@Component
public class OrderQueryHandler {
    private final OrderReadModelRepository readModelRepository;
    
    @QueryHandler
    public OrderSummary handle(GetOrderSummaryQuery query) {
        return readModelRepository.findOrderSummary(query.getOrderId());
    }
    
    @QueryHandler
    public List<OrderListItem> handle(GetCustomerOrdersQuery query) {
        return readModelRepository.findOrdersByCustomer(
            query.getCustomerId(),
            query.getPageable()
        );
    }
}

// è®€å–æ¨¡å‹æŠ•å½±å™¨
@Component
public class OrderProjectionEventHandler {
    private final OrderReadModelRepository readModelRepository;
    
    @EventHandler
    public void on(OrderCreated event) {
        OrderSummary summary = new OrderSummary(
            event.getOrderId(),
            event.getCustomerId(),
            event.getTotalAmount(),
            OrderStatus.PENDING,
            event.getOccurredOn()
        );
        
        readModelRepository.save(summary);
    }
    
    @EventHandler
    public void on(OrderConfirmed event) {
        OrderSummary summary = readModelRepository.findById(event.getOrderId());
        summary.updateStatus(OrderStatus.CONFIRMED);
        summary.setConfirmedAt(event.getOccurredOn());
        
        readModelRepository.save(summary);
    }
}
```

---

## 10. æ¨¡çµ„åŒ–èˆ‡åˆ†å±¤æ¶æ§‹

### 10.1 DDD åˆ†å±¤æ¶æ§‹

#### ğŸ—ï¸ å…¸å‹çš„ DDD åˆ†å±¤çµæ§‹

```mermaid
graph TB
    subgraph "DDD åˆ†å±¤æ¶æ§‹"
        A[ç”¨æˆ¶ä»‹é¢å±¤<br/>User Interface Layer] --> B[æ‡‰ç”¨å±¤<br/>Application Layer]
        B --> C[é ˜åŸŸå±¤<br/>Domain Layer]
        B --> D[åŸºç¤è¨­æ–½å±¤<br/>Infrastructure Layer]
        C --> D
    end
    
    style C fill:#ff9800,color:white
```

#### ğŸ“‹ å„å±¤è·è²¬èªªæ˜

| å±¤ç´š | ä¸»è¦è·è²¬ | åŒ…å«çµ„ä»¶ | ä¾è³´é—œä¿‚ |
|------|----------|----------|----------|
| **ç”¨æˆ¶ä»‹é¢å±¤** | å±•ç¤ºè³‡è¨Šã€æ¥æ”¶ç”¨æˆ¶è¼¸å…¥ | Controllerã€Viewã€DTO | ä¾è³´æ‡‰ç”¨å±¤ |
| **æ‡‰ç”¨å±¤** | å”èª¿æ¥­å‹™æµç¨‹ã€äº‹å‹™ç®¡ç† | Application Serviceã€Command Handler | ä¾è³´é ˜åŸŸå±¤èˆ‡åŸºç¤è¨­æ–½å±¤ |
| **é ˜åŸŸå±¤** | æ ¸å¿ƒæ¥­å‹™é‚è¼¯ã€æ¥­å‹™è¦å‰‡ | Entityã€Value Objectã€Aggregateã€Domain Service | ä¸ä¾è³´å…¶ä»–å±¤ |
| **åŸºç¤è¨­æ–½å±¤** | æŠ€è¡“å¯¦ç¾ã€å¤–éƒ¨æ•´åˆ | Repository Implementationã€External Service | ä¾è³´é ˜åŸŸå±¤ä»‹é¢ |

### 10.2 Hexagonal Architectureï¼ˆå…­è§’æ¶æ§‹ï¼‰

#### ğŸ”· å…­è§’æ¶æ§‹åŸç†

å…­è§’æ¶æ§‹å°‡æ‡‰ç”¨ç¨‹å¼æ ¸å¿ƒèˆ‡å¤–éƒ¨ä¸–ç•Œéš”é›¢ï¼Œé€šéç«¯å£å’Œé©é…å™¨æ¨¡å¼å¯¦ç¾è§£è€¦ã€‚

```mermaid
graph TB
    subgraph "å…­è§’æ¶æ§‹"
        A[Web Controller<br/>Primary Adapter] --> B[Application Core]
        C[CLI Interface<br/>Primary Adapter] --> B
        
        B --> D[Repository Port]
        B --> E[Notification Port]
        B --> F[Payment Port]
        
        D --> G[JPA Repository<br/>Secondary Adapter]
        D --> H[MongoDB Repository<br/>Secondary Adapter]
        E --> I[Email Service<br/>Secondary Adapter]
        F --> J[Payment Gateway<br/>Secondary Adapter]
    end
    
    style B fill:#ff9800,color:white
```

#### ğŸ”Œ ç«¯å£èˆ‡é©é…å™¨å¯¦ä½œ

```java
// ç«¯å£ï¼ˆä»‹é¢ï¼‰- ä½æ–¼é ˜åŸŸå±¤
public interface PaymentPort {
    PaymentResult processPayment(PaymentRequest request);
    PaymentStatus getPaymentStatus(PaymentId paymentId);
    void refundPayment(PaymentId paymentId, Money amount);
}

// é©é…å™¨ï¼ˆå¯¦ä½œï¼‰- ä½æ–¼åŸºç¤è¨­æ–½å±¤
@Component
public class StripePaymentAdapter implements PaymentPort {
    private final StripeApiClient stripeClient;
    
    @Override
    public PaymentResult processPayment(PaymentRequest request) {
        try {
            // è½‰æ›ç‚º Stripe API æ ¼å¼
            ChargeRequest chargeRequest = StripeChargeRequest.builder()
                .amount(request.getAmount().getAmount())
                .currency(request.getAmount().getCurrency().getCurrencyCode())
                .source(request.getPaymentMethod().getToken())
                .build();
            
            // å‘¼å« Stripe API
            Charge charge = stripeClient.createCharge(chargeRequest);
            
            // è½‰æ›å›é ˜åŸŸæ¨¡å‹
            return PaymentResult.success(
                PaymentId.from(charge.getId()),
                Money.of(charge.getAmount(), charge.getCurrency())
            );
            
        } catch (StripeException e) {
            return PaymentResult.failure(e.getMessage());
        }
    }
}

// æ‡‰ç”¨æœå‹™ä½¿ç”¨ç«¯å£
@ApplicationService
public class OrderPaymentService {
    private final PaymentPort paymentPort;
    private final OrderRepository orderRepository;
    
    @Transactional
    public void processOrderPayment(ProcessPaymentCommand command) {
        // è¼‰å…¥è¨‚å–®èšåˆ
        Order order = orderRepository.findById(command.getOrderId())
            .orElseThrow(() -> new OrderNotFoundException());
        
        // å»ºç«‹æ”¯ä»˜è«‹æ±‚
        PaymentRequest paymentRequest = PaymentRequest.builder()
            .amount(order.getTotalAmount())
            .paymentMethod(command.getPaymentMethod())
            .orderId(order.getOrderId())
            .build();
        
        // é€šéç«¯å£è™•ç†æ”¯ä»˜
        PaymentResult result = paymentPort.processPayment(paymentRequest);
        
        if (result.isSuccess()) {
            order.markAsPaid(result.getPaymentId());
        } else {
            order.markPaymentFailed(result.getErrorMessage());
        }
        
        orderRepository.save(order);
    }
}
```

### 10.3 Clean Architecture

#### ğŸ¯ Clean Architecture åŸå‰‡

Clean Architecture å¼·èª¿ä¾è³´åè½‰ï¼Œå¤–å±¤ä¾è³´å…§å±¤ï¼Œå…§å±¤ä¸çŸ¥é“å¤–å±¤çš„å­˜åœ¨ã€‚

```mermaid
graph TB
    subgraph "Clean Architecture"
        A[Frameworks & Drivers<br/>Web, DB, External Interfaces]
        B[Interface Adapters<br/>Controllers, Gateways, Presenters]
        C[Use Cases<br/>Application Business Rules]
        D[Entities<br/>Enterprise Business Rules]
        
        A --> B
        B --> C
        C --> D
    end
    
    style D fill:#ff9800,color:white
    style C fill:#4caf50,color:white
```

#### ğŸ—ï¸ Clean Architecture å¯¦ä½œçµæ§‹

```java
// å¯¦é«”å±¤ï¼ˆEnterprise Business Rulesï¼‰
public class Customer {
    private CustomerId id;
    private String name;
    private Email email;
    private CustomerType type;
    
    // ä¼æ¥­ç´šæ¥­å‹™è¦å‰‡
    public boolean canReceiveDiscount(DiscountType discountType) {
        return switch (this.type) {
            case PREMIUM -> true;
            case REGULAR -> discountType != DiscountType.PREMIUM_ONLY;
            case TRIAL -> discountType == DiscountType.TRIAL_WELCOME;
        };
    }
}

// ç”¨ä¾‹å±¤ï¼ˆApplication Business Rulesï¼‰
@UseCase
public class CreateCustomerUseCase {
    private final CustomerRepository customerRepository;
    private final EmailService emailService;
    
    public CustomerId execute(CreateCustomerRequest request) {
        // é©—è­‰æ¥­å‹™è¦å‰‡
        validateUniqueEmail(request.getEmail());
        
        // å»ºç«‹å¯¦é«”
        Customer customer = Customer.create(
            request.getName(),
            request.getEmail(),
            request.getCustomerType()
        );
        
        // å„²å­˜
        customerRepository.save(customer);
        
        // ç™¼é€æ­¡è¿éƒµä»¶
        emailService.sendWelcomeEmail(customer);
        
        return customer.getId();
    }
    
    private void validateUniqueEmail(Email email) {
        if (customerRepository.existsByEmail(email)) {
            throw new EmailAlreadyExistsException(email);
        }
    }
}

// ä»‹é¢é©é…å™¨å±¤ï¼ˆInterface Adaptersï¼‰
@RestController
@RequestMapping("/api/customers")
public class CustomerController {
    private final CreateCustomerUseCase createCustomerUseCase;
    
    @PostMapping
    public ResponseEntity<CustomerResponse> createCustomer(
            @RequestBody @Valid CreateCustomerDto dto) {
        
        // è½‰æ› DTO ç‚ºè«‹æ±‚ç‰©ä»¶
        CreateCustomerRequest request = CreateCustomerRequest.builder()
            .name(dto.getName())
            .email(Email.of(dto.getEmail()))
            .customerType(CustomerType.valueOf(dto.getType()))
            .build();
        
        // åŸ·è¡Œç”¨ä¾‹
        CustomerId customerId = createCustomerUseCase.execute(request);
        
        // è½‰æ›ç‚ºå›æ‡‰ DTO
        CustomerResponse response = CustomerResponse.builder()
            .id(customerId.getValue())
            .message("å®¢æˆ¶å»ºç«‹æˆåŠŸ")
            .build();
        
        return ResponseEntity.status(HttpStatus.CREATED).body(response);
    }
}
```

---

## 11. åœ¨å¾®æœå‹™æ¶æ§‹ä¸­çš„ DDD

### 11.1 Bounded Context èˆ‡å¾®æœå‹™çš„å°æ‡‰

#### ğŸ¯ è¨­è¨ˆåŸå‰‡

ç†æƒ³æƒ…æ³ä¸‹ï¼Œä¸€å€‹é™ç•Œä¸Šä¸‹æ–‡æ‡‰è©²å°æ‡‰ä¸€å€‹å¾®æœå‹™ï¼Œä½†å¯¦éš›æƒ…æ³éœ€è¦è€ƒæ…®å¤šç¨®å› ç´ ã€‚

```mermaid
graph TB
    subgraph "DDD åˆ°å¾®æœå‹™çš„æ˜ å°„"
        A[æ ¸å¿ƒé ˜åŸŸ] --> A1[æ ¸å¿ƒå¾®æœå‹™<br/>ç¨ç«‹éƒ¨ç½²]
        B[æ”¯æ´å­åŸŸ] --> B1[æ”¯æ´å¾®æœå‹™<br/>å…±ç”¨åŸºç¤è¨­æ–½]
        C[é€šç”¨å­åŸŸ] --> C1[å…±äº«æœå‹™<br/>æˆ–ç¬¬ä¸‰æ–¹æœå‹™]
    end
    
    style A1 fill:#ff9800,color:white
    style B1 fill:#4caf50,color:white
    style C1 fill:#2196f3,color:white
```

#### ğŸ“Š æ˜ å°„æ±ºç­–çŸ©é™£

| è€ƒé‡å› ç´  | ç¨ç«‹å¾®æœå‹™ | åˆä½µå¾®æœå‹™ | å…±äº«æœå‹™ |
|---------|------------|------------|----------|
| **åœ˜éšŠè¦æ¨¡** | å¤§å‹åœ˜éšŠ | å°å‹åœ˜éšŠ | è·¨åœ˜éšŠ |
| **è®ŠåŒ–é »ç‡** | é«˜é »è®ŠåŒ– | ä½é »è®ŠåŒ– | ç©©å®šåŠŸèƒ½ |
| **æ¥­å‹™é‡è¦æ€§** | æ ¸å¿ƒé ˜åŸŸ | æ”¯æ´é ˜åŸŸ | é€šç”¨åŠŸèƒ½ |
| **æŠ€è¡“è¤‡é›œåº¦** | é«˜è¤‡é›œåº¦ | ä¸­ç­‰è¤‡é›œåº¦ | ä½è¤‡é›œåº¦ |
| **è³‡æ–™ä¸€è‡´æ€§** | æœ€çµ‚ä¸€è‡´æ€§ | å¼·ä¸€è‡´æ€§ | ç„¡é—œ |

### 11.2 å¾®æœå‹™é‚Šç•Œè¨­è¨ˆ

#### ğŸ” æœå‹™é‚Šç•Œè­˜åˆ¥æ­¥é©Ÿ

```mermaid
flowchart TD
    A[æ¥­å‹™åˆ†æ] --> B[è­˜åˆ¥é™ç•Œä¸Šä¸‹æ–‡]
    B --> C[è©•ä¼°æŠ€è¡“ç´„æŸ]
    C --> D[è€ƒæ…®çµ„ç¹”çµæ§‹]
    D --> E[è¨­è¨ˆæœå‹™é‚Šç•Œ]
    E --> F[å®šç¾©æœå‹™å¥‘ç´„]
    F --> G[å¯¦ä½œèˆ‡é©—è­‰]
    
    style E fill:#ff9800,color:white
```

#### ğŸ—ï¸ é›»å•†å¾®æœå‹™æ¶æ§‹ç¯„ä¾‹

```mermaid
graph TB
    subgraph "é›»å•†å¾®æœå‹™æ¶æ§‹"
        A[API Gateway] --> B[å•†å“æœå‹™]
        A --> C[è¨‚å–®æœå‹™]
        A --> D[å®¢æˆ¶æœå‹™]
        A --> E[åº«å­˜æœå‹™]
        A --> F[æ”¯ä»˜æœå‹™]
        A --> G[é€šçŸ¥æœå‹™]
        
        C --> H[è¨‚å–®è³‡æ–™åº«]
        B --> I[å•†å“è³‡æ–™åº«]
        D --> J[å®¢æˆ¶è³‡æ–™åº«]
        E --> K[åº«å­˜è³‡æ–™åº«]
        
        L[äº‹ä»¶åŒ¯æµæ’] 
        C --> L
        E --> L
        F --> L
        G --> L
    end
    
    style L fill:#4caf50,color:white
```

#### ğŸ“ æœå‹™é–“é€šè¨Šæ¨¡å¼

```java
// åŒæ­¥é€šè¨Šï¼šå®¢æˆ¶æŸ¥è©¢ API
@FeignClient(name = "customer-service")
public interface CustomerServiceClient {
    @GetMapping("/customers/{customerId}")
    CustomerInfo getCustomer(@PathVariable("customerId") String customerId);
    
    @GetMapping("/customers/{customerId}/credit-score")
    CreditScore getCreditScore(@PathVariable("customerId") String customerId);
}

// éåŒæ­¥é€šè¨Šï¼šäº‹ä»¶ç™¼å¸ƒ
@Component
public class OrderEventPublisher {
    private final RabbitTemplate rabbitTemplate;
    
    public void publishOrderConfirmed(OrderConfirmed event) {
        rabbitTemplate.convertAndSend(
            "order.exchange",
            "order.confirmed",
            event
        );
    }
}

// äº‹ä»¶ç›£è½ï¼šåº«å­˜æœå‹™
@RabbitListener(queues = "inventory.order.confirmed")
@Component
public class InventoryOrderEventHandler {
    private final InventoryService inventoryService;
    
    public void handleOrderConfirmed(OrderConfirmed event) {
        try {
            inventoryService.reserveItems(
                event.getOrderId(),
                event.getOrderItems()
            );
            
            // ç™¼å¸ƒåº«å­˜é ç•™æˆåŠŸäº‹ä»¶
            publishInventoryReserved(event.getOrderId());
            
        } catch (InsufficientInventoryException e) {
            // ç™¼å¸ƒåº«å­˜ä¸è¶³äº‹ä»¶
            publishInventoryInsufficient(event.getOrderId(), e.getMessage());
        }
    }
}
```

### 11.3 è³‡æ–™ä¸€è‡´æ€§ç­–ç•¥

#### ğŸ”„ Saga æ¨¡å¼å¯¦ä½œ

```java
// Saga å”èª¿å™¨
@Component
public class OrderProcessingSaga {
    private final PaymentService paymentService;
    private final InventoryService inventoryService;
    private final ShippingService shippingService;
    
    @SagaOrchestrationStart
    public void handle(OrderConfirmed event) {
        SagaLifeCycle.associateWith("orderId", event.getOrderId().toString());
        
        // æ­¥é©Ÿ 1ï¼šè™•ç†æ”¯ä»˜
        paymentService.processPayment(new ProcessPaymentCommand(
            event.getOrderId(),
            event.getTotalAmount(),
            event.getPaymentMethod()
        ));
    }
    
    @SagaHandler
    public void handle(PaymentProcessed event) {
        // æ­¥é©Ÿ 2ï¼šé ç•™åº«å­˜
        inventoryService.reserveInventory(new ReserveInventoryCommand(
            event.getOrderId(),
            event.getOrderItems()
        ));
    }
    
    @SagaHandler
    public void handle(InventoryReserved event) {
        // æ­¥é©Ÿ 3ï¼šå®‰æ’é…é€
        shippingService.scheduleShipping(new ScheduleShippingCommand(
            event.getOrderId(),
            event.getShippingAddress()
        ));
    }
    
    // è£œå„Ÿæ“ä½œ
    @SagaHandler
    public void handle(PaymentFailed event) {
        // å–æ¶ˆè¨‚å–®
        orderService.cancelOrder(event.getOrderId(), "æ”¯ä»˜å¤±æ•—");
    }
    
    @SagaHandler
    public void handle(InventoryReservationFailed event) {
        // é€€æ¬¾
        paymentService.refundPayment(event.getOrderId());
        orderService.cancelOrder(event.getOrderId(), "åº«å­˜ä¸è¶³");
    }
}
```

---

## 12. èˆ‡æ•æ·ã€Scrum çš„æ•´åˆ

### 12.1 Event Storming

#### ğŸ¯ Event Storming ç°¡ä»‹

Event Storming æ˜¯ç”± Alberto Brandolini æå‡ºçš„å”ä½œå·¥ä½œåŠï¼Œé€šéå¯è¦–åŒ–çš„æ–¹å¼æ¢ç´¢è¤‡é›œæ¥­å‹™é ˜åŸŸã€‚

```mermaid
graph LR
    A[é ˜åŸŸäº‹ä»¶<br/>æ©™è‰²ä¾¿åˆ©è²¼] --> B[å‘½ä»¤<br/>è—è‰²ä¾¿åˆ©è²¼]
    B --> C[èšåˆ<br/>é»ƒè‰²ä¾¿åˆ©è²¼]
    C --> D[ä½¿ç”¨è€…<br/>å°äººåœ–ç¤º]
    D --> E[å¤–éƒ¨ç³»çµ±<br/>ç²‰è‰²ä¾¿åˆ©è²¼]
    E --> F[é—œæ³¨é»<br/>ç´…è‰²ä¾¿åˆ©è²¼]
    
    style A fill:#ff9800,color:white
    style B fill:#2196f3,color:white
    style C fill:#ffeb3b,color:black
```

#### ğŸ“‹ Event Storming åŸ·è¡Œæ­¥é©Ÿ

1. **ç¬¬ä¸€éšæ®µï¼šæ¢ç´¢äº‹ä»¶**
   - åƒèˆ‡è€…ï¼šé ˜åŸŸå°ˆå®¶ã€é–‹ç™¼äººå“¡ã€ç”¢å“è² è²¬äºº
   - ç›®æ¨™ï¼šè­˜åˆ¥æ‰€æœ‰é‡è¦çš„é ˜åŸŸäº‹ä»¶
   - ç”¢å‡ºï¼šäº‹ä»¶æ™‚é–“è»¸

2. **ç¬¬äºŒéšæ®µï¼šæ·»åŠ å‘½ä»¤**
   - ç‚ºæ¯å€‹äº‹ä»¶è­˜åˆ¥è§¸ç™¼çš„å‘½ä»¤
   - ç¢ºå®šå‘½ä»¤çš„ä¾†æºï¼ˆä½¿ç”¨è€…æˆ–ç³»çµ±ï¼‰

3. **ç¬¬ä¸‰éšæ®µï¼šè­˜åˆ¥èšåˆ**
   - å°‡ç›¸é—œçš„å‘½ä»¤å’Œäº‹ä»¶åˆ†çµ„
   - è­˜åˆ¥è³‡æ–™ä¸€è‡´æ€§é‚Šç•Œ

4. **ç¬¬å››éšæ®µï¼šå®šç¾©é™ç•Œä¸Šä¸‹æ–‡**
   - æ ¹æ“šæ¥­å‹™èƒ½åŠ›å’Œåœ˜éšŠçµæ§‹åŠƒåˆ†
   - æ˜ç¢ºä¸Šä¸‹æ–‡ä¹‹é–“çš„é—œä¿‚

#### ğŸ› ï¸ Event Storming å¯¦å‹™æŠ€å·§

```java
// Event Storming çµæœæ–‡æª”åŒ–
@EventStormingResult
public class OrderProcessingDomain {
    
    // è­˜åˆ¥å‡ºçš„æ ¸å¿ƒäº‹ä»¶
    public enum DomainEvents {
        PRODUCT_ADDED_TO_CART("ç”¢å“åŠ å…¥è³¼ç‰©è»Š"),
        ORDER_PLACED("è¨‚å–®å»ºç«‹"),
        PAYMENT_PROCESSED("æ”¯ä»˜è™•ç†"),
        INVENTORY_RESERVED("åº«å­˜é ç•™"),
        ORDER_SHIPPED("è¨‚å–®å‡ºè²¨"),
        ORDER_DELIVERED("è¨‚å–®é€é”");
        
        private final String description;
        DomainEvents(String description) { this.description = description; }
    }
    
    // è­˜åˆ¥å‡ºçš„å‘½ä»¤
    public enum Commands {
        ADD_PRODUCT_TO_CART("AddProductToCart"),
        PLACE_ORDER("PlaceOrder"),
        PROCESS_PAYMENT("ProcessPayment"),
        RESERVE_INVENTORY("ReserveInventory"),
        SHIP_ORDER("ShipOrder");
        
        private final String commandName;
        Commands(String commandName) { this.commandName = commandName; }
    }
    
    // è­˜åˆ¥å‡ºçš„èšåˆ
    public enum Aggregates {
        SHOPPING_CART("è³¼ç‰©è»Š"),
        ORDER("è¨‚å–®"),
        INVENTORY("åº«å­˜"),
        PAYMENT("æ”¯ä»˜");
        
        private final String aggregateName;
        Aggregates(String aggregateName) { this.aggregateName = aggregateName; }
    }
}
```

### 12.2 Domain Storytelling

#### ğŸ“š Domain Storytelling æ–¹æ³•

Domain Storytelling é€šéåœ–åƒåŒ–çš„æ•…äº‹æ•˜è¿°ä¾†ç†è§£æ¥­å‹™æµç¨‹ã€‚

```mermaid
sequenceDiagram
    participant C as å®¢æˆ¶
    participant S as éŠ·å”®äººå“¡
    participant O as è¨‚å–®ç³»çµ±
    participant I as åº«å­˜ç³»çµ±
    participant P as æ”¯ä»˜ç³»çµ±
    
    C->>S: 1. è©¢å•ç”¢å“è³‡è¨Š
    S->>O: 2. æŸ¥è©¢ç”¢å“åº«å­˜
    O->>I: 3. æª¢æŸ¥å¯ç”¨åº«å­˜
    I-->>O: 4. å›å‚³åº«å­˜ç‹€æ…‹
    O-->>S: 5. é¡¯ç¤ºç”¢å“è³‡è¨Š
    S-->>C: 6. æä¾›ç”¢å“å»ºè­°
    C->>S: 7. æ±ºå®šè³¼è²·
    S->>O: 8. å»ºç«‹è¨‚å–®
    O->>P: 9. è™•ç†æ”¯ä»˜
    P-->>O: 10. ç¢ºèªæ”¯ä»˜çµæœ
    O-->>S: 11. ç¢ºèªè¨‚å–®æˆåŠŸ
    S-->>C: 12. é€šçŸ¥è¨‚å–®å®Œæˆ
```

#### ğŸ¨ Domain Storytelling å¯¦å‹™ç¯„ä¾‹

```java
// å¾ Domain Story åˆ°ç¨‹å¼ç¢¼
@DomainStory("å®¢æˆ¶è³¼è²·ç”¢å“çš„å®Œæ•´æµç¨‹")
public class CustomerPurchaseStory {
    
    @StoryStep(order = 1, actor = "å®¢æˆ¶", action = "ç€è¦½ç”¢å“")
    public List<Product> browseProducts(CategoryId categoryId) {
        return productCatalog.findProductsByCategory(categoryId);
    }
    
    @StoryStep(order = 2, actor = "å®¢æˆ¶", action = "åŠ å…¥è³¼ç‰©è»Š")
    public void addToCart(CustomerId customerId, ProductId productId, int quantity) {
        ShoppingCart cart = cartRepository.findByCustomerId(customerId);
        cart.addProduct(productId, quantity);
        cartRepository.save(cart);
    }
    
    @StoryStep(order = 3, actor = "å®¢æˆ¶", action = "çµå¸³")
    public OrderId checkout(CustomerId customerId, ShippingAddress address) {
        ShoppingCart cart = cartRepository.findByCustomerId(customerId);
        Order order = orderService.createOrderFromCart(cart, address);
        return order.getOrderId();
    }
    
    @StoryStep(order = 4, actor = "ç³»çµ±", action = "è™•ç†æ”¯ä»˜")
    public PaymentResult processPayment(OrderId orderId, PaymentMethod method) {
        Order order = orderRepository.findById(orderId);
        return paymentService.processPayment(order.getTotalAmount(), method);
    }
}
```

### 12.3 Scrum ä¸­çš„ DDD å¯¦è¸

#### ğŸ”„ Sprint è¦åŠƒä¸­çš„ DDD

```mermaid
graph TB
    subgraph "DDD é©…å‹•çš„ Sprint è¦åŠƒ"
        A[ç”¢å“å¾…è¾¦æ¸…å–®] --> B[æŒ‰é™ç•Œä¸Šä¸‹æ–‡åˆ†çµ„]
        B --> C[è©•ä¼°æ¥­å‹™åƒ¹å€¼]
        C --> D[è­˜åˆ¥ä¾è³´é—œä¿‚]
        D --> E[è¦åŠƒ Sprint ç›®æ¨™]
        E --> F[åˆ†è§£ç‚ºé–‹ç™¼ä»»å‹™]
    end
    
    style C fill:#ff9800,color:white
    style E fill:#4caf50,color:white
```

#### ğŸ“‹ DDD æ•…äº‹å¡ç¯„æœ¬

```yaml
# ç”¨æˆ¶æ•…äº‹å¡ç¯„æœ¬
story_template:
  title: "ä½œç‚º [è§’è‰²]ï¼Œæˆ‘æƒ³è¦ [åŠŸèƒ½]ï¼Œä»¥ä¾¿ [åƒ¹å€¼]"
  acceptance_criteria:
    - "çµ¦å®š [å‰ç½®æ¢ä»¶]"
    - "ç•¶ [è§¸ç™¼äº‹ä»¶]"
    - "é‚£éº¼ [é æœŸçµæœ]"
  
  ddd_considerations:
    bounded_context: "æ‰€å±¬çš„é™ç•Œä¸Šä¸‹æ–‡"
    domain_events: "è§¸ç™¼çš„é ˜åŸŸäº‹ä»¶åˆ—è¡¨"
    business_rules: "æ¶‰åŠçš„æ¥­å‹™è¦å‰‡"
    aggregates: "éœ€è¦ä¿®æ”¹çš„èšåˆ"

# å¯¦éš›ç¯„ä¾‹
user_story_example:
  title: "ä½œç‚ºå®¢æˆ¶ï¼Œæˆ‘æƒ³è¦ç¢ºèªæˆ‘çš„è¨‚å–®ï¼Œä»¥ä¾¿é–‹å§‹æº–å‚™é…é€"
  acceptance_criteria:
    - "çµ¦å®šæˆ‘æœ‰ä¸€å€‹è™•æ–¼å¾…ç¢ºèªç‹€æ…‹çš„è¨‚å–®"

---

# ç¬¬äº”ç¯‡ï¼šå­¸ç¿’æª¢æ¸¬èˆ‡èªè­‰æº–å‚™

## 14. ç« ç¯€å°æ¸¬é©—

### 14.1 ç¬¬ä¸€ç¯‡ï¼šåŸºç¤å…¥é–€ - æ¸¬é©—é¡Œ

#### ğŸ“ å–®é¸é¡Œ

**é¡Œç›® 1:** DDD çš„æ ¸å¿ƒé—œæ³¨é»æ˜¯ä»€éº¼ï¼Ÿ
A) æŠ€è¡“æ¶æ§‹è¨­è¨ˆ
B) è³‡æ–™åº«æ•ˆèƒ½å„ªåŒ–
C) è¤‡é›œæ¥­å‹™é ˜åŸŸçš„å»ºæ¨¡
D) ç”¨æˆ¶ä»‹é¢è¨­è¨ˆ

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šC**

**è§£æï¼š** DDD (Domain-Driven Design) çš„æ ¸å¿ƒé—œæ³¨é»æ˜¯è¤‡é›œæ¥­å‹™é ˜åŸŸçš„å»ºæ¨¡ã€‚DDD å¼·èª¿é€šéæ·±å…¥ç†è§£æ¥­å‹™é ˜åŸŸï¼Œå»ºç«‹æº–ç¢ºåæ˜ æ¥­å‹™é‚è¼¯çš„é ˜åŸŸæ¨¡å‹ï¼Œè€Œä¸æ˜¯å–®ç´”é—œæ³¨æŠ€è¡“å¯¦ä½œã€‚

</details>

**é¡Œç›® 2:** é€šç”¨èªè¨€ (Ubiquitous Language) çš„ä¸»è¦ç›®çš„æ˜¯ä»€éº¼ï¼Ÿ
A) æ¨™æº–åŒ–ç¨‹å¼ç¢¼å‘½åè¦ç¯„
B) ç¢ºä¿åœ˜éšŠå°æ¥­å‹™æ¦‚å¿µæœ‰ä¸€è‡´ç†è§£
C) ç°¡åŒ–æŠ€è¡“æ–‡æª”æ’°å¯«
D) æé«˜ç¨‹å¼ç¢¼åŸ·è¡Œæ•ˆç‡

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šB**

**è§£æï¼š** é€šç”¨èªè¨€çš„ç›®çš„æ˜¯ç¢ºä¿é–‹ç™¼åœ˜éšŠã€æ¥­å‹™å°ˆå®¶ã€åˆ©å®³é—œä¿‚äººä¹‹é–“å°æ¥­å‹™æ¦‚å¿µæœ‰ä¸€è‡´çš„ç†è§£ï¼Œé¿å…æºé€šèª¤è§£ï¼Œè®“æ‰€æœ‰åƒèˆ‡è€…éƒ½èƒ½ç”¨åŒæ¨£çš„è¡“èªè¨è«–æ¥­å‹™å•é¡Œã€‚

</details>

### 14.2 ç¬¬äºŒç¯‡ï¼šæˆ°ç•¥è¨­è¨ˆ - æ¸¬é©—é¡Œ

#### ğŸ“ å–®é¸é¡Œ

**é¡Œç›® 3:** ä»¥ä¸‹å“ªå€‹æœ€ç¬¦åˆæ ¸å¿ƒé ˜åŸŸ (Core Domain) çš„ç‰¹å¾µï¼Ÿ
A) æœ‰ç¾æˆçš„å¸‚å ´è§£æ±ºæ–¹æ¡ˆ
B) è·¨è¡Œæ¥­çš„å…±é€šéœ€æ±‚
C) çµ„ç¹”çš„ç«¶çˆ­å„ªå‹¢æ‰€åœ¨
D) æŠ€è¡“è¤‡é›œåº¦ç›¸å°è¼ƒä½

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šC**

**è§£æï¼š** æ ¸å¿ƒé ˜åŸŸæ˜¯çµ„ç¹”ç«¶çˆ­å„ªå‹¢çš„ä¾†æºï¼Œå…·æœ‰ç¨ç‰¹æ€§å’Œé«˜æ¥­å‹™åƒ¹å€¼ã€‚é¸é … A å’Œ B æ›´åƒæ˜¯é€šç”¨å­åŸŸçš„ç‰¹å¾µï¼Œé¸é … D ä¸æ˜¯æ ¸å¿ƒé ˜åŸŸçš„å¿…è¦ç‰¹å¾µã€‚

</details>

### 14.3 ç¬¬ä¸‰ç¯‡ï¼šæˆ°è¡“è¨­è¨ˆ - æ¸¬é©—é¡Œ

#### ğŸ“ ç¨‹å¼ç¢¼åˆ†æé¡Œ

**é¡Œç›® 4:** ä»¥ä¸‹ç¨‹å¼ç¢¼æœ‰ä»€éº¼å•é¡Œï¼Ÿè«‹è­˜åˆ¥ä¸¦èªªæ˜å¦‚ä½•æ”¹å–„ã€‚

```java
public class Order {
    public String id;
    public String customerId;
    public List<String> productIds;
    public double totalAmount;
    public String status;
    
    // æ‰€æœ‰å±¬æ€§éƒ½æ˜¯ publicï¼Œåªæœ‰ getter/setter
}

public class OrderService {
    public void processOrder(Order order) {
        // è¨ˆç®—ç¸½é‡‘é¡
        double total = 0;
        for (String productId : order.productIds) {
            Product product = productRepository.findById(productId);
            total += product.getPrice();
        }
        order.totalAmount = total;
        
        // æ”¹è®Šç‹€æ…‹
        order.status = "CONFIRMED";
    }
}
```

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**å•é¡Œè­˜åˆ¥ï¼š**
1. **è²§è¡€æ¨¡å‹ï¼š** Order é¡åˆ¥åªæœ‰è³‡æ–™ï¼Œæ²’æœ‰è¡Œç‚º
2. **å°è£æ€§å·®ï¼š** æ‰€æœ‰å±¬æ€§éƒ½æ˜¯ public
3. **æ¥­å‹™é‚è¼¯å¤–æ´©ï¼š** æ¥­å‹™é‚è¼¯åœ¨æœå‹™å±¤è€Œéé ˜åŸŸç‰©ä»¶ä¸­
4. **ç¼ºä¹å‹åˆ¥å®‰å…¨ï¼š** ä½¿ç”¨åŸºæœ¬å‹åˆ¥è€Œéå€¼ç‰©ä»¶
5. **æ²’æœ‰æ¥­å‹™è¦å‰‡é©—è­‰**

**æ”¹å–„å»ºè­°ï¼š**
```java
public class Order {
    private OrderId id;
    private CustomerId customerId;
    private List<OrderItem> items;
    private Money totalAmount;
    private OrderStatus status;
    
    // æ¥­å‹™è¡Œç‚º
    public void confirm() {
        validateCanConfirm();
        this.status = OrderStatus.CONFIRMED;
        this.totalAmount = calculateTotal();
        addDomainEvent(new OrderConfirmed(this.id));
    }
    
    private void validateCanConfirm() {
        if (this.status != OrderStatus.PENDING) {
            throw new IllegalStateException("åªæœ‰å¾…è™•ç†è¨‚å–®å¯ä»¥ç¢ºèª");
        }
    }
    
    private Money calculateTotal() {
        return items.stream()
            .map(OrderItem::getSubtotal)
            .reduce(Money.ZERO, Money::add);
    }
}
```

</details>

### 14.4 ç¬¬å››ç¯‡ï¼šå¯¦å‹™æ‡‰ç”¨ - æ¸¬é©—é¡Œ

#### ğŸ”„ æƒ…å¢ƒé¡Œ

**é¡Œç›® 1:** åœ¨å¾®æœå‹™æ¶æ§‹ä¸­ï¼Œå¦‚æœè¨‚å–®æœå‹™éœ€è¦ç²å–å®¢æˆ¶çš„ä¿¡ç”¨è©•åˆ†ä¾†æ±ºå®šæ˜¯å¦æ‰¹å‡†è¨‚å–®ï¼Œæ‡‰è©²æ¡ç”¨ä»€éº¼æ¨¡å¼ï¼Ÿ

A) ç›´æ¥æŸ¥è©¢å®¢æˆ¶æœå‹™çš„è³‡æ–™åº«
B) åœ¨è¨‚å–®æœå‹™ä¸­è¤‡è£½å®¢æˆ¶ä¿¡ç”¨è©•åˆ†è³‡æ–™
C) é€šéåŒæ­¥ API å‘¼å«å®¢æˆ¶æœå‹™
D) ä½¿ç”¨äº‹ä»¶é©…å‹•çš„æœ€çµ‚ä¸€è‡´æ€§

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šC æˆ– Dï¼ˆè¦–æƒ…æ³è€Œå®šï¼‰**

**è§£æï¼š**
- **é¸é … Aï¼š** éŒ¯èª¤ï¼Œé•åå¾®æœå‹™çš„è³‡æ–™ç¨ç«‹æ€§åŸå‰‡
- **é¸é … Bï¼š** éŒ¯èª¤ï¼Œå°è‡´è³‡æ–™é‡è¤‡å’ŒåŒæ­¥å•é¡Œ
- **é¸é … Cï¼š** é©ç”¨æ–¼éœ€è¦å³æ™‚ä¿¡ç”¨è©•åˆ†çš„å ´æ™¯
- **é¸é … Dï¼š** é©ç”¨æ–¼å¯ä»¥æ¥å—æœ€çµ‚ä¸€è‡´æ€§çš„å ´æ™¯

**æœ€ä½³å¯¦è¸ï¼š** é€šå¸¸å»ºè­°ä½¿ç”¨é¸é … Dï¼Œé€šéäº‹ä»¶åŒæ­¥å¿…è¦çš„è³‡æ–™åˆ°è¨‚å–®æœå‹™ï¼Œé¿å…æœå‹™é–“çš„åŒæ­¥ä¾è³´ã€‚

</details>

**é¡Œç›® 2:** åœ¨ CQRS æ¶æ§‹ä¸­ï¼Œä»¥ä¸‹å“ªå€‹èªªæ³•æ˜¯æ­£ç¢ºçš„ï¼Ÿ

A) å‘½ä»¤å’ŒæŸ¥è©¢ä½¿ç”¨ç›¸åŒçš„è³‡æ–™æ¨¡å‹
B) æŸ¥è©¢æ“ä½œå¯ä»¥ä¿®æ”¹è³‡æ–™ç‹€æ…‹
C) è®€å–æ¨¡å‹é€šéäº‹ä»¶æŠ•å½±æ›´æ–°
D) æ‰€æœ‰æ“ä½œéƒ½å¿…é ˆé€šéå‘½ä»¤è™•ç†

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šC**

**è§£æï¼š**
- A: éŒ¯èª¤ï¼ŒCQRS çš„æ ¸å¿ƒæ˜¯åˆ†é›¢è®€å¯«æ¨¡å‹
- B: éŒ¯èª¤ï¼ŒæŸ¥è©¢æ“ä½œä¸æ‡‰è©²ä¿®æ”¹ç‹€æ…‹
- C: æ­£ç¢ºï¼Œè®€å–æ¨¡å‹é€šå¸¸é€šéè™•ç†äº‹ä»¶ä¾†æ›´æ–°
- D: éŒ¯èª¤ï¼ŒæŸ¥è©¢æ“ä½œä¸é€šéå‘½ä»¤è™•ç†å™¨

</details>

**é¡Œç›® 3:** Event Sourcing çš„ä¸»è¦å„ªå‹¢ä¸åŒ…æ‹¬ï¼š

A) å®Œæ•´çš„å¯©è¨ˆè»Œè·¡
B) æ™‚é–“æ—…è¡ŒæŸ¥è©¢
C) ç°¡åŒ–çš„è³‡æ–™åº«è¨­è¨ˆ
D) ç‹€æ…‹é‡å»ºèƒ½åŠ›

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šC**

**è§£æï¼š**
- A: æ­£ç¢ºï¼ŒEvent Sourcing æä¾›å®Œæ•´çš„äº‹ä»¶æ­·å²
- B: æ­£ç¢ºï¼Œå¯ä»¥é‡å»ºä»»æ„æ™‚é–“é»çš„ç‹€æ…‹
- C: éŒ¯èª¤ï¼ŒEvent Sourcing å¯¦éš›ä¸Šå¢åŠ äº†è¤‡é›œæ€§
- D: æ­£ç¢ºï¼Œå¯ä»¥å¾äº‹ä»¶æµé‡å»ºèšåˆç‹€æ…‹

</details>

#### ğŸ“ å¯¦å‹™åˆ†æé¡Œ

**é¡Œç›® 4:** æŸé›»å•†ç³»çµ±æ­£åœ¨è€ƒæ…®å¾å–®é«”æ¶æ§‹é·ç§»åˆ°å¾®æœå‹™ï¼Œä»¥ä¸‹å“ªå€‹ç­–ç•¥æœ€ç¬¦åˆ DDD åŸå‰‡ï¼Ÿ

A) æŒ‰æŠ€è¡“å±¤é¢åŠƒåˆ†æœå‹™ï¼ˆUIæœå‹™ã€æ¥­å‹™æœå‹™ã€è³‡æ–™æœå‹™ï¼‰
B) æŒ‰é™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†æœå‹™ï¼ˆè¨‚å–®ã€åº«å­˜ã€æ”¯ä»˜ã€å®¢æˆ¶ï¼‰
C) æŒ‰è³‡æ–™åº«è¡¨æ ¼åŠƒåˆ†æœå‹™
D) æŒ‰åœ˜éšŠçµæ§‹åŠƒåˆ†æœå‹™

<details>
<summary>ç­”æ¡ˆèˆ‡è§£æ</summary>

**æ­£ç¢ºç­”æ¡ˆï¼šB**

**è§£æï¼š**
DDD å¼·èª¿æŒ‰æ¥­å‹™èƒ½åŠ›å’Œé™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†ç³»çµ±é‚Šç•Œï¼Œè€Œä¸æ˜¯æŒ‰æŠ€è¡“å±¤é¢ã€‚æŒ‰é™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†èƒ½ç¢ºä¿ï¼š
- é«˜å…§èšï¼šç›¸é—œæ¥­å‹™é‚è¼¯åœ¨åŒä¸€æœå‹™å…§
- ä½è€¦åˆï¼šæœå‹™é–“æ¸›å°‘ä¸å¿…è¦çš„ä¾è³´
- æ¸…æ™°é‚Šç•Œï¼šæ¯å€‹æœå‹™æœ‰æ˜ç¢ºçš„è²¬ä»»ç¯„åœ
- ç¨ç«‹æ¼”é€²ï¼šä¸åŒä¸Šä¸‹æ–‡å¯ä»¥ç¨ç«‹é–‹ç™¼å’Œéƒ¨ç½²

</details>

---

## 15. DDD èªè­‰è€ƒè©¦é‡é»æ•´ç†

### 15.1 å¿…è€ƒæ ¸å¿ƒæ¦‚å¿µ

#### ğŸ¯ æˆ°ç•¥è¨­è¨ˆæ ¸å¿ƒæ¦‚å¿µ

```mermaid
mindmap
  root)DDD æˆ°ç•¥è¨­è¨ˆ(
    å­åŸŸåˆ†é¡
      æ ¸å¿ƒé ˜åŸŸ
      æ”¯æ´å­åŸŸ
      é€šç”¨å­åŸŸ
    é™ç•Œä¸Šä¸‹æ–‡
      é‚Šç•Œè­˜åˆ¥
      èªè¨€çµ±ä¸€
      æ¨¡å‹ä¸€è‡´æ€§
    ä¸Šä¸‹æ–‡æ˜ å°„
      Partnership
      Shared Kernel
      Customer-Supplier
      Conformist
      Anti-Corruption Layer
```

**é‡é»è¤‡ç¿’è¦é»ï¼š**

1. **å­åŸŸåˆ†é¡æ¨™æº–**
   - æ ¸å¿ƒé ˜åŸŸï¼šç«¶çˆ­å„ªå‹¢ã€é«˜è¤‡é›œåº¦ã€é »ç¹è®ŠåŒ–
   - æ”¯æ´å­åŸŸï¼šæ¥­å‹™æ”¯æ´ã€ä¸­ç­‰è¤‡é›œåº¦ã€ä¸­ç­‰è®ŠåŒ–
   - é€šç”¨å­åŸŸï¼šå…±é€šéœ€æ±‚ã€ä½è¤‡é›œåº¦ã€ç©©å®š

2. **é™ç•Œä¸Šä¸‹æ–‡è­˜åˆ¥**
   - èªè¨€é‚Šç•Œï¼šä¸åŒè¡“èªå®šç¾©
   - è³‡æ–™é‚Šç•Œï¼šä¸åŒè³‡æ–™çµæ§‹
   - æ¥­å‹™é‚Šç•Œï¼šä¸åŒæ¥­å‹™è¦å‰‡
   - åœ˜éšŠé‚Šç•Œï¼šä¸åŒåœ˜éšŠè² è²¬

#### ğŸ› ï¸ æˆ°è¡“è¨­è¨ˆæ ¸å¿ƒæ¦‚å¿µ

```mermaid
mindmap
  root)DDD æˆ°è¡“è¨­è¨ˆ(
    å¯¦é«”è¨­è¨ˆ
      å”¯ä¸€è­˜åˆ¥æ€§
      ç”Ÿå‘½é€±æœŸ
      ç›¸ç­‰æ€§åˆ¤æ–·
    å€¼ç‰©ä»¶è¨­è¨ˆ
      ä¸å¯è®Šæ€§
      å€¼ç›¸ç­‰æ€§
      å¯æ›¿æ›æ€§
    èšåˆè¨­è¨ˆ
      ä¸€è‡´æ€§é‚Šç•Œ
      äº‹å‹™é‚Šç•Œ
      å¼•ç”¨è¦å‰‡
    æœå‹™è¨­è¨ˆ
      é ˜åŸŸæœå‹™
      æ‡‰ç”¨æœå‹™
      åŸºç¤è¨­æ–½æœå‹™
```

### 15.2 èªè­‰æº–å‚™ç­–ç•¥

#### ğŸ“š å­¸ç¿’è¨ˆç•«

**ç¬¬ä¸€éšæ®µï¼šåŸºç¤éå›º (2é€±)**
- è¤‡ç¿’æ ¸å¿ƒæ¦‚å¿µå®šç¾©
- æ•´ç†çŸ¥è­˜é»è„ˆçµ¡åœ–
- å®ŒæˆåŸºç¤ç·´ç¿’é¡Œ

**ç¬¬äºŒéšæ®µï¼šæ·±åº¦ç†è§£ (3é€±)**
- ç ”è®€ç¶“å…¸æ¡ˆä¾‹
- ç·´ç¿’è¨­è¨ˆé¡Œå‹
- æ¨¡æ“¬ç¨‹å¼ç¢¼å¯©æŸ¥

**ç¬¬ä¸‰éšæ®µï¼šç¶œåˆæ‡‰ç”¨ (2é€±)**
- å®Œæˆç¶œåˆæ¡ˆä¾‹åˆ†æ
- åƒåŠ æ¨¡æ“¬è€ƒè©¦
- é‡å°å¼±é»å¼·åŒ–ç·´ç¿’

**ç¬¬å››éšæ®µï¼šè€ƒå‰è¡åˆº (1é€±)**
- è¤‡ç¿’éŒ¯é¡Œé›†
- èƒŒèª¦æ ¸å¿ƒå®šç¾©
- èª¿æ•´è€ƒè©¦å¿ƒæ…‹

---

## 16. æ¨¡æ“¬æ¸¬é©—é¡Œåº«

### 16.1 ç¶œåˆæ¨¡æ“¬è©¦é¡Œ

#### ğŸ“ å–®é¸é¡Œ

**1.** DDD ä¸­çš„é€šç”¨èªè¨€ (Ubiquitous Language) ä¸»è¦ç›®çš„æ˜¯ï¼š
A) çµ±ä¸€ç¨‹å¼ç¢¼å‘½åè¦ç¯„
B) å»ºç«‹åœ˜éšŠèˆ‡æ¥­å‹™å°ˆå®¶çš„æºé€šæ©‹æ¨‘
C) åˆ¶å®š API ä»‹é¢æ¨™æº–
D) è¦ç¯„è³‡æ–™åº«è¨­è¨ˆæº–å‰‡

**2.** ä»¥ä¸‹å“ªå€‹æœ€é©åˆä½œç‚ºæ ¸å¿ƒé ˜åŸŸï¼š
A) ç”¨æˆ¶è¨»å†Šç³»çµ±
B) éƒµä»¶ç™¼é€æœå‹™
C) æ™ºæ…§æ¨è–¦å¼•æ“
D) æ—¥èªŒè¨˜éŒ„ç³»çµ±

**3.** åœ¨èšåˆè¨­è¨ˆä¸­ï¼Œä»¥ä¸‹å“ªå€‹åŸå‰‡æ˜¯éŒ¯èª¤çš„ï¼š
A) ä¸€å€‹äº‹å‹™åªä¿®æ”¹ä¸€å€‹èšåˆ
B) èšåˆé–“å¯ä»¥ç›´æ¥æŒæœ‰ç‰©ä»¶å¼•ç”¨
C) èšåˆæ ¹æ˜¯èšåˆçš„å”¯ä¸€å…¥å£é»
D) èšåˆå…§éƒ¨ä¿è­‰å¼·ä¸€è‡´æ€§

### 16.2 æ¨¡æ“¬è©¦é¡Œç­”æ¡ˆ

1. **B** - é€šç”¨èªè¨€çš„æ ¸å¿ƒç›®çš„æ˜¯ç¢ºä¿æ‰€æœ‰åƒèˆ‡è€…å°æ¥­å‹™æ¦‚å¿µæœ‰ä¸€è‡´ç†è§£
2. **C** - æ™ºæ…§æ¨è–¦å¼•æ“é€šå¸¸æ˜¯é›»å•†å…¬å¸çš„æ ¸å¿ƒç«¶çˆ­å„ªå‹¢
3. **B** - èšåˆé–“æ‡‰è©²é€šé ID å¼•ç”¨è€Œéç›´æ¥ç‰©ä»¶å¼•ç”¨

---

## ğŸ’¯ ç¬¬äº”ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰

### âœ… ç†è«–çŸ¥è­˜æŒæ¡
- [ ] èƒ½å¤ æº–ç¢ºå®šç¾© DDD æ ¸å¿ƒæ¦‚å¿µ
- [ ] ç†è§£æˆ°ç•¥è¨­è¨ˆèˆ‡æˆ°è¡“è¨­è¨ˆçš„å€åˆ¥
- [ ] æŒæ¡å„ç¨®è¨­è¨ˆæ¨¡å¼çš„æ‡‰ç”¨å ´æ™¯
- [ ] èƒ½å¤ è­˜åˆ¥å¸¸è¦‹çš„åæ¨¡å¼

### âœ… å¯¦å‹™æŠ€èƒ½é©—è­‰
- [ ] èƒ½å¤ é€²è¡Œå­åŸŸåˆ†é¡èˆ‡ä¸Šä¸‹æ–‡åŠƒåˆ†
- [ ] èƒ½å¤ è¨­è¨ˆåˆé©çš„èšåˆé‚Šç•Œ
- [ ] èƒ½å¤ è©•ä¼°ç¨‹å¼ç¢¼å“è³ª
- [ ] èƒ½å¤ æå‡ºç³»çµ±æ¶æ§‹æ”¹é€²å»ºè­°

### âœ… è€ƒè©¦æº–å‚™ç¨‹åº¦
- [ ] å®Œæˆæ‰€æœ‰ç« ç¯€æ¸¬é©—
- [ ] é€šéæ¨¡æ“¬è€ƒè©¦
- [ ] æ•´ç†éŒ¯é¡Œé›†ä¸¦è¤‡ç¿’
- [ ] ç†Ÿè¨˜æ ¸å¿ƒæ¦‚å¿µå®šç¾©

---

# é™„éŒ„

## A. å¿«é€Ÿåƒè€ƒæŒ‡å—

### A.1 DDD æ ¸å¿ƒæ¦‚å¿µé€ŸæŸ¥è¡¨

| æ¦‚å¿µ | å®šç¾© | é—œéµç‰¹å¾µ |
|------|------|----------|
| **é ˜åŸŸ** | çµ„ç¹”çš„æ ¸å¿ƒæ¥­å‹™æ´»å‹• | å°ˆæ¥­çŸ¥è­˜ã€è¤‡é›œæ¥­å‹™é‚è¼¯ |
| **å­åŸŸ** | é ˜åŸŸçš„ç´°åˆ†éƒ¨åˆ† | æ ¸å¿ƒã€æ”¯æ´ã€é€šç”¨ |
| **é™ç•Œä¸Šä¸‹æ–‡** | æ¨¡å‹ä¸€è‡´æ€§çš„é‚Šç•Œ | èªè¨€çµ±ä¸€ã€åœ˜éšŠè‡ªæ²» |
| **èšåˆ** | ä¸€è‡´æ€§å’Œäº‹å‹™çš„é‚Šç•Œ | å–®ä¸€è²¬ä»»ã€å¼·ä¸€è‡´æ€§ |
| **å¯¦é«”** | æœ‰å”¯ä¸€èº«ä»½çš„ç‰©ä»¶ | å¯è®Šæ€§ã€ç”Ÿå‘½é€±æœŸ |
| **å€¼ç‰©ä»¶** | ä¸å¯è®Šçš„æè¿°æ€§ç‰©ä»¶ | ç„¡èº«ä»½ã€å€¼ç›¸ç­‰ |

## B. æˆåŠŸæ¡ˆä¾‹ç ”ç©¶

### B.1 é›»å•†å¹³å° DDD å¯¦æ–½

**èƒŒæ™¯ï¼š** æŸå¤§å‹é›»å•†å¹³å°é‡æ§‹å–®é«”æ‡‰ç”¨

**æŒ‘æˆ°ï¼š**
- è¤‡é›œçš„æ¥­å‹™é‚è¼¯
- å¤šåœ˜éšŠå”ä½œ
- é«˜ä½µç™¼éœ€æ±‚

**è§£æ±ºæ–¹æ¡ˆï¼š**
- æˆ°ç•¥è¨­è¨ˆï¼šåŠƒåˆ† 6 å€‹é™ç•Œä¸Šä¸‹æ–‡
- æˆ°è¡“è¨­è¨ˆï¼šé‡æ–°è¨­è¨ˆèšåˆçµæ§‹
- æŠ€è¡“æ¶æ§‹ï¼šå¾®æœå‹™ + äº‹ä»¶é©…å‹•

**çµæœï¼š**
- é–‹ç™¼æ•ˆç‡æå‡ 40%
- ç³»çµ±ç©©å®šæ€§æ”¹å–„
- åœ˜éšŠè‡ªæ²»åº¦æé«˜

## C. æ¨è–¦è³‡æº

### C.1 ç¶“å…¸æ›¸ç±
- Eric Evansã€ŠDomain-Driven Designã€‹
- Vaughn Vernonã€ŠImplementing Domain-Driven Designã€‹
- Martin Fowlerã€ŠPatterns of Enterprise Application Architectureã€‹

### C.2 ç·šä¸Šè³‡æº
- DDD Community: https://dddcommunity.org/
- Event Storming: https://www.eventstorming.com/
- Domain Language: https://domainlanguage.com/

---

ğŸ¯ **æ­å–œæ‚¨å®Œæˆ Domain-Driven Design æ•™å­¸æ‰‹å†Šï¼**

é€šéç³»çµ±æ€§å­¸ç¿’ DDD çš„ç†è«–åŸºç¤ã€è¨­è¨ˆåŸå‰‡å’Œå¯¦å‹™æ‡‰ç”¨ï¼Œæ‚¨ç¾åœ¨å…·å‚™äº†ï¼š
- æ·±åº¦ç†è§£è¤‡é›œæ¥­å‹™é ˜åŸŸçš„èƒ½åŠ›
- è¨­è¨ˆé«˜å“è³ªè»Ÿé«”æ¶æ§‹çš„æŠ€èƒ½
- é ˜å°åœ˜éšŠå¯¦æ–½ DDD çš„çŸ¥è­˜

å»ºè­°æ‚¨ï¼š
1. åœ¨å¯¦éš›å°ˆæ¡ˆä¸­æ‡‰ç”¨æ‰€å­¸çŸ¥è­˜
2. æŒçºŒé—œæ³¨ DDD ç¤¾ç¾¤çš„æœ€æ–°ç™¼å±•
3. åˆ†äº«ç¶“é©—ä¸¦æŒçºŒå­¸ç¿’

**Domain-Driven Design ä¸åƒ…æ˜¯æŠ€è¡“æ–¹æ³•ï¼Œæ›´æ˜¯ä¸€ç¨®æ€ç¶­æ–¹å¼ã€‚** 

é¡˜æ‚¨åœ¨è»Ÿé«”è¨­è¨ˆçš„é“è·¯ä¸Šè¶Šèµ°è¶Šé ï¼ ğŸš€
    - "ç•¶æˆ‘ç¢ºèªè¨‚å–®æ™‚"
    - "é‚£éº¼ç³»çµ±æ‡‰è©²å°‡è¨‚å–®ç‹€æ…‹æ›´æ–°ç‚ºå·²ç¢ºèª"
    - "ä¸¦ä¸”è§¸ç™¼åº«å­˜é ç•™æµç¨‹"
    - "ä¸¦ä¸”ç™¼é€ç¢ºèªé€šçŸ¥çµ¦å®¢æˆ¶"
  
  ddd_considerations:
    bounded_context: "è¨‚å–®è™•ç†ä¸Šä¸‹æ–‡"
    domain_events: 
      - "OrderConfirmed"
      - "InventoryReservationRequested"
    business_rules:
      - "åªæœ‰å¾…ç¢ºèªçš„è¨‚å–®å¯ä»¥è¢«ç¢ºèª"
      - "ç¢ºèªå¾Œçš„è¨‚å–®ä¸èƒ½ä¿®æ”¹é …ç›®"
    aggregates:
      - "Order"
```

---

## 13. å°ˆæ¡ˆæœ€ä½³å¯¦è¸

### 13.1 å¸¸è¦‹éŒ¯èª¤èˆ‡åæ¨¡å¼

#### âŒ å¸¸è¦‹çš„ DDD åæ¨¡å¼

1. **è²§è¡€æ¨¡å‹ (Anemic Domain Model)**
```java
// éŒ¯èª¤ç¤ºç¯„ï¼šè²§è¡€æ¨¡å‹
public class Order {
    private OrderId id;
    private List<OrderItem> items;
    private Money total;
    private OrderStatus status;
    
    // åªæœ‰ getter/setterï¼Œæ²’æœ‰æ¥­å‹™é‚è¼¯
    public OrderId getId() { return id; }
    public void setId(OrderId id) { this.id = id; }
    // ... å…¶ä»– getter/setter
}

// æ¥­å‹™é‚è¼¯æ•£è½åœ¨æœå‹™ä¸­
public class OrderService {
    public void confirmOrder(Order order) {
        if (order.getStatus() != OrderStatus.PENDING) {
            throw new IllegalStateException("åªæœ‰å¾…è™•ç†è¨‚å–®å¯ä»¥ç¢ºèª");
        }
        order.setStatus(OrderStatus.CONFIRMED);
        // è¨ˆç®—ç¸½é¡é‚è¼¯
        Money total = Money.ZERO;
        for (OrderItem item : order.getItems()) {
            total = total.add(item.getPrice().multiply(item.getQuantity()));
        }
        order.setTotal(total);
    }
}

// æ­£ç¢ºç¤ºç¯„ï¼šè±å¯Œçš„é ˜åŸŸæ¨¡å‹
public class Order {
    private OrderId id;
    private List<OrderItem> items;
    private Money total;
    private OrderStatus status;
    
    // æ¥­å‹™é‚è¼¯å°è£åœ¨é ˜åŸŸç‰©ä»¶ä¸­
    public void confirm() {
        if (status != OrderStatus.PENDING) {
            throw new IllegalStateException("åªæœ‰å¾…è™•ç†è¨‚å–®å¯ä»¥ç¢ºèª");
        }
        this.status = OrderStatus.CONFIRMED;
        this.total = calculateTotal();
        addDomainEvent(new OrderConfirmed(this.id));
    }
    
    private Money calculateTotal() {
        return items.stream()
            .map(OrderItem::getSubtotal)
            .reduce(Money.ZERO, Money::add);
    }
}
```

2. **èšåˆéå¤§æˆ–éå°**
```java
// éŒ¯èª¤ï¼šèšåˆéå¤§
public class CustomerAggregate {
    private Customer customer;
    private List<Order> orders;           // ä¸æ‡‰è©²åŒ…å«åœ¨èšåˆä¸­
    private List<Address> addresses;      // å¯èƒ½é€ æˆèšåˆéå¤§
    private List<PaymentMethod> paymentMethods;
    private CustomerPreferences preferences;
    private List<SupportTicket> supportTickets; // ä¸æ‡‰è©²åŒ…å«åœ¨èšåˆä¸­
}

// æ­£ç¢ºï¼šé©ç•¶å¤§å°çš„èšåˆ
public class Customer {
    private CustomerId id;
    private PersonalInfo personalInfo;
    private ContactInfo contactInfo;
    private CustomerStatus status;
    
    // åªåŒ…å«éœ€è¦ä¿æŒä¸€è‡´æ€§çš„è³‡æ–™
}

// è¨‚å–®æ‡‰è©²æ˜¯ç¨ç«‹çš„èšåˆ
public class Order {
    private OrderId id;
    private CustomerId customerId; // é€šé ID å¼•ç”¨ï¼Œè€Œéç›´æ¥å¼•ç”¨
    private List<OrderItem> items;
    private OrderStatus status;
}
```

3. **éŒ¯èª¤çš„äº‹å‹™é‚Šç•Œ**
```java
// éŒ¯èª¤ï¼šè·¨èšåˆäº‹å‹™
@Transactional
public void processOrder(OrderId orderId) {
    Order order = orderRepository.findById(orderId);
    Customer customer = customerRepository.findById(order.getCustomerId());
    Inventory inventory = inventoryRepository.findByProducts(order.getProducts());
    
    // åœ¨åŒä¸€å€‹äº‹å‹™ä¸­ä¿®æ”¹å¤šå€‹èšåˆ
    order.confirm();
    customer.addLoyaltyPoints(order.getTotal());
    inventory.reserveItems(order.getItems());
    
    orderRepository.save(order);
    customerRepository.save(customer);
    inventoryRepository.save(inventory);
}

// æ­£ç¢ºï¼šæœ€çµ‚ä¸€è‡´æ€§è™•ç†
@Transactional
public void confirmOrder(OrderId orderId) {
    Order order = orderRepository.findById(orderId);
    order.confirm(); // åªä¿®æ”¹å–®ä¸€èšåˆ
    orderRepository.save(order);
    
    // é€éäº‹ä»¶è§¸ç™¼å…¶ä»–èšåˆçš„æ›´æ–°
    domainEventPublisher.publish(new OrderConfirmed(order.getId(), order.getTotalAmount()));
}

@EventHandler
public void handleOrderConfirmed(OrderConfirmed event) {
    // åœ¨ç¨ç«‹äº‹å‹™ä¸­è™•ç†
    customerService.addLoyaltyPoints(event.getCustomerId(), event.getAmount());
    inventoryService.reserveItems(event.getOrderId());
}
```

### 13.2 æˆåŠŸæ¡ˆä¾‹åˆ†äº«

#### ğŸ† æ¡ˆä¾‹ä¸€ï¼šå¤§å‹é›»å•†å¹³å°é‡æ§‹

**èƒŒæ™¯ï¼š** æŸå¤§å‹é›»å•†å¹³å°é¢è‡¨ç³»çµ±è¤‡é›œåº¦éé«˜ã€é–‹ç™¼æ•ˆç‡ä½ä¸‹çš„å•é¡Œã€‚

**DDD å¯¦æ–½ç­–ç•¥ï¼š**

1. **æˆ°ç•¥è¨­è¨ˆéšæ®µ**
```yaml
subdomain_analysis:
  core_domains:
    - name: "å•†å“æ¨è–¦å¼•æ“"
      investment: "æœ€é«˜å„ªå…ˆç´šï¼Œå°ˆé–€åœ˜éšŠ"
      competitive_advantage: "å€‹æ€§åŒ–æ¨è–¦ç®—æ³•"
    
    - name: "å®šåƒ¹ç­–ç•¥ç³»çµ±"
      investment: "é«˜å„ªå…ˆç´šï¼ŒæŒçºŒå„ªåŒ–"
      competitive_advantage: "å‹•æ…‹å®šåƒ¹èƒ½åŠ›"
  
  supporting_subdomains:
    - name: "è¨‚å–®ç®¡ç†"
      strategy: "å…§éƒ¨é–‹ç™¼ï¼Œæ¨™æº–åŒ–æµç¨‹"
    
    - name: "åº«å­˜ç®¡ç†"
      strategy: "è³¼è²·å•†ç”¨è»Ÿé«”ä¸¦å®¢è£½åŒ–"
  
  generic_subdomains:
    - name: "ä½¿ç”¨è€…èªè­‰"
      strategy: "æ¡ç”¨ OAuth 2.0 + Auth0"
    
    - name: "æ”¯ä»˜è™•ç†"
      strategy: "æ•´åˆç¬¬ä¸‰æ–¹æ”¯ä»˜æœå‹™"
```

2. **é™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†**
```java
// å•†å“ç›®éŒ„ä¸Šä¸‹æ–‡
@BoundedContext("ProductCatalog")
public class ProductCatalogContext {
    // å°ˆæ³¨æ–¼å•†å“è³‡è¨Šç®¡ç†
    private Product product;
    private Category category;
    private ProductSpecification specification;
}

// è¨‚å–®è™•ç†ä¸Šä¸‹æ–‡
@BoundedContext("OrderProcessing")
public class OrderProcessingContext {
    // å°ˆæ³¨æ–¼è¨‚å–®ç”Ÿå‘½é€±æœŸ
    private Order order;
    private OrderItem orderItem;
    private ShippingInfo shippingInfo;
}

// æ¨è–¦å¼•æ“ä¸Šä¸‹æ–‡
@BoundedContext("RecommendationEngine")
public class RecommendationEngineContext {
    // å°ˆæ³¨æ–¼æ¨è–¦ç®—æ³•
    private UserProfile userProfile;
    private RecommendationModel model;
    private PersonalizedRecommendation recommendation;
}
```

**å¯¦æ–½çµæœï¼š**
- é–‹ç™¼é€Ÿåº¦æå‡ 40%
- ç³»çµ±å¯ç¶­è­·æ€§é¡¯è‘—æ”¹å–„
- æ–°åŠŸèƒ½ä¸Šç·šæ™‚é–“ç¸®çŸ­ 60%
- åœ˜éšŠè‡ªä¸»æ€§å¢å¼·ï¼Œæ¸›å°‘è·¨åœ˜éšŠå”èª¿æˆæœ¬

#### ğŸ† æ¡ˆä¾‹äºŒï¼šé‡‘èç§‘æŠ€å…¬å¸çš„ DDD è½‰å‹

**èƒŒæ™¯ï¼š** æ–°å‰µé‡‘èç§‘æŠ€å…¬å¸éœ€è¦å¿«é€Ÿé–‹ç™¼è¤‡é›œçš„é‡‘èç”¢å“ã€‚

**DDD å¯¦æ–½é‡é»ï¼š**

1. **äº‹ä»¶é©…å‹•æ¶æ§‹**
```java
// æŠ•è³‡çµ„åˆèšåˆ
public class Portfolio {
    public void rebalance(RebalancingStrategy strategy) {
        List<AssetAllocation> newAllocations = strategy.calculate(this.holdings);
        
        for (AssetAllocation allocation : newAllocations) {
            if (requiresTrading(allocation)) {
                addDomainEvent(new TradingRequired(
                    this.portfolioId,
                    allocation.getAsset(),
                    allocation.getTargetWeight()
                ));
            }
        }
        
        this.lastRebalanced = LocalDateTime.now();
    }
}

// é¢¨éšªç®¡ç†äº‹ä»¶è™•ç†
@EventHandler
public class RiskManagementEventHandler {
    @EventListener
    public void handle(TradingRequired event) {
        RiskAssessment assessment = riskEngine.assessTrade(
            event.getPortfolioId(),
            event.getAsset(),
            event.getTargetWeight()
        );
        
        if (assessment.exceedsRiskLimit()) {
            eventPublisher.publish(new TradingRejected(
                event.getPortfolioId(),
                "è¶…å‡ºé¢¨éšªé™é¡"
            ));
        } else {
            eventPublisher.publish(new TradingApproved(
                event.getPortfolioId(),
                event.getAsset(),
                event.getTargetWeight()
            ));
        }
    }
}
```

2. **CQRS æ‡‰ç”¨**
```java
// å‘½ä»¤ç«¯ï¼šäº¤æ˜“åŸ·è¡Œ
@CommandHandler
public class TradingCommandHandler {
    public void handle(ExecuteTradeCommand command) {
        Portfolio portfolio = portfolioRepository.findById(command.getPortfolioId());
        Trade trade = portfolio.executeTrade(
            command.getAsset(),
            command.getQuantity(),
            command.getPrice()
        );
        
        tradeRepository.save(trade);
        portfolioRepository.save(portfolio);
    }
}

// æŸ¥è©¢ç«¯ï¼šæŠ•è³‡çµ„åˆæª¢è¦–
@QueryHandler
public class PortfolioQueryHandler {
    public PortfolioSummary handle(GetPortfolioSummaryQuery query) {
        return portfolioReadModel.getPortfolioSummary(query.getPortfolioId());
    }
    
    public List<PerformanceMetrics> handle(GetPerformanceHistoryQuery query) {
        return performanceReadModel.getPerformanceHistory(
            query.getPortfolioId(),
            query.getDateRange()
        );
    }
}
```

**å¯¦æ–½çµæœï¼š**
- æ³•è¦éµå¾ªè‡ªå‹•åŒ–ç¨‹åº¦æå‡ 80%
- æ–°é‡‘èç”¢å“é–‹ç™¼é€±æœŸç¸®çŸ­ 50%
- ç³»çµ±å¯æ“´å±•æ€§å¤§å¹…æå‡
- é¢¨éšªæ§åˆ¶èƒ½åŠ›é¡¯è‘—å¢å¼·

### 13.3 DDD å°å…¥è·¯ç·šåœ–

#### ğŸ—ºï¸ éšæ®µæ€§å°å…¥ç­–ç•¥

```mermaid
gantt
    title DDD å°å…¥æ™‚ç¨‹è¦åŠƒ
    dateFormat  YYYY-MM-DD
    section æº–å‚™éšæ®µ
    åœ˜éšŠåŸ¹è¨“        :2024-01-01, 30d
    å·¥å…·é¸å‹        :2024-01-15, 20d
    è©¦é»å°ˆæ¡ˆé¸æ“‡    :2024-01-20, 10d
    
    section è©¦é»éšæ®µ
    æˆ°ç•¥è¨­è¨ˆå·¥ä½œåŠ  :2024-02-01, 5d
    é™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†  :2024-02-06, 10d
    æ ¸å¿ƒèšåˆå¯¦ä½œ    :2024-02-16, 30d
    äº‹ä»¶ç³»çµ±å»ºç«‹    :2024-03-01, 20d
    
    section æ“´å±•éšæ®µ
    å…¶ä»–æ¨¡çµ„é‡æ§‹    :2024-03-21, 60d
    å¾®æœå‹™æ‹†åˆ†      :2024-04-15, 45d
    CQRS å¯¦æ–½      :2024-05-01, 30d
    
    section å„ªåŒ–éšæ®µ
    æ•ˆèƒ½èª¿å„ª        :2024-06-01, 20d
    ç›£æ§å®Œå–„        :2024-06-15, 15d
    æ–‡æª”å®Œå–„        :2024-06-20, 10d
```

#### ğŸ“‹ å°å…¥æª¢æŸ¥æ¸…å–®

**éšæ®µä¸€ï¼šæº–å‚™éšæ®µ**
- [ ] çµ„ç¹” DDD åŸ¹è¨“èª²ç¨‹
- [ ] å»ºç«‹é€šç”¨èªè¨€è©å½™è¡¨
- [ ] é¸æ“‡åˆé©çš„è©¦é»å°ˆæ¡ˆ
- [ ] æº–å‚™é–‹ç™¼å·¥å…·èˆ‡æ¡†æ¶
- [ ] å»ºç«‹ç¨‹å¼ç¢¼å¯©æŸ¥æ¨™æº–

**éšæ®µäºŒï¼šè©¦é»éšæ®µ**
- [ ] é€²è¡Œ Event Storming å·¥ä½œåŠ
- [ ] å®Œæˆé™ç•Œä¸Šä¸‹æ–‡åŠƒåˆ†
- [ ] å¯¦ä½œæ ¸å¿ƒèšåˆèˆ‡é ˜åŸŸæœå‹™
- [ ] å»ºç«‹äº‹ä»¶ç™¼å¸ƒèˆ‡è¨‚é–±æ©Ÿåˆ¶
- [ ] ç·¨å¯«å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦

**éšæ®µä¸‰ï¼šæ“´å±•éšæ®µ**
- [ ] é‡æ§‹ç¾æœ‰æ¨¡çµ„
- [ ] å¯¦æ–½å¾®æœå‹™æ‹†åˆ†
- [ ] å¼•å…¥ CQRS æ¨¡å¼
- [ ] å»ºç«‹ API Gateway
- [ ] å¯¦ä½œåˆ†æ•£å¼è¿½è¹¤

**éšæ®µå››ï¼šå„ªåŒ–éšæ®µ**
- [ ] æ•ˆèƒ½èª¿å„ªèˆ‡ç›£æ§
- [ ] å»ºç«‹ DevOps æµç¨‹
- [ ] å®Œå–„æŠ€è¡“æ–‡æª”
- [ ] å»ºç«‹çŸ¥è­˜åˆ†äº«æ©Ÿåˆ¶
- [ ] æŒçºŒæ”¹é€²æµç¨‹

---

## ğŸ’¯ ç¬¬å››ç¯‡æª¢æŸ¥æ¸…å–®ï¼ˆChecklistï¼‰

### âœ… é ˜åŸŸäº‹ä»¶èˆ‡ Event Sourcing
- [ ] ç†è§£é ˜åŸŸäº‹ä»¶çš„å®šç¾©èˆ‡æ‡‰ç”¨å ´æ™¯
- [ ] èƒ½å¤ è¨­è¨ˆäº‹ä»¶ç™¼å¸ƒèˆ‡è¨‚é–±æ©Ÿåˆ¶
- [ ] æŒæ¡ Event Sourcing çš„å¯¦ä½œæ–¹å¼
- [ ] äº†è§£ CQRS èˆ‡ DDD çš„çµåˆ

### âœ… æ¶æ§‹è¨­è¨ˆèƒ½åŠ›
- [ ] èƒ½å¤ è¨­è¨ˆåˆ†å±¤æ¶æ§‹
- [ ] ç†è§£å…­è§’æ¶æ§‹çš„åŸç†èˆ‡å¯¦ä½œ
- [ ] æŒæ¡ Clean Architecture çš„æ‡‰ç”¨
- [ ] èƒ½å¤ é€²è¡Œå¾®æœå‹™é‚Šç•ŒåŠƒåˆ†

### âœ… å¯¦å‹™æ‡‰ç”¨æŠ€èƒ½
- [ ] èƒ½å¤ é€²è¡Œ Event Storming å·¥ä½œåŠ
- [ ] æŒæ¡ Domain Storytelling æŠ€å·§
- [ ] èƒ½å¤ èˆ‡ Scrum æµç¨‹æ•´åˆ
- [ ] é¿å…å¸¸è¦‹çš„ DDD åæ¨¡å¼

---

ğŸ“š **å»¶ä¼¸é–±è®€**
- Eric Evansã€ŠDomain-Driven Design: Tackling Complexity in the Heart of Softwareã€‹
- Vaughn Vernonã€ŠImplementing Domain-Driven Designã€‹
- Scott Millettã€ŠPatterns, Principles, and Practices of Domain-Driven Designã€‹