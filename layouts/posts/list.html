{{- define "main" }}

{{- if .Content }}
<div class="post-content">
  {{ .Content }}
</div>
{{- end }}

{{- $pages := where site.RegularPages "Section" "posts" }}
{{- $paginator := .Paginate $pages }}

{{- if $paginator.Pages }}
<div class="posts-list">
  {{- range $paginator.Pages }}
  <article class="post-entry tag-entry">
    <header class="entry-header">
      <h2><a href="{{ .RelPermalink }}">{{ .Title | markdownify }}</a></h2>
    </header>
    {{- if (ne (.Param "hideSummary") true) }}
    <div class="entry-content">
      <p>{{ .Summary | plainify | htmlUnescape }}{{ if .Truncated }}...{{ end }}</p>
    </div>
    {{- end }}
    {{- if not (.Param "hideMeta") }}
    <footer class="entry-footer">
      {{- partial "post_meta.html" . -}}
    </footer>
    {{- end }}
    <a class="entry-link" aria-label="post link to {{ .Title | plainify }}" href="{{ .RelPermalink }}"></a>
  </article>
  {{- end }}
</div>

{{- if gt $paginator.TotalPages 1 }}
<nav class="pagination">
  {{- if $paginator.HasPrev }}
  <a class="prev" href="{{ $paginator.Prev.URL | absURL }}">«&nbsp;{{ i18n "prev_page" | default "Prev" }}</a>
  {{- end }}
  {{- if $paginator.HasNext }}
  <a class="next" href="{{ $paginator.Next.URL | absURL }}">{{ i18n "next_page" | default "Next" }}&nbsp;»</a>
  {{- end }}
</nav>
{{- end }}

{{- else }}
{{- $Posts := site.RegularPages | where "Type" "in" site.Params.mainSections }}
{{- if eq (len $Posts) 0 }}
<p>{{ i18n "posts_not_found" | default "No posts found" }}</p>
{{- end }}
{{- end }}

{{- end }}{{/* end main */}}